<!DOCTYPE html>
<html class="tei-article3"><head><base href="/exist/apps/tei-publisher/doc/"><meta charset="utf-8"><link rel="Stylesheet" href="resources/fonts/font.css"><link rel="Stylesheet" href="resources/css/print.css"><link rel="stylesheet" type="text/css" href="transform/docbook.css"><style rel="stylesheet" type="text/css">
        a[rel=footnote] {
            font-size: var(--pb-footnote-font-size, var(--pb-content-font-size, 75%));
            font-family: var(--pb-footnote-font-family, --pb-content-font-family);
            vertical-align: super;
            text-decoration: none;
            padding: var(--pb-footnote-padding, 0 0 0 .25em);
        }
        .footnote .fn-number {
            float: left;
            font-size: var(--pb-footnote-font-size, var(--pb-content-font-size, 75%));
        }</style><script defer src="https://cdn.jsdelivr.net/npm/web-components-loader/lib/index.min.js"></script><script type="module" src="https://cdn.jsdelivr.net/npm/@teipublisher/pb-components/dist/pb-components-bundle.min.js"></script></head>
  <div class="tei-info1 frontmatter"><h1 class="tei-title6 doc-title">TEI Publisher Documentation</h1><span class="tei-author4"></span></div>
  <div class="tei-section3" id="introduction"><pb-observable data="0,3.6" emit="transcription">
    <h1 class="tei-title7 title">Introduction</h1>
    <div class="tei-section3" id="introduction-explainer"><pb-observable data="0,3.6.5" emit="transcription">
      <h2 class="tei-title7 title">What TEI Publisher does ...</h2>
      <p class="tei-para">
        The motivation behind TEI Publisher was to provide a tool which enables scholars and
        editors to publish their materials without becoming programmers, but also does not force
        them into a one-size-fits-all framework. Experienced developers will benefit as well by
        writing less code, avoiding redundancy, improve maintenance and interoperability - to just
        name a few. TEI Publisher is all about
        <span class="tei-emphasis1">standards</span>
        ,
        <span class="tei-emphasis1">modularity</span>
        ,
        <span class="tei-emphasis1">reusability</span>
        and
        <span class="tei-emphasis1">sustainability</span>
        !
      </p>
      <p class="tei-para">In Publisher, it all starts with your source documents - regardless if they are in TEI
        or other form of XML: DocBook, MS Word (DOCX) or JATS. No matter how the source material has
        been encoded, it can be easily transformed into a range of output formats for publication -
        from a modern web page that you can open on your laptop or mobile device, to an ebook, a PDF
        file or its LaTeX source.</p>
      <p class="tei-para">
        TEI Publisher derives its name from TEI and the TEI Processing Model (PM). Processing
        Model is a part of the TEI vocabulary and TEI ODD specification format, described in the
        <a href="http://www.tei-c.org/release/doc/tei-p5-doc/en/html/TD.html#TDPM" class="tei-link4" target="_new">TEI P5
          guidelines</a>
        as well as further chapters here. It defines how a TEI document should
        be rendered in different output formats and lies at the heart of TEI Publisher.
      </p>
      <p class="tei-para">However, online editions require more than just a text transformation: the text needs to
        be embedded into an application context, adding navigation, pagination, search, facsimile
        display and so on. The larger part of TEI Publisher deals with those aspects, providing all
        the necessary building blocks for an online edition.</p>
      <p class="tei-para">
        Staying true to the spirit of code reuse and interoperability, TEI Publisher implements
        its functionalities as small "lego" blocks to be freely arranged and recombined. The
        technology making this possible is called
        <span class="tei-emphasis2">Web Components</span>
        . It is part of
        the HTML5 specification and natively implemented by many browsers. Users don't need to dive
        into the details of this standard though: all you need to modify the example pages is some
        basic HTML knowledge.
      </p>
      <p class="tei-para">
        Only where the
        <a href="https://cdn.tei-publisher.com/api.html" class="tei-link4" target="_new">available
          components</a>
        are not enough, a new use case needs to be described and suitable new
        components implemented but then they can be incorporated into existing component pool for
        everyone else to use. After all, our mantra is reuse, reuse, reuse and we want to turn TEI
        Publisher into a box of tools the entire community can benefit from.
      </p>
      <p class="tei-para">Despite the elegant simplicity of this approach, various projects we realized in the
        past prove that TEI Publisher is:</p>
      <ol class="tei-orderedlist"><li class="tei-listitem">
          <p class="tei-para">powerful enough to cover complex transformation needs</p>
        </li><li class="tei-listitem">
          <p class="tei-para">a truly universal tool for any kind of digital edition</p>
        </li><li class="tei-listitem">
          <p class="tei-para">capable of generating high quality, camera ready material for book publishing</p>
        </li><li class="tei-listitem">
          <p class="tei-para">sustainable and future-proof solution</p>
        </li><li class="tei-listitem">
          <p class="tei-para">suitable for any XML, not just TEI (this documentation is written in
            DocBook!)</p>
        </li></ol>
    </pb-observable></div>
    <div class="tei-section3" id="e-editiones"><pb-observable data="0,3.6.7" emit="transcription">
      <h2 class="tei-title7 title">e-editiones.org</h2>
      <p class="tei-para">
        Since its first incarnation in 2015, TEI Publisher has gained substantial following with
        numerous academic and commercial projects around the globe using it for their editorial and
        publishing needs. Grass-roots user initiative led in 2020 to the foundation of an
        international non-profit association
        <a href="https://e-editiones.org" class="tei-link4" target="_new">e-editiones.org</a>
        with the focus on further
        joint development of TEI Publisher, open standards and best practices for digital
        editions.
      </p>

      <p class="tei-para">TEI Publisher development is only possible thanks to generous contributions of
        developers, users and institutions willing to employ Open Source approaches so that the
        whole community can reuse and benefit from their work.</p>

      <p class="tei-para">
        A growing number of projects from small to large that have decided to publish their
        materials with TEI Publisher gives us all not only the opportunity but also the
        responsibility to make the project thrive for years to come and to make it truly sustainable
        option for XML publishing! Consider joining
        <a href="https://e-editiones.org" class="tei-link4" target="_new">e-editiones.org</a>
        through your affiliated
        institution or individually to support our efforts.
      </p>

      <p class="tei-para">We invite the community to contribute to the project - by means of code, ideas,
        documentation, tutorials and funding. </p>
      <p class="tei-para"> You don't have to be a developer to contribute, you can do so in a number of ways! </p>

      <ol class="tei-orderedlist"><li class="tei-listitem">
          <p class="tei-para">Check out the source code, modify it, document it, enhance it.</p>
        </li><li class="tei-listitem">
          <p class="tei-para">Create new or enhance existing example documents and ODDs so we present showcases
            for various TEI applications.</p>
        </li><li class="tei-listitem">
          <p class="tei-para">
            Report your issues, feature requests or ideas for discussion via
            <a href="https://github.com/eeditiones/tei-publisher-app/issues" class="tei-link4" target="_new">GitHub issue tracker</a>
            .
          </p>
        </li><li class="tei-listitem">
          <p class="tei-para">
            Discuss with us on
            <a href="https://join.slack.com/t/e-editiones/shared_invite/zt-e19jc03q-OFaVni~_lh6emSHen6pswg" class="tei-link4" target="_new">e-editiones slack chat</a>
            or through the
            <a href="https://admin.hostpoint.ch/mailman/listinfo/community_e-editiones.org" class="tei-link4" target="_new">mailing list</a>
            and
            <a href="https://twitter.com/EEditiones" class="tei-link4" target="_new">@EEditiones twitter</a>
            .
          </p>
        </li><li class="tei-listitem">
          <p class="tei-para">
            Contribute to translations via
            <a href="https://crwd.in/tei-publisher" class="tei-link4" target="_new">Crowdin</a>
            . Please contact us if your
            target language is not listed and you'd like to work on it.
          </p>
        </li><li class="tei-listitem">
          <p class="tei-para"> Port back your custimizations to the TEI Publisher code base so that others can use
            it too (or ask us to do it for you)! </p>
        </li><li class="tei-listitem">
          <p class="tei-para"> Help and mentor others - publish teaching materials, answer questions on our Slack
            channel, mailing list and other forums. </p>
        </li><li class="tei-listitem">
          <p class="tei-para"> Sponsor a concrete feature or fund a development grant. </p>
        </li></ol>
    </pb-observable></div>
    <div class="tei-section3" id="versions"><pb-observable data="0,3.6.9" emit="transcription">
      <h2 class="tei-title7 title">Versions</h2>
      <p class="tei-para">TEI Publisher has been under active development since 2015. Once or twice a year a new
        major version is released, bringing important new features.</p>
      <p class="tei-para">Minor versions are released at shorter intervals and offer bug fixes, minor new features
        and improvements.</p>
      <p class="tei-para">The current major version of the TEI Publisher is 7.0.0</p>

      <p class="tei-para">
        There's a long list of ideas and features we'd like to see incorporated into TEI
        Publisher: from wider coverage of input and output formats (e.g. InDesign), CQL and DTS
        support, to various editing workflows and support for efficient hosting and maintenance of
        multiple editions. These ideas are in various stages of development - some already advanced,
        some in conceptual phase, some waiting for funding and implementation. Coordination of
        future work is primarily conducted by
        <a href="https://e-editiones.org" class="tei-link4" target="_new">e-editiones.org</a>
        .
      </p>

      <div class="tei-section3" id="v7"><pb-observable data="0,3.6.9.13" emit="transcription">
        <h3 class="tei-title7 title">What's new in TEI Publisher 7.0.0</h3>
        <p class="tei-para">Version 7 brought another major refactoring and restructuring of TEI Publisher app ,
          particularly regarding the server-side modules.</p>
        <p class="tei-para">
          TEI Publisher now exposes a well-defined, clear
          <a href="../api.html" class="tei-link4" target="_new">API specification</a>
          following the
          <a href="http://spec.openapis.org/oas/v3.0.3" class="tei-link4" target="_new">Open API standard</a>
          . This API is
          used in TEI Publisher by client-side UI components but can be equally well utilized by
          independent software which harnesses functionality exposed via the API without being
          forced to rely on Publisher's client-side components.
        </p>
        <p class="tei-para">
          On the server a new package,
          <span class="tei-filename code">oas-router</span>
          , reads the API
          specification and uses it to map HTTP requests to XQuery functions which perform actual
          API operations. Other packages, particularly UI web components
            (
          <span class="tei-filename code">pb-components</span>
          ) and TEI Processing Model library
            (
          <span class="tei-filename code">tei-publisher-lib</span>
          ) underwent necessary changes to communicate with
          the new API as well as retain full backwards compatibility.
        </p>

        <p class="tei-para">Beyond the structural changes a number of reported issues has been fixed and broader
          test coverage for all packages introduced. A sophisticated CI setup based on Docker has
          been created. Extensive test suite has been prepared for individual components.
          Furthermore, every API operation is independently tested against the specification, to
          assure that e.g. parameter and response types correspond exactly to the definition.</p>

        <p class="tei-para">
          Thanks to community contributions via
          <a href="https://crwd.in/tei-publisher" class="tei-link4" target="_new">Crowdin</a>
          , TEI Publisher is now
          available in 20 languages.
        </p>

        <p class="tei-para">
          See chapter on
          <a href="?odd=docbook.odd&amp;view=&amp;id=updating" class="tei-link3" target="">Updating</a>
          for information how to update
          your app to take advantake of these developments.
        </p>
      </pb-observable></div>
      <div class="tei-section3" id="v6"><pb-observable data="0,3.6.9.15" emit="transcription">
        <h3 class="tei-title7 title">What's new in TEI Publisher 6.0.0</h3>
        <p class="tei-para">Version 6 brought a major refactoring and restructuring of TEI Publisher app libraries
          along with new specialized components and use case examples.</p>
        <ol class="tei-orderedlist"><li class="tei-listitem">
            <p class="tei-para">
              Web components overhaul: migration to
              <a href="https://lit-element.polymer-project.org/" class="tei-link4" target="_new">LitElement</a>
              and to the
              npm library
            </p>
            <p class="tei-para">While invisible to users, this redesign greatly improves the modularity of
              Publisher-based applications. With Publisher web component releases published on npm,
              updating the user interface for all Publisher-based apps is just a question of
              changing a single variable in the configuration file.</p>
            <p class="tei-para">
              Furthermore, Publisher's library of web components - true to the basic idea of
              <a href="https://developer.mozilla.org/en-US/docs/Web/Web_Components" class="tei-link4" target="_new">Web
                Components Standard</a>
              can be included in any HTML webpage e.g. can be embedded
              into existing CMS or any other publishing solution, even if it's not running
              eXist-db.
            </p>
            <p class="tei-para">
              Similarly, if you prefer to write your own application using any of the popular
              frameworks like
              <span class="tei-emphasis2">angular, vue or react</span>
              you can easily import the
              <span class="tei-code2 code">pb-components</span>
              package from npm and use it directly in your
              project.
            </p>
            <p class="tei-para">As a final consequence, this change decouples the component library from the TEI
              Publisher app. It is now possible to host multiple applications, which depend on
              different versions of the component library, without conflict within the same eXist-db
              instance, a point of importance for institutions with numerous projects.</p>
          </li><li class="tei-listitem">
            <p class="tei-para">Redesigned and simplified CSS styling customization</p>
            <p class="tei-para">
              Encapsulation of styles offered by web components can be a mixed blessing and
              poses some challenges when customizing the aesthetics of components to fit a project.
              While some aspects of component styling remained unaccessible for customization in
              previous versions, Publisher 6 exposes majority of styling properties via standard CSS
              files and theme variables. Stylesheets can also be specified within the ODD, as
              previously, or through
              <span class="tei-code2 code">pb-view</span>
              component configuration attributes.
            </p>
          </li><li class="tei-listitem">
            <p class="tei-para">Extended internationalization</p>
            <p class="tei-para">I18n support has been extended to cover not only the labels in HTML templates but
              also within web components. A mechanism for project specific language files extending
              the default Publisher label collection has been added.</p>
            <p class="tei-para">
              Thanks to community contributions via
              <a href="https://crwd.in/tei-publisher" class="tei-link4" target="_new">Crowdin</a>
              a number of new languages
              has been added and existing ones updated.
            </p>
          </li><li class="tei-listitem">
            <p class="tei-para">Subcorpora - new TEI Publisher data organization</p>
            <p class="tei-para">
              Publisher's pre-populated data collection is now split into
              <span class="tei-emphasis2">Playground</span>
              and
              <span class="tei-emphasis2">TEI Publisher demo
                collection</span>
              areas which illustrate how this mechanism could be used to
              host multiple subcorpora within single TEI Publisher application.
            </p>
          </li><li class="tei-listitem">
            <p class="tei-para">New and improved web components</p>
            <p class="tei-para">
              <span class="tei-code2 code">pb-select-feature</span>
              and
              <span class="tei-code2 code">pb-toggle-feature</span>
              components have
              been extended to allow for interactive changing of display parameters (like switching
              between regularized or original spelling) which can be then processed client or
              server-side.
            </p>
            <p class="tei-para">New components have been created to handle MEI music notation as well as for web
              component API documentation and demo pages.</p>
          </li><li class="tei-listitem">
            <p class="tei-para">User interface of the ODD editor has been improved.</p>
          </li><li class="tei-listitem">
            <p class="tei-para">Experimental incremental scroll mode has been introduced to improve performance
              for very long documents presented in single page mode.</p>
          </li></ol>
      </pb-observable></div>

    </pb-observable></div>
  </pb-observable></div>
  <div class="tei-section3" id="quickstart"><pb-observable data="0,3.8" emit="transcription">
    <h1 class="tei-title7 title">Quickstart</h1>
    <div class="tei-section3" id="workshop-2020"><pb-observable data="0,3.8.5" emit="transcription">
      <h2 class="tei-title7 title">«Stay Home Learn TEI Publisher From Scratch»</h2>
      <p class="tei-para">
        A 3-part online course has been organized by e-editiones and led by Wolfgang Meier in
          June 2020. Course material, as well as video recordings of all the sessions, and a
          walk-through for the assignments are available for self-study. Find all informations on
          the
        <a href="https://github.com/eeditiones/workshop#slides" class="tei-link4" target="_new">workshop GitHub</a>
        page.
      </p>
      <span class="tei--element">
        <span class="tei--element">
          <iframe src="https://www.youtube-nocookie.com/embed/QuWrfAS2SWM" width="" height="" frameborder="0" gesture="media" allow="encrypted-media" allowfullscreen="allowfullscreen"></iframe>
        </span>
      </span>
    </pb-observable></div>
    <div class="tei-section3" id="installation"><pb-observable data="0,3.8.7" emit="transcription">
      <h2 class="tei-title7 title">Installation</h2>
      <p class="tei-para">
        TEI Publisher requires the
        <a href="http://exist-db.org" class="tei-link4" target="_new">eXist XML database</a>
        to operate. It is distributed as an eXist application
          package, making it easy to install on any eXist database instance - either on your local
          machine or any remote server.
      </p>
      <p class="tei-para">
        You can install eXist and TEI Publisher manually, as described below. Alternatively
          use the provided
        <a href="?odd=docbook.odd&amp;view=&amp;id=docker" class="tei-link3" target="">docker image</a>
        .
      </p>

      <div class="tei-section3" id="exist-installation"><pb-observable data="0,3.8.7.9" emit="transcription">
        <h3 class="tei-title7 title">Installing into an eXist instance</h3>

        <div class="tei-section3" id="java"><pb-observable data="0,3.8.7.9.5" emit="transcription">
          <h4 class="tei-title7 title">Java</h4>
          <p class="tei-para">
            Before installing eXist, make sure you have Java installed on your machine. You
              can run
            <span class="tei-command code">java -version</span>
            on a command line to check which version of
              Java you have. Make sure you have at least Java 8 (recommended: Java 11). Please note
              that the
            <span class="tei-command code">java -version</span>
            shows the full version string, so 1.8.0 or
              similar instead of just 8.
          </p>
          <p class="tei-para">
            If you do not have Java installed, you can choose between a variety of different
              Java distributions for your operating system. While these are largely equivalent, so
              far we have had the smoothest installation experience across operating systems with
              the
            <a href="https://www.azul.com/downloads/zulu-community/?package=jdk" class="tei-link4" target="_new">Zulu
                Community OpenJDK</a>
            builds. In particular for Windows users, this provides the
              best out of the box experience.
          </p>
        </pb-observable></div>
        <div class="tei-section3" id="download"><pb-observable data="0,3.8.7.9.7" emit="transcription">
          <h4 class="tei-title7 title">Download</h4>

          <p class="tei-para">
            Download an eXist distribution following the link on its
            <a href="http://exist-db.org/exist/apps/homepage/index.html#downloads" class="tei-link4" target="_new">homepage</a>
            .
          </p>

          <div class="tei-note3 note"><p class="tei-para">It is recommended that you set up an admin password when installing eXist but
                make sure to remember or store it securely!</p></div>
        </pb-observable></div>

        <div class="tei-section3" id="mac-installation"><pb-observable data="0,3.8.7.9.9" emit="transcription">
          <h4 class="tei-title7 title">Mac installation</h4>
          <p class="tei-para">
            On a Mac download the file with the
            <span class="tei-command code">.dmg</span>
            extension, e.g.
                "
            <span class="tei-filename code">eXist-db-5.x.x.dmg</span>
            ".
          </p>


          <p class="tei-para">
            Double clicking the downloaded
            <span class="tei-command code">.dmg</span>
            file should install eXist
              on your local system. It is only required to drag the eXist app icon over to the
              Applications folder.
          </p>

          <p class="tei-para">Once the installation has completed, you should find an app in your Applications
              folder which you can use to launch eXist.</p>
        </pb-observable></div>

        <div class="tei-section3" id="windows-installation"><pb-observable data="0,3.8.7.9.11" emit="transcription">
          <h4 class="tei-title7 title">Windows installation</h4>
          <p class="tei-para">
            On Windows download the file with the
            <span class="tei-command code">.jar</span>
            extension, e.g.
                "
            <span class="tei-filename code">exist-installer-5.x.x.jar</span>
            ".
          </p>

          <p class="tei-para">
            Double clicking the
            <span class="tei-command code">.jar</span>
            should install eXist on your local
              system. It will launch an installer to guide you through basic settings. The default
              settings suggested by the installer provide a good starting point for most
              projects.
          </p>

          <div class="tei-note3 note"><p class="tei-para">
              If double-clicking the
              <span class="tei-command code">.jar</span>
              does not have any effect, there's
                may be something wrong with your Java setup. The
              <span class="tei-filename code">java</span>
              binary
                needs to be in your
              <span class="tei--element">%PATH%</span>
              environment.
            </p><p class="tei-para">You can also try to manually start the installer by opening a command prompt,
                changing to the directory where you downloaded the distribution and typing:</p><pb-code-highlight class="tei-synopsis4" language="">java -jar exist-installer-5.x.x.jar</pb-code-highlight></div>

          <p class="tei-para">Once the installation is completed, you should find an eXist-db shortcut to launch
              eXist.</p>
        </pb-observable></div>

        <div class="tei-section3" id="unix-installation"><pb-observable data="0,3.8.7.9.13" emit="transcription">
          <h4 class="tei-title7 title">Unix installation</h4>
          <p class="tei-para">
            Download the file with the
            <span class="tei-command code">.jar</span>
            extension, e.g.
                "
            <span class="tei-filename code">exist-installer-5.x.x.jar</span>
            ".
          </p>

          <p class="tei-para">
            Double clicking the
            <span class="tei-command code">.jar</span>
            should install eXist on your local
              system. It will launch an installer to guide you through basic settings. Default
              settings suggested by the installer provide a good starting point for most projects so
              there's no need to change anything.
          </p>

          <p class="tei-para">
            Once the installation is completed, you should find an eXist-db shortcut to launch
              eXist, otherwise navigate to the installation directory and run
            <span class="tei-command code">bin/startup.sh</span>
            .
          </p>

          <div class="tei-note3 note"><p class="tei-para">
              Some
              <span class="tei-emphasis2">Linux users</span>
              may prefer the plain
              <span class="tei-command code">.tar.bz2</span>
              package, which can just be untarred to any location.
                This package does not include an installer and eXist has to be launched on the
                command line: navigate into the untarred directory and run
            </p><pb-code-highlight class="tei-synopsis4" language="">bin/startup.sh</pb-code-highlight><p class="tei-para">
              in a shell, skipping the jar installer step above. Ignore the next section,
                navigate directly to
              <a href="http://localhost:8080" class="tei-link4" target="_new">http://localhost:8080</a>
              and follow the steps for installing TEI Publisher
                via the dashboard described further below.
            </p></div>
        </pb-observable></div>

        <div class="tei-section3" id="first-launch"><pb-observable data="0,3.8.7.9.15" emit="transcription">
          <h4 class="tei-title7 title">First launch</h4>
          <p class="tei-para">Once eXist is launched for the first time you should see (with the exception of
              some Unix system configurations described above) a splash window popping up, showing
              that default applications are being installed:</p>
          <figure class="tei-figure2 figure"><span class="tei--element">
              <span class="tei--element">
                <img src="eXistSplash.png" class="tei-imagedata2" title="" style="width: 256px; ">
              </span>
            </span><figcaption>Splash Screen on eXist Startup</figcaption></figure>
          <p class="tei-para">Upon first start, an additional configuration window will pop up on Windows and
              Mac, allowing you to configure basic parameters. Default settings suggested provide a
              good starting point for most projects so usually there's no need to change anything. </p>
          <figure class="tei-figure2 figure"><span class="tei--element">
              <span class="tei--element">
                <img src="eXistInitialConfig.png" class="tei-imagedata2" title="" style="width: 512px; ">
              </span>
            </span><figcaption>Configuration Dialog Showing on First Start</figcaption></figure>
          <p class="tei-para">
            Clicking on
            <span class="tei-guibutton guibutton">Save</span>
            will show a popup asking to confirm the
              location of the data directory. Unless you have specific requirements just agree to
              the suggestion of the configuration dialog.
          </p>
          <p class="tei-para">
            <span class="tei-emphasis2">Windows users</span>
            will be asked if they would like to install
              eXist as a service. This is highly recommended to ensure that the database is
              correctly closed whenever the operating system shuts down.
          </p>
          <p class="tei-para">If all went well, eXist should now be up and running in the background. Mac and
              Windows users should find a small eXist icon in their task bar. Right-clicking on it
              will reveal a menu:</p>
          <figure class="tei-figure2 figure"><span class="tei--element">
              <span class="tei--element">
                <img src="eXistTaskbarIcon.png" class="tei-imagedata2" title="" style="width: 512px; ">
              </span>
            </span><figcaption>Taskbar Launcher Context Menu</figcaption></figure>
        </pb-observable></div>

        <div class="tei-section3" id="packageManager"><pb-observable data="0,3.8.7.9.17" emit="transcription">
          <h4 class="tei-title7 title">Installing TEI Publisher</h4>
          <p class="tei-para">
            Clicking on
            <span class="tei--element">Open Dashboard</span>
            in the taskbar will open a
              browser and display eXist's Dashboard: the central administrative hub for the
              database. Alternatively - e.g. when you chose the manual installation on Linux - you
              can also open a browser window and navigate to:
            <a href="http://localhost:8080" class="tei-link4" target="_new">http://localhost:8080</a>
            .
          </p>
          <p class="tei-para">
            Log into the dashboard using the admin account and the password you chose during
              the installation (it will be empty by default). Use the left sidebar to navigate to
              the
            <span class="tei--element">Package Manager</span>
            . You'll see two tabs: the first one
              lists the application packages currently installed, the second can be used to install
              additional packages from eXist's public application repository.
          </p>
          <p class="tei-para">
            Switch to the
            <span class="tei--element">Available</span>
            tab and search the list for TEI
              Publisher. Once you find it, click on the little install icon.
          </p>
          <p class="tei-para">After installing you will find the TEI Publisher icon in the tab showing installed
              apps. Click on it to open the TEI Publisher.</p>
          <figure class="tei-figure2 figure"><span class="tei--element">
              <span class="tei--element">
                <img src="eXistDashboard.png" class="tei-imagedata2" title="" style="width: 640px; ">
              </span>
            </span><figcaption>
              Installing
              <span class="tei-emphasis2">TEI Publisher</span>
              from the Package Manager
            </figcaption></figure>
        </pb-observable></div>
      </pb-observable></div>
      <div class="tei-section3" id="docker"><pb-observable data="0,3.8.7.11" emit="transcription">
        <h3 class="tei-title7 title">Using docker</h3>
        <p class="tei-para">
          If you do not want to install eXist yourself, you can use docker to run TEI
            Publisher. Docker is a tool to simplify the installation of applications and services.
            It creates a virtual environment including everything required for the service to run.
            Using our
          <a href="https://cloud.docker.com/u/existdb/repository/registry-1.docker.io/existdb/tei-publisher" class="tei-link4" target="_new">docker image</a>
          , eXist will already be set up to include TEI Publisher as well as
            the Shakespeare and Van Gogh demo apps.
        </p>
        <ol class="tei-procedure"><li class="tei-step">
            <p class="tei-para">
              Install
              <a href="https://www.docker.com/" class="tei-link4" target="_new">docker</a>
              on your machine. Windows and Mac users may download the
              <a href="https://www.docker.com/products/docker-desktop" class="tei-link4" target="_new">docker desktop</a>
              app.
            </p>
          </li><li class="tei-step">
            <p class="tei-para">To download the image run the following in a console</p>
            <pb-code-highlight class="tei-synopsis4" language="">docker pull existdb/teipublisher:latest</pb-code-highlight>
          </li><li class="tei-step">
            <p class="tei-para">once the download is complete, you can run the image with the following
                command:</p>
            <pb-code-highlight class="tei-synopsis4" language="">docker run -p 8081:8080 -p 8444:8443 --name teipublisher existdb/teipublisher:latest</pb-code-highlight>
            <p class="tei-para">Startup should be fast because the database is already pre-populated. However,
                changes you make may not persist if the docker container is deleted or updated to a
                newer release. If you want to be sure that your changes are safe, you should specify
                a local volume for storing the database by adding:</p>
            <pb-code-highlight class="tei-synopsis4" language="">-v exist-data:/exist-data</pb-code-highlight>
            <p class="tei-para">See below for an explanation of the parameters:</p>
            <dl><dt>-p</dt><dd>
                  <p class="tei-para">Maps a port on your local machine (8081 and 8444) to the port used by
                      eXist within the container. eXist will always run on 8080 for HTTP and 8443
                      for HTTPS. If those ports are already occupied by different services on your
                      machine, choose a different port for the first number.</p>
                </dd><dt>-v</dt><dd>
                  <p class="tei-para">
                    Creates a named ("exist-data") volume for storing the database, using the
                      directory specified after the colon. If you skip this, any changes to the
                      database will be lost if you remove the docker container, update it or create
                      a new one. With
                    <span class="tei--element">-v</span>
                    the data will be stored outside the
                      container.
                  </p>
                  <p class="tei-para">If you just intend to play around a bit, you can skip the
                      parameter.</p>
                </dd><dt>--name</dt><dd>
                  <p class="tei-para">
                    Assigns a name to the container, so you can reference it in other docker
                      commands, like
                    <span class="tei-code2 code">docker stop</span>
                    . We'll use the name in all commands
                      below.
                  </p>
                </dd></dl>
            <p class="tei-para">Once the container has started, you can access the eXist dashboard in your
                browser by navigating to</p>
            <pb-code-highlight class="tei-synopsis4" language="">http://localhost:8081</pb-code-highlight>
            <p class="tei-para">From the dashboard you can click on the TEI Publisher, Shakespeare or Van Gogh
                icons to open the corresponding applications.</p>
          </li><li class="tei-step">
            <p class="tei-para">To stop the container run</p>
            <pb-code-highlight class="tei-synopsis4" language="">docker stop teipublisher</pb-code-highlight>
          </li><li class="tei-step">
            <p class="tei-para">To start the container again:</p>
            <pb-code-highlight class="tei-synopsis4" language="">docker start teipublisher</pb-code-highlight>
            <p class="tei-para">Note that when you restart a container, it will run in detached mode, so you
                won't see any console output. You can view the output with following command
                though:</p>
            <pb-code-highlight class="tei-synopsis4" language="">docker logs teipublisher</pb-code-highlight>
          </li></ol>
        <div class="tei-section3" id="docker-other"><pb-observable data="0,3.8.7.11.9" emit="transcription">
          <h4 class="tei-title7 title">Other useful commands</h4>
          <dl><dt>docker container ps -a</dt><dd>
                <p class="tei-para">Lists all running and stopped containers</p>
              </dd><dt>docker volume ls</dt><dd>
                <p class="tei-para">Displays existing volumes (where your database is stored)</p>
              </dd><dt>docker cp teipublisher:/exist-data .</dt><dd>
                <p class="tei-para">Copy the contents of the database data volume to the current directory on
                    local disk, so you can back it up. Note that this will copy the raw database
                    files as created by eXist (not your XML, which is binary encoded inside those
                    files). Also make sure you run the command after stopping the active
                    container.</p>
              </dd><dt>docker volume rm exist-data</dt><dd>
                <p class="tei-para">Remove the contents of the database data volume (in case you would like to
                    start from scratch, deleting all changes you made).</p>
              </dd></dl>

          <p class="tei-para">
            Have a look at the docker documentation and
            <a href="https://www.docker.com/sites/default/files/Docker_CheatSheet_08.09.2016_0.pdf" class="tei-link4" target="_new">cheatsheet</a>
            for more commands.
          </p>
        </pb-observable></div>
      </pb-observable></div>
    </pb-observable></div>
    <div class="tei-section3" id="browsing"><pb-observable data="0,3.8.9" emit="transcription">
      <h2 class="tei-title7 title">Browsing Documents</h2>
      <div class="tei-section3" id="start-page"><pb-observable data="0,3.8.9.5" emit="transcription">
        <h3 class="tei-title7 title">The Start Page</h3>
        <p class="tei-para">The start page of TEI Publisher serves as an entry point to explore and
            experiment.</p>
        <p class="tei-para">On a newly installed TEI Publisher the main application panel offers the choice
            between browsing local collections directly or using DTS API to access remote resources.
            Narrower panel to the right displays the list of ODD files provided with the TEI
            Publisher.</p>

        <figure class="tei-figure2 figure"><span class="tei--element">
            <span class="tei--element">
              <img src="start-page-collections.png" class="tei-imagedata2" title="" style="width: 512px; ">
            </span>
          </span><figcaption>Start Page Collections</figcaption></figure>
        <p class="tei-para">
          The usual starting point is the
          <span class="tei-emphasis1">TEI Publisher Demo
              Collection</span>
          with which users can explore a range of
          <a href="?odd=docbook.odd&amp;view=&amp;id=selected-use-cases" class="tei-link3" target="">selected use cases</a>
          , demonstrating various genres,
            encoding styles and presentation layouts. Various customization aspects are handled
            using different ODDs and view templates. We suggest to have a look at each of them to
            see what TEI Publisher can achieve out of the box.
        </p>

        <div class="tei-note3 note"><h4 class="tei-title4">Note</h4><p class="tei-para">Documents in this collection are preinstalled with the TEI Publisher and users are
              not allowed to write to it by default.</p></div>

        <p class="tei-para">
          The
          <span class="tei-emphasis1">Playground</span>
          collection is the place to upload
            encoded documents and ODD files to experiment with various processing models and view
            templates.
        </p>

        <p class="tei-para">
          Unlike the Demo collection, the Playground features an upload box to import new
            documents. You can upload your own XML and ODD (e.g. TEI, DocBook or DOCX) documents by
            either clicking on the
          <span class="tei-code2 code">Upload</span>
          button or dragging and dropping files onto
            the upload panel. Read more on this subject in the
          <a href="?odd=docbook.odd&amp;view=&amp;id=upload" class="tei-link3" target="">Upload</a>
          section
        </p>
        <div class="tei-note3 note"><h4 class="tei-title4">Note</h4><p class="tei-para">
            You need to be
            <span class="tei-emphasis1">logged in</span>
            for most advanced
              actions like creating or editing ODDs. The login button to the right of the menu bar
              allows you to log in. By default, there's a user named
            <span class="tei-parameter code">tei-demo</span>
            with password
            <span class="tei-parameter code">demo</span>
            , and a user
            <span class="tei-parameter code">tei</span>
            with
              password
            <span class="tei-parameter code">simple</span>
            .
          </p></div>
      </pb-observable></div>
      <div class="tei-section3" id="demo-collection"><pb-observable data="0,3.8.9.7" emit="transcription">
        <h3 class="tei-title7 title">TEI Publisher Demo collection</h3>
        <p class="tei-para">
          Experiment with browsing, faceting, filtering and sorting features of TEI Publisher.
            This page consists of several main areas:
          <ol class="tei-orderedlist"><li class="tei-listitem">
              <p class="tei-para">the facets panel</p>
            </li><li class="tei-listitem">
              <p class="tei-para">the list of documents currently installed with sorting and filtering
                  controls</p>
            </li><li class="tei-listitem">
              <p class="tei-para">a panel showing the ODD files known to the application</p>
            </li><li class="tei-listitem">
              <p class="tei-para">an upload box to upload new documents</p>
            </li></ol>
        </p>

        <p class="tei-para">Have a look at documents showcased here to get a sense of possibilities that TEI
            Publisher offers. Click on document title to proceed to the Document View</p>
        <figure class="tei-figure2 figure"><span class="tei--element">
            <span class="tei--element">
              <img src="demo-collection-overview.png" class="tei-imagedata2" title="" style="width: 512px; ">
            </span>
          </span><figcaption>Browsing Demo collection</figcaption></figure>
      </pb-observable></div>
    </pb-observable></div>
    <div class="tei-section3" id="selected-use-cases"><pb-observable data="0,3.8.11" emit="transcription">
      <h2 class="tei-title7 title">Selected Use Cases</h2>
      <p class="tei-para">The document view can vary, sometimes substantially, depending on the sample document
          you are looking at. This is a natural consequence of TEI's versatility and broad scope of
          its application. What follows, requirements for the document view - both its layout and
          composition as well as processing rules governing the transformation of the text of the
          document itself - will differ to a great extent. Sample documents which are included in
          TEI Publisher's installation package do not exhaust its applications but rather aim to
          present some chosen use cases:</p>
      <ul class="tei-itemizedlist"><li class="tei-listitem">
          <p class="tei-para">
            <span class="tei-emphasis2">Critik der reinen Vernunft</span>
            from the
            <span class="tei-emphasis2">Deutsches
                Textarchiv</span>
            corpus presents a philosophical tractate, originally published
              in print, thus following 'traditional' book structure with front pages, foreword and
              chapters. It can nevertheless demonstrate very well Publisher's capacities in
              typesetting, switching between physical and logical structure of the document (just
              toggle
            <span class="tei-guibutton guibutton">Page View</span>
            in the
            <span class="tei-guibutton guibutton">Settings</span>
            panel)
              as well as generation of multiple output formats from single set of processing models
              in the ODD (try choosing
            <span class="tei-parameter code">PDF</span>
            or
            <span class="tei-parameter code">ePub</span>
            options in the
            <span class="tei-guibutton guibutton">Download</span>
            ).
            <span class="tei-emphasis2">Purchas his
                pilgrimages</span>
            , from the
            <span class="tei-emphasis2">EEBO-TCP</span>
            project, while
              roughly similar in structure is much earlier work (1613) and demonstrates extensive
              use of marginal notes.
          </p>
        </li><li class="tei-listitem">
          <p class="tei-para">
            Shakespeare's
            <span class="tei-emphasis2">Romeo and Juliet</span>
            , from
            <span class="tei-emphasis2">Bodleian First
                Folio</span>
            project uses dedicated TEI elements to encode structure of the play
              but it also showcases the parallel transcription and facsimile alignment for its
              presentation which is obviously of general application and could be used for any
              genre, not limited to dramatic texts.
          </p>
        </li><li class="tei-listitem">
          <p class="tei-para">Correspondence corpora are common, yet very interesting, subjects for digital
              editions. Despite basic similarities in structure, depending on the period, scope and
              particular research perspective, intended presentation may vary enormously. We are
              presenting samples of:</p>
          <ul class="tei-itemizedlist"><li class="tei-listitem">
              <p class="tei-para">
                A 15th century manuscript letter to
                <span class="tei-emphasis1">Mikołaj
                    Orlik</span>
                demonstrating alignment between Latin original and parallel
                  Polish translation,
              </p>
            </li><li class="tei-listitem">
              <p class="tei-para">
                A 16th century manuscript letter of
                <span class="tei-emphasis1">Hernán
                    Cortés</span>
                showcasing parallel transcription/translation and facsimile
                  view and transcription enhanced with commentaries and explicitly encoded
                  transcriptional features,
              </p>
            </li><li class="tei-listitem">
              <p class="tei-para">
                A 16th century manuscript letter of
                <span class="tei-emphasis1">Mauritius
                    Ferber</span>
                with a collapsible metadata panel in addition to the parallel
                  transcription and facsimile view,
              </p>
            </li><li class="tei-listitem">
              <p class="tei-para">
                An early 19th century manuscript collocative dictionary of Polish
                <span class="tei-emphasis1">Bogactwa mowy polskiej</span>
                featuring interactive highlights
                  for regions of interest of the facsimile when hovering over dictionary
                  headwords,
              </p>
            </li><li class="tei-listitem">
              <p class="tei-para">
                A letter from
                <span class="tei-emphasis1">Van Gogh</span>
                to Paul Gauguin
                  written in 1888. This intentionally reproduces the flexible column layout
                  pioneered by the
                <a href="http://vangoghletters.org" class="tei-link4" target="_new">Vincent Van Gogh Letters</a>
                online edition, which is a model example for
                  correspondence.
              </p>
            </li><li class="tei-listitem">
              <p class="tei-para">
                A 20th century manuscript letter from
                <span class="tei-emphasis2">Robert Graves</span>
                where
                  emphasis has been put on visualizing rich encoding of semantic information in the
                  letter, in particular geographic and prosopographical data.
              </p>
            </li></ul>
        </li></ul>
      <div class="tei-note3 note"><h4 class="tei-title4">Note</h4><p class="tei-para">The list of samples is expected to grow and we'd like to encourage contributions
            illustrating other genres and perspectives.</p><p class="tei-para">
          We'd like to stress that preparing showcases above has been only possible thanks to
            numerous projects releasing their sources openly, in particular the
          <a href="http://firstfolio.bodleian.ox.ac.uk" class="tei-link4" target="_new">Bodleian First
              Folio</a>
          ,
          <a href="http://www.deutschestextarchiv.de" class="tei-link4" target="_new">Deutsches Textarchiv</a>
          ,
          <a href="http://vangoghletters.org" class="tei-link4" target="_new">Vincent Van Gogh Museum</a>
          and
          <a href="https://www.textcreationpartnership.org/tcp-eebo" class="tei-link4" target="_new">EEBO-TCP</a>
          . We'd also like to thank William Graves and Anna Skolimowska for
            sharing their correspondence material.
        </p></div>
    </pb-observable></div>

    <div class="tei-section3" id="document-view"><pb-observable data="0,3.8.13" emit="transcription">
      <h2 class="tei-title7 title">Document View</h2>
      <p class="tei-para">The document view can vary, depending on the sample document you are looking at.
          Nevertheless some default functionality will be shared:</p>
      <ul class="tei-itemizedlist"><li class="tei-listitem">
          <p class="tei-para">
            the rightmost button in the toolbar opens the
            <span class="tei-guibutton guibutton">Settings</span>
            panel. Here you can change the ODD being used for display as well as the view template
              (more about this later). By default, all sample documents apply the specific ODD which
              fits them best, but you can play around and select another ODD to see what
              happens.
          </p>
          <figure class="tei-figure2 figure"><span class="tei--element">
              <span class="tei--element">
                <img src="odd-page-template-settings.png" class="tei-imagedata2" title="" style="width: 512px; ">
              </span>
            </span><figcaption>The Settings Panel</figcaption></figure>
        </li><li class="tei-listitem">
          <p class="tei-para">
            the leftmost toolbar button will open a
            <span class="tei-emphasis2">table of contents</span>
            (if
              the viewed document has a division structure)
          </p>
        </li><li class="tei-listitem">
          <p class="tei-para">
            the
            <span class="tei-guibutton guibutton">Download</span>
            menu allows you to download the currently
              viewed document in a variety of output formats. Not all output formats work equally
              well for all examples as we have not customized every example for every media.
          </p>
        </li></ul>
    </pb-observable></div>

    <div class="tei-section3" id="odd-experiments"><pb-observable data="0,3.8.15" emit="transcription">
      <h2 class="tei-title7 title">Experimenting with ODDs and page templates</h2>
      <p class="tei-para">
        All TEI Publisher's sample documents are TEI XML files which are transformed into a
          HTML webpage for display in the browser. Two major factors determine how the final page is
          going to look like: an
        <span class="tei-emphasis1">ODD</span>
        and a
        <span class="tei-emphasis1">page template</span>
        .
      </p>

      <p class="tei-para">
        We have already mentioned in the very first section that the TEI Processing Model lies
          at the heart of the Publisher - the ODD file associated with a document defines the rules
          of transformation of the XML source file into HTML. Detailed discussion of the Processing
          Model can be found in
        <a href="?odd=docbook.odd&amp;view=&amp;id=pm-syntax" class="tei-link3" target="">following chapters</a>
        , for now it is
          sufficient to say this is where decisions if a TEI element should be rendered inline, with
          a tooltip, or as a marginal note, are made. Simplifying things a bit the
        <span class="tei-emphasis2">text</span>
        of the document that you see rendered in your browser is an
          effect of applying the rules from ODD file to the source document.
      </p>
      <p class="tei-para">
        Nevertheless, as we demonstrated in the section on selected sample documents, in the
          application context we certainly want more than just text, however nicely typeset. From
          basic navigation controls, table of content, to facsimile display, critical apparatus,
          glossaries and maps - all of this and much more could be included in the final webpage.
          Following
        <span class="tei-emphasis2">divide and conquer</span>
        approach the TEI Publisher defines such
          specialized page elements as small, reusable blocks, using the Web Components technology.
          Components can be used like common HTML elements, thus a page template is just an HTML
          fragment which organizes the building blocks needed for a specific page.
      </p>
      <p class="tei-para">
        Looking more closely again at the TEI Publisher's
        <span class="tei-guibutton guibutton">Start</span>
        page,
          we can now give more detail what is happening when any of the sample documents is loaded.
          On the right hand side there is a panel listing all ODD files available. Each of the
          sample documents includes a processing instruction which specifies default ODD and page
          template for this document. You can check what they are in
        <span class="tei-guibutton guibutton">Settings</span>
        panel. For the Graves letter it would be
        <span class="tei-parameter code">Graves' Letters</span>
        ODD and
        <span class="tei-parameter code">Letter with map/facets</span>
        template.
      </p>
      <figure class="tei-figure2 figure"><span class="tei--element">
          <span class="tei--element">
            <img src="odd-page-template-settings.png" class="tei-imagedata2" title="" style="width: 512px; ">
          </span>
        </span><figcaption>The Settings Panel for the Graves Letter</figcaption></figure>
      <p class="tei-para">
        It is easy to experiment with different page templates and ODDs just changing these
          options in the
        <span class="tei-guibutton guibutton">Settings</span>
        panel. An important caveat though is that
          not every page template makes sense for every document - after all parallel alignment can
          only be successful if there is something to align, map needs coordinates to display, page
          view needs information about page breaks and so on.
      </p>
    </pb-observable></div>
    <div class="tei-section3" id="upload"><pb-observable data="0,3.8.17" emit="transcription">
      <h2 class="tei-title7 title">Uploading your own documents</h2>
      <p class="tei-para">
        If you read this, in all likelihood you already have some documents of your own you
          might want published, whether they are in TEI, DocBook, MS Word DOCX or other XML format.
          The first step is to upload them into the database. You need to be
        <span class="tei-emphasis1">logged in</span>
        and in the Playground area to do it (check the short info on the
        <span class="tei-guibutton guibutton">Start</span>
        page for user name and password). Then uploading is just a
          question of dragging your documents onto the
        <span class="tei-guibutton guibutton">Upload</span>
        area. They will
          become available in the document list immediately after upload is completed.
      </p>
      <figure class="tei-figure2 figure"><span class="tei--element">
          <span class="tei--element">
            <img src="upload.png" class="tei-imagedata2" title="" style="width: 512px; ">
          </span>
        </span><figcaption>The Upload Panel</figcaption></figure>
      <p class="tei-para">
        Congratulations, now you can view your documents! Try to experiment and find the ODD
          and page template that best fits your needs and use it as a starting point for your own
          customization, if necessary. Once you are ready with these you can
        <a href="?odd=docbook.odd&amp;view=&amp;id=create-app" class="tei-link3" target="">generate your own application</a>
        for your documents only, which
          packs just what is needed for publishing into a standalone application package.
      </p>
      <p class="tei-para">
        If you attempt to upload a Microsoft Word document, the upload will automatically
          trigger upconversion of Word to TEI, using a custom ODD for the tranformation. Please note
          that the focus of this conversion is to preserve textual content, structure and basic
          semantics of the text, not provide authoritative mapping of complete set of MS Word
          features to TEI. Refer to
        <a href="?odd=docbook.odd&amp;view=&amp;id=docx" class="tei-link3" target="">DOCX handling</a>
        section for more
          information.
      </p>
      <div class="tei-note3 note"><h4 class="tei-title4">Note</h4><p class="tei-para">Please bear in mind that while TEI Publisher aims to be a universal tool, the
            specific components may make certain assumptions about data they are getting and if your
            documents do not follow the same conventions it may be required to adjust parameters
            passed to the components from the page template or the component logic.</p><p class="tei-para">
          By means of example - a table of content component assumes that the document
            structure is represented by means of nested
          <span class="tei-parameter code">div</span>
          elements and
            section titles are given in
          <span class="tei-parameter code">head</span>
          element. If your project rather
            chooses numbered divisions (
          <span class="tei-parameter code">div1</span>
          ,
          <span class="tei-parameter code">div2</span>
          )
            etc it may be advisable to adjust this to avoid customizing all navigation, table of
            contents and so on, but it is one of very rare cases where TEI Publisher exposes any
            predilection for a particular flavour of TEI.
        </p><p class="tei-para">
          Similarly, the template for aligned transcription and translation is parametrized to
            accept an XPath expression pointing to the location of the transcription and aligned
            translation. Likely for your documents this expression would have to be adjusted (unless
            of course you also have Latin texts with Polish translation structured in a similar
            way). Furthermore, to correctly display corresponding translation fragment a custom
            mapping function may need to be passed to the translation view (cf.
          <span class="tei-link2"><pb-edit-xml path="/db/apps/tei-publisher/templates/pages/vangogh.html">
            <span class="tei-filename code">Van
              Gogh</span>
          <iron-icon icon="icons:open-in-new"></iron-icon></pb-edit-xml></span>
          or
          <span class="tei-link2"><pb-edit-xml path="/db/apps/tei-publisher/templates/pages/cortez.html">
            <span class="tei-filename code">Cortés</span>
          <iron-icon icon="icons:open-in-new"></iron-icon></pb-edit-xml></span>
          letter templates for examples)
        </p></div>
    </pb-observable></div>
  </pb-observable></div>

  <div class="tei-section3" id="supported-input-formats"><pb-observable data="0,3.10" emit="transcription">
    <h1 class="tei-title7 title">Supported XML vocabularies</h1>
    <p class="tei-para">TEI Publisher started as a publishing toolbox for TEI but the principles of TEI
        Processing Model were never limited to a single vocabulary. Publisher very quickly extended
        support to other XML formats. Currently TEI, DocBook, JATS and MS Word DOCX are supported
        out of the box (DOCX via automated conversion to TEI on upload).</p>
    <p class="tei-para">
      Few specificities of
      <span class="tei-emphasis2">TEI</span>
      and
      <span class="tei-emphasis2">DocBook</span>
      are
        listed below, while
      <span class="tei-emphasis2">DOCX</span>
      is discussed at length in the following
        section.
    </p>
    <p class="tei-para"></p>
    <div class="tei-section3" id="format-tei"><pb-observable data="0,3.10.11" emit="transcription">
      <h2 class="tei-title7 title">TEI</h2>
      <p class="tei-para">In principle, any TEI document will be supported by TEI Publisher and can be displayed
          with the default page template and odd.</p>
      <p class="tei-para">Nevertheless, certain assumptions are made about encoding of the basic structure of
          the TEI documents for the purpose of navigation:</p>
      <ul class="tei-itemizedlist"><li class="tei-listitem">
          <p class="tei-para">
            page beginnings are encoded with
            <span class="tei-tag code">pb</span>
          </p>
        </li><li class="tei-listitem">
          <p class="tei-para">
            column beginnings are encoded with
            <span class="tei-tag code">cb</span>
          </p>
        </li><li class="tei-listitem">
          <p class="tei-para">
            structural divisions in the document are encoded with
            <span class="tei-tag code">div</span>
            elements
          </p>
        </li></ul>
      <p class="tei-para">
        We acknowledge that TEI offers other ways to encode these features, e.g. generic
        <span class="tei-tag code">milestone</span>
        element or specialized numbered division elements like
        <span class="tei-tag code">div1</span>
        ,
        <span class="tei-tag code">div2</span>
        . TEI documents using alternative encodings will be
          still displayed as specified in the ODD, it is only for the sake of navigation or
          division-based full text search that we had to assume certain conventions to be able to
          decide what to show as the next page, column or division.
      </p>
      <p class="tei-para">
        We believe our choice represents most common way of using TEI but, for those who
          followed the path less travelled, the chapter on
        <a href="?odd=docbook.odd&amp;view=&amp;id=new-vocabulary-navigation" class="tei-link3" target="">customization</a>
        briefly discusses how to change relevant functionality.
      </p>
    </pb-observable></div>

    <div class="tei-section3" id="format-docbook"><pb-observable data="0,3.10.13" emit="transcription">
      <h2 class="tei-title7 title">DocBook</h2>
      <p class="tei-para">
        DocBook support is demonstrated by this very document you are now reading,
        <span class="tei-filename code">documentation.xml</span>
        . It is written in DocBook and presented via
          dedicated
        <span class="tei-filename code">docbook.odd</span>
        and
        <span class="tei-filename code">documentation.html</span>
        page template.
      </p>
      <p class="tei-para">
        You will notice a custom processing instruction in the source code of this document
          which specifies which ODD and template to use. Experiment changing the template and ODD
          via
        <span class="tei-guibutton guibutton">Settings</span>
        drawer to see how much impact it has on
          display.
      </p>
      <pb-code-highlight class="tei-programlisting5" language="xml" line-numbers="line-numbers">
          &lt;?teipublisher odd="docbook.odd" template="documentation.html" depth="3"?&gt;
        </pb-code-highlight>
    </pb-observable></div>


    <div class="tei-section3" id="docx"><pb-observable data="0,3.10.15" emit="transcription">
      <h2 class="tei-title7 title">MS Word DOCX format conversion</h2>
      <p class="tei-para">
        Starting with the version 5.0.0 of the TEI Publisher a new docx handling module is
          available to allow for ingesting documents in
        <span class="tei-emphasis2">docx</span>
        format. Goal of
          this module is to provide a way to import Word documents, preserving their textual
          content, structure and basic semantics of the text, not to provide an authoritative
          mapping of complete set of MS Word features to TEI.
      </p>
      <p class="tei-para">Docx format is relatively flat, thus reconstructing logical document structure like
          divisions, lists and similar can be only based on certain heuristics. Likewise it is
          impossible to deduce semantics attributed to certain formatting decisions. For that reason
          TEI Publisher by intention ignores many style properties — trying to preserve as much as
          possible would likely just add unnecessary "noise" and result in low-quality TEI. </p>


      <div class="tei-section3" id="docx-intro"><pb-observable data="0,3.10.15.9" emit="transcription">
        <h3 class="tei-title7 title">A word about Word</h3>

        <p class="tei-para">
          A Word document is essentially a zip archive of several different XML files. These
            files store various parts - the text content, styles, embedded media files etc.
            Information most relevant for the import process have been extracted into a map, which
            is passed as a parameter to the ODD, so it is available for every element. Thus
            information about numbering styles can be accessed via
          <span class="tei-code2 code">$parameters?nstyle(.)</span>
          function and testing if a list is bulleted could be
            done checking the value of
          <span class="tei-code2 code">$parameters?nstyle(.)/numFmt/@w:val</span>
          . Full list
            of available functions and some hints how to customize default conversion ODD are
            provided at the
          <a href="?odd=docbook.odd&amp;view=&amp;id=docx-functions" class="tei-link3" target="">end of this chapter</a>
          .
        </p>
        <figure class="tei-figure2 figure"><span class="tei--element">
            <span class="tei--element">
              <img src="wordStructure.png" class="tei-imagedata2" title="" style="width: 212px; ">
            </span>
          </span><figcaption>MS Word archive structure</figcaption></figure>

        <dl><dt>Named tei:* styles</dt><dd>
              <p class="tei-para">
                Named styles can be strong indicators for the semantics of the text fragment.
                  Styles whose name starts with
                <span class="tei-code2 code">tei:</span>
                are thus recognized as TEI
                  elements with the same name. If a character sequence uses a style called
                <span class="tei-code2 code">tei:persName</span>
                , it will be wrapped into a TEI
                <span class="tei-tag code">persName</span>
                element in the output, e.g.
                <span class="tei-code2 code">&lt;persName&gt;Johann Wolfgang
                    Goethe&lt;/persName&gt;</span>
                . A place name should be marked with a style
                <span class="tei-code2 code">tei:placeName</span>
                and reconstructed text could be encoded by applying a
                  style
                <span class="tei-code2 code">tei:supplied</span>
                .
              </p>
            </dd><dt>Headings and divisions</dt><dd>
              <p class="tei-para"> Since Word does not have a concept for text division, instead storing just
                  flat lists of paragraphs, so the only way to reconstruct the logical structure is
                  to use Word headings and outline level associated with these to determine division
                  boundaries. </p>
              <p class="tei-para">
                In the first pass, all paragraph styles starting with
                <span class="tei-code2 code">heading</span>
                ,
                <span class="tei-code2 code">title</span>
                or
                <span class="tei-code2 code">subtitle</span>
                generate a
                <span class="tei-tag code">tei:head</span>
                element. The outline level assigned to the heading is recorded as well.
              </p>
              <p class="tei-para">
                Subsequently, in a second pass through the generated output, divisions are
                  generated based on the outline level: a
                <span class="tei-tag code">div</span>
                spans all text from the
                  heading to the next heading on the same outline level and the process is repeated
                  for all headings within the division on a lower outline level.
              </p>
            </dd><dt>Lists</dt><dd>
              <p class="tei-para">
                Lists structure needs to be reconstructed, very much like divisions, taking
                  into consideration the list level associated with every item which can be accessed
                  via a call to
                <span class="tei-code2 code">$parameters?pstyle(.)//outlineLvl/@w:val</span>
                .
              </p>
            </dd><dt> Foot- and endnotes</dt><dd>
              <p class="tei-para">
                Footnotes are translated into TEI note elements. Endnotes are also supported
                  and transformed into
                <span class="tei-code2 code">&lt;note type="endnote"&gt;</span>
                .
              </p>
            </dd><dt>Tables</dt><dd>
              <p class="tei-para"> Processing of simple tables works very well as well as cells spanning
                  multiple colums. Row spans are not implemented yet. </p>
            </dd><dt>Images</dt><dd>
              <p class="tei-para">
                Embedded images are stored into a subcollection starting with the name of the
                  docx file being processed and suffixed with
                <span class="tei-code2 code">.media</span>
                , eg.
                <span class="tei-code2 code">&lt;graphic url="test.docx.media/image1.png"/&gt;</span>
              </p>
            </dd></dl>
      </pb-observable></div>

      <div class="tei-section3" id="docx-functions"><pb-observable data="0,3.10.15.11" emit="transcription">
        <h3 class="tei-title7 title">ODD for docx</h3>
        <p class="tei-para">
          The ODD used for docx processing can be found in
          <span class="tei-link2"><pb-edit-xml path="/db/apps/tei-publisher/odd/docx.odd">docx.odd<iron-icon icon="icons:open-in-new"></iron-icon></pb-edit-xml></span>
          . Users are free to extend the default ODD with
            additional heuristics. For example, a paragraph being entirely bold could also be
            treated as a heading, or a left text indent may indicate a quote.
        </p>
        <p class="tei-para">
          For testing purposes there is a Word document provided in
          <span class="tei-filename code">data/doc/test.docx</span>
          which includes samples of most important
            features like headings, lists, tables, notes and embedded images. Try uploading it via
            upload panel as described in the
          <a href="?odd=docbook.odd&amp;view=&amp;id=upload" class="tei-link3" target="">upload section</a>
          and check
            the conversion results. Behaviour of the conversion mostly follows the approach used in
            TEI Stylesheets docx-to-tei transformation module and has been tested on test files
            included there.
        </p>

        <div class="tei-section3" id="docx-functions-parameters"><pb-observable data="0,3.10.15.11.9" emit="transcription">
          <h4 class="tei-title7 title">Parameter functions</h4>
          <p class="tei-para">
            Functions below can be used to retrieve styles or other information related to a
              current node. For more usage examples see
            <span class="tei-link2"><pb-edit-xml path="/db/apps/tei-publisher/odd/docx.odd">docx.odd<iron-icon icon="icons:open-in-new"></iron-icon></pb-edit-xml></span>
          </p>

          <dl><dt>cstyle</dt><dd>
                <p class="tei-para">phrase level (characters, words or phrases) styles associated with the
                    current node</p>
                <p class="tei-para">
                  Returns:
                  <span class="tei-code2 code">w:style</span>
                </p>
                <p class="tei-para">
                  Usage example:
                  <span class="tei-code2 code">$parameters?cstyle(.)/name[starts-with(@w:val,
                      'tei:')]</span>
                </p>
              </dd><dt>endnote</dt><dd>
                <p class="tei-para">content of the endnote</p>
                <p class="tei-para">
                  Returns:
                  <span class="tei-code2 code">w:endnote/w:p</span>
                </p>
              </dd><dt>footnote</dt><dd>
                <p class="tei-para">content of the footnote</p>
                <p class="tei-para">
                  Returns:
                  <span class="tei-code2 code">w:footnote/w:p</span>
                </p>
              </dd><dt>link</dt><dd>
                <p class="tei-para">external link</p>
                <p class="tei-para">
                  Returns:
                  <span class="tei-code2 code">rel:Relationship</span>
                </p>
                <p class="tei-para">
                  Usage example:
                  <span class="tei-code2 code">$parameters?link(.)/@Target</span>
                </p>
              </dd><dt>nstyle</dt><dd>
                <p class="tei-para">list style information associated with the current node</p>
                <p class="tei-para">
                  Returns:
                  <span class="tei-code2 code">w:lvl</span>
                </p>
                <p class="tei-para">
                  Usage example:
                  <span class="tei-code2 code">$parameters?nstyle(.)/numFmt</span>
                </p>
              </dd><dt>pstyle</dt><dd>
                <p class="tei-para">paragraph level styles associated with the current node</p>
                <p class="tei-para">
                  Returns:
                  <span class="tei-code2 code">w:style</span>
                </p>
                <p class="tei-para">
                  Usage example:
                  <span class="tei-code2 code">$parameters?pstyle(.)/name[matches(@w:val, 'quote';,
                      'i')]</span>
                </p>
              </dd></dl>
        </pb-observable></div>
      </pb-observable></div>
    </pb-observable></div>
  </pb-observable></div>
  <div class="tei-section3" id="odd-customization"><pb-observable data="0,3.12" emit="transcription">
    <h1 class="tei-title7 title">Processing Model transformations</h1>
    <p class="tei-para">While TEI Publisher already provides various ODDs and page templates targeting specific
        domains, it is likely that your project may require certain adjustments to fully meet your
        needs. It has been one of primary concerns in Publisher's design that customization is not
        only possible on various levels but also encouraged and we aim it to be as simple as
        possible.</p>
    <p class="tei-para">
      Very broadly we can group customization needs into two sets: changing the rules for
        document transformation (how the source document is translated into the output format) or
        changing the organization and styling of the rendered web page. In this chapter we'll
        concentrate on the former, document transformation, which primarily requires modification of
        the ODD with the
      <a href="?odd=docbook.odd&amp;view=&amp;id=pm-syntax" class="tei-link3" target="">TEI Processing Model</a>
      . The latter would
        require
      <a href="?odd=docbook.odd&amp;view=&amp;id=customizing-page-template" class="tei-link3" target="">adjustments of the page template</a>
      .
        In both cases, it may be best to choose as your starting point an already existing ODD or
        page template and adjust it.
    </p>
    <div class="tei-section3" id="odd-customization-details"><pb-observable data="0,3.12.9" emit="transcription">
      <h2 class="tei-title7 title">ODD Customization</h2>
      <div class="tei-section3" id="odd-customization-first-odd"><pb-observable data="0,3.12.9.5" emit="transcription">
        <h3 class="tei-title7 title">Creating Your First ODD</h3>
        <p class="tei-para">
          The general workflow for creating a customization is as follows:
          <ol class="tei-orderedlist"><li class="tei-listitem">
              <p class="tei-para">upload a TEI sample document you want to format</p>
            </li><li class="tei-listitem">
              <p class="tei-para">create a new ODD</p>
            </li><li class="tei-listitem">
              <p class="tei-para">modify the ODD to match your requirements</p>
            </li></ol>
        </p>
        <p class="tei-para">
          For the purpose of this quickstart, we will reuse one of the pre-installed sample
            documents, but create a new ODD for it (while we will start from scratch with an empty
            ODD, it is also possible to generate one based on one or more
          <a href="?odd=docbook.odd&amp;view=&amp;id=odd-by-example" class="tei-link3" target="">sample TEI documents</a>
          ):
        </p>
        <ol class="tei-procedure"><li class="tei-step">
            <p class="tei-para">
              Log in and fill out the form at the bottom of the panel listing ODD files.
                Choose a name for the ODD, e.g.
              <span class="tei--element">myletter</span>
              (without a suffix) and a
                title, which will appear in the list after creation. Click on
              <span class="tei-guibutton guibutton">Create</span>
              (not
              <span class="tei-guibutton guibutton">Create from
                examples</span>
              ).
            </p>
            <p class="tei-para">The newly created ODD should appear in the side panel.</p>
          </li><li class="tei-step">
            <p class="tei-para">
              In the document list, click on
              <span class="tei-emphasis2">Letter #6 from Robert Graves to William
                  Graves</span>
              to open it in the document viewer.
            </p>
          </li><li class="tei-step">
            <p class="tei-para">
              Open the
              <span class="tei-guibutton guibutton">Settings</span>
              panel (rightmost toolbar button, see
                above) and choose your ODD from the dropdown showing available ODDs. You may also
                change the used HTML template to
              <span class="tei--element">Default single text layout</span>
              , though
                this is not absolutely necessary.
            </p>
          </li><li class="tei-step">
            <p class="tei-para">
              The view should change and display the letter's content with only basic
                formatting applied. Since our ODD has just been created and is empty, we see the
                content with standard formatting applied. Our ODD by default inherits from
              <span class="tei-filename code">teipublisher.odd</span>
              , which likewise extends
              <span class="tei-filename code">tei_simplePrint.odd</span>
              . The latter is maintained by the TEI
                community and contains processing model declarations for the most important TEI
                elements. Thanks to this inheritance mechanism, many documents display nicely
                without requiring a lot of additional customization.
            </p>
          </li><li class="tei-step">
            <p class="tei-para">
              From the menu, select
              <span class="tei--element">Admin</span>
              /
              <span class="tei--element">Edit
                  ODD</span>
              to open the visual ODD editor.
            </p>
          </li></ol>
      </pb-observable></div>
      <div class="tei-section3" id="modify-odd"><pb-observable data="0,3.12.9.7" emit="transcription">
        <h3 class="tei-title7 title">Modify the ODD</h3>
        <p class="tei-para">
          Changing processing models in the ODD is a powerful mechanism through which you can
            control all aspects of the transformation of your documents from source XML format to
            all output formats: HTML, ePUB, PDF etc. As already mentioned it is considered best
            practice to chain ODD customizations together and rather change or add project specific
            rules to more generic ODD than copy them in extenso. ODD chaining allows for the future
            upgrades as your base ODDs may be updated by standardization bodies which maintain them.
            Commonly project ODDs would extend
          <span class="tei-filename code">teipublisher.odd</span>
          , a generic TEI
            Publisher set of processing rules.
        </p>
        <p class="tei-para">Beginning with version 3.0 of TEI Publisher, you have the choice between writing the
            ODD by hand or using a visual editor. Both approaches can be combined and mixed. The
            visual editor saves the ODD in a non-destructive way, preserving any information not
            related to the processing model. It is thus safe to switch between hand-editing the ODD
            and using the visual editor. Just make sure you reload the visual editor view after
            modifying the source XML and vice versa. That said, visual editor is specifically
            tailored to editing processing models so it will be likely the fastest and safest way to
            edit your ODD.</p>
        <p class="tei-para">To be able to customize the display of your document it is crucial to understand its
            XML structure well. Each of processing models needs to be aimed at a particular XML
            element and sometimes is only meant for a specific XML context - let's say we might want
            to distinguish between headings of first and second level of nested divisions as they
            often represent titles of different text units: acts and scenes or books and
            chapters.</p>
        <p class="tei-para">We'll start with the Graves' letter you have already viewed applying your custom ODD
            in previous section. The display is quite simple and easy to read but we might want to
            adjust it to follow common visual conventions for a letter, starting with displaying the
            dateline on the right hand side and completely removing the page label which currently
            sits there.</p>
        <p class="tei-para"> To create a processing model addressing this need we have to know 3 things: </p>
        <ul class="tei-itemizedlist"><li class="tei-listitem">
            <p class="tei-para">
              <span class="tei-emphasis1">when</span>
              should it be applied,
            </p>
          </li><li class="tei-listitem">
            <p class="tei-para">
              <span class="tei-emphasis1">what</span>
              is supposed to happen
            </p>
          </li><li class="tei-listitem">
            <p class="tei-para">
              and
              <span class="tei-emphasis1">how</span>
              should the text be formatted?
            </p>
          </li></ul>
        <p class="tei-para">
          To be able to answer the first question, you should familiarize yourself with the
            XML structure of the letter to find out how datelines are represented in TEI. In the tab
            displaying the letter, select
          <span class="tei--element">Download</span>
          /
          <span class="tei--element">XML
            </span>
          to open
          <span class="tei-link2"><pb-edit-xml path="/db/apps/tei-publisher/data/test/graves6.xml">
            <span class="tei-filename code">graves6.xml</span>
          <iron-icon icon="icons:open-in-new"></iron-icon></pb-edit-xml></span>
          in eXide. Quick investigation of the TEI encoding will reveal that dateline
            resides in its eponymic tag
          <span class="tei-tag code">dateline</span>
          wchich is nested in the
          <span class="tei-tag code">opener</span>
          part of the document, while page labels are encoded with
          <span class="tei-tag code">pb</span>
          .
        </p>
        <p class="tei-para">
          We'll use the visual editor, but show the corresponding ODD XML below each
            screenshot. At the end of this chapter we'll describe how to edit the ODD XML code
          <a href="?odd=docbook.odd&amp;view=&amp;id=oddxml" class="tei-link3" target="">by hand</a>
          .
        </p>
      </pb-observable></div>

      <div class="tei-section3" id="visualodd"><pb-observable data="0,3.12.9.9" emit="transcription">
        <h3 class="tei-title7 title">First Steps</h3>
        <p class="tei-para">
          The visual ODD editor opens if you select
          <span class="tei--element">Admin</span>
          /
          <span class="tei--element">Edit ODD</span>
          from the menu while viewing a document.
            Alternatively you can click on the name of an ODD in the list of ODDs on the TEI
            Publisher entry page. A new tab opens, showing an action panel to the left, and the
            title of your ODD to the right.
        </p>
        <div class="tei-note3 note"><h4 class="tei-title4">Note</h4><p class="tei-para">
            <span class="tei-emphasis2">Most recent versions of the ODD editor will look slightly different,
                nevertheless they are functionally equivalent to the screenshots below, created in
                an earlier version.</span>
          </p></div>
        <p class="tei-para">
          We need to overwrite the processing model rules for
          <span class="tei-tag code">dateline</span>
          . Enter
          <span class="tei-parameter code">dateline</span>
          into the input box next to the
          <span class="tei-guibutton guibutton">New</span>
          button in the left panel and click the button. This will
            insert a processing model rule for
          <span class="tei-tag code">dateline</span>
          into the right panel. Because
          <span class="tei-tag code">dateline</span>
          already exist in the base ODD,
          <span class="tei-filename code">tei_simplePrint.odd</span>
          , you'll see a single model which was copied
            from the base ODD.
        </p>
        <figure class="tei-figure2 figure"><span class="tei--element">
            <span class="tei--element">
              <img src="editor-screen1.png" class="tei-imagedata2" title="">
            </span>
          </span><figcaption>
            Screen after adding
            <span class="tei-tag code">dateline</span>
          </figcaption></figure>
        <p class="tei-para">The corresponding ODD XML looks like this:</p>
        <pb-code-highlight class="tei-programlisting5" language="xml" line-numbers="line-numbers">&lt;elementSpec mode="change" ident="dateline"&gt;
    &lt;model behaviour="block"/&gt;
&lt;/elementSpec&gt;</pb-code-highlight>
        <p class="tei-para">
          Let's cover some key concepts of the TEI processing model first:
          <span class="tei-tag code">elementSpec</span>
          primarily documents the structure, content, and purpose of an
            element. It is a core element in any ODD but the schema-related functions are not
            relevant for the discussion here. What is important for us is this is where processing
            models are defined. The
          <span class="tei-parameter code">@ident</span>
          attribute of the
          <span class="tei-tag code">elementSpec</span>
          identifies the name of the element to which the spec (and
            therefore processing model) applies.
        </p>
        <p class="tei-para">
          An
          <span class="tei-tag code">elementSpec</span>
          may contain one or more
          <span class="tei-tag code">model</span>
          elements to
            specify the intended processing of this element. Every model maps the element to a
          <span class="tei--element">behaviour</span>
          . A behaviour denotes an abstract transformation function to
            be applied. The TEI guidelines currently list two dozen behaviours, e.g. paragraph,
            heading, note, inline, block. The last two are the most frequently used. How exactly a
            behaviour translates into the target output media may differ depending on media features
            and design decisions. TEI Publisher tries to implement them as generically as
            possible.
        </p>
        <p class="tei-para">
          To change the model expand it by clicking on the arrow to the left of the grey box.
            A form appears, allowing you to change the model configuration. In our example we are
            happy with
          <span class="tei-emphasis2">what</span>
          is happening with the dateline, so we don't need to
            change the behaviour but we do want to fix
          <span class="tei-emphasis2">how</span>
          it is styled by
            justifying it to the right. Rendition can be defined in an
          <span class="tei-tag code">outputRendition</span>
          ,
            so click on the
          <span class="tei-guibutton guibutton">+</span>
          button next to
          <span class="tei-guibutton guibutton">Renditions</span>
          . In the form input being inserted below, enter your
            styling requirements in css.
        </p>
        <p class="tei-para">
          The processing model uses
          <span class="tei-tag code">outputRendition</span>
          and CSS to define visual
            aspects. For output formats other than XML, the CSS is translated into the corresponding
            target language. It is thus best to limit the CSS to the most common typographical
            features, like bold, italic, color, underline etc. The general styling of the text
            should be done outside the ODD to maintain a clear separation of concerns.
        </p>
        <figure class="tei-figure2 figure"><span class="tei--element">
            <span class="tei--element">
              <img src="editor-screen2.png" class="tei-imagedata2" title="">
            </span>
          </span><figcaption>
            Add a rendition for
            <span class="tei-tag code">dateline</span>
          </figcaption></figure>
        <p class="tei-para">Again here's the corresponding XML:</p>
        <pb-code-highlight class="tei-programlisting5" language="xml" line-numbers="line-numbers">&lt;elementSpec mode="change" ident="dateline"&gt;
  &lt;model behaviour="block"&gt;
      &lt;outputRendition&gt;text-align: right;&lt;/outputRendition&gt;
  &lt;/model&gt;
&lt;/elementSpec&gt;</pb-code-highlight>
        <p class="tei-para">
          To test your change, click on
          <span class="tei-guibutton guibutton">Save</span>
          in the left panel and wait
            a second until a popup appears. Switch back to the tab with Graves' letter from which
            you opened the editor and refresh the browser window to see your changes applied. In
            case you do not see any change, make sure
        </p>
        <ol class="tei-orderedlist"><li class="tei-listitem">
            <p class="tei-para">
              you selected the correct ODD for viewing (check the
              <span class="tei-guibutton guibutton">Settings</span>
              drawer)
            </p>
          </li><li class="tei-listitem">
            <p class="tei-para">
              if you made changes to outputRenditions only, you may need to clear your
                browser's cached version. For most browsers, holding the
              <span class="tei-emphasis2">Shift</span>
              key while clicking on the
              <span class="tei-emphasis2">Reload</span>
              button does the job.
            </p>
          </li></ol>
      </pb-observable></div>
      <div class="tei-section3" id="odd-customization-other-behaviours"><pb-observable data="0,3.12.9.11" emit="transcription">
        <h3 class="tei-title7 title">Other behaviours</h3>
        <p class="tei-para">
          We would also like to hide the page breaks as we do not have facsimiles available.
            Add a new element spec for
          <span class="tei-tag code">pb</span>
          . Again the newly added spec already includes a
            model with behaviour
          <span class="tei--element">break</span>
          . Just change this behaviour to
          <span class="tei--element">omit</span>
          or delete the existing model and insert a fresh one with
            behaviour
          <span class="tei--element">omit</span>
          .
        </p>
        <figure class="tei-figure2 figure"><span class="tei--element">
            <span class="tei--element">
              <img src="editor-screen3.png" class="tei-imagedata2" title="">
            </span>
          </span><figcaption>
            Omit
            <span class="tei-tag code">pb</span>
          </figcaption></figure>
        <pb-code-highlight class="tei-programlisting5" language="xml" line-numbers="line-numbers">&lt;elementSpec mode="change" ident="pb"&gt;
  &lt;model behaviour="omit"/&gt;
&lt;/elementSpec&gt;</pb-code-highlight>
      </pb-observable></div>
      <div class="tei-section3" id="odd-customization-predicates"><pb-observable data="0,3.12.9.13" emit="transcription">
        <h3 class="tei-title7 title">Predicates and multiple models</h3>
        <p class="tei-para">
          Next up, we may want to highlight the various places and people occurring within the
            text. They are all marked up with the
          <span class="tei-tag code">name</span>
          tag, using different
          <span class="tei--element">@type</span>
          attributes. Create a new element spec for
          <span class="tei-tag code">name</span>
          and
            supply some color to the names.
        </p>
        <figure class="tei-figure2 figure"><span class="tei--element">
            <span class="tei--element">
              <img src="editor-screen4.png" class="tei-imagedata2" title="">
            </span>
          </span><figcaption>
            Color the
            <span class="tei-tag code">name</span>
            tags
          </figcaption></figure>
        <p class="tei-para">
          And the XML for the entire
          <span class="tei-tag code">elementSpec</span>
          :
        </p>
        <pb-code-highlight class="tei-programlisting5" language="xml" line-numbers="line-numbers">&lt;elementSpec ident="name" mode="change"&gt;
    &lt;model behaviour="inline"&gt;
        &lt;outputRendition&gt;
        color: #FF9900;
        &lt;/outputRendition&gt;
    &lt;/model&gt;
&lt;/elementSpec&gt;</pb-code-highlight>
        <p class="tei-para">
          This rule affects places and people alike since both these categories are marked up
            with
          <span class="tei-tag code">name</span>
          tag. If we'd like to treat people and places differently we'd need
            separate models for them and a mechanism to distinguish between the two. The processing
            model uses
          <span class="tei--element">predicate</span>
          to make such distinctions: a model rule will only
            be used if the XPath expression in its predicate matches the current node being
            processed. Let's add another model and give it a predicate:
        </p>
        <figure class="tei-figure2 figure"><span class="tei--element">
            <span class="tei--element">
              <img src="editor-screen5.png" class="tei-imagedata2" title="">
            </span>
          </span><figcaption>Distinguish places and people</figcaption></figure>
        <pb-code-highlight class="tei-programlisting5" language="xml" line-numbers="line-numbers">&lt;elementSpec ident="name" mode="change"&gt;
    &lt;model predicate="@type='place'" behaviour="inline"&gt;
        &lt;outputRendition &gt;
        color: #0077FF;
        &lt;/outputRendition&gt;
    &lt;/model&gt;
    &lt;model behaviour="inline"&gt;
        &lt;outputRendition&gt;
        color: #FF9900;
        &lt;/outputRendition&gt;
    &lt;/model&gt;
&lt;/elementSpec&gt;</pb-code-highlight>
        <div class="tei-note3 note"><h4 class="tei-title4">Important</h4><p class="tei-para">The order of models within the element spec is important. If you move the model
              with the predicate to the bottom, all names will appear in the same color again. This
              happens because the processor walks through the models until it finds the first one
              matching the current node. If the model without predicate is first, it will always win
              over the one with the predicate!</p><p class="tei-para">Also, if there's more than one matching model, only the first will be
              chosen.</p></div>
      </pb-observable></div>
      <div class="tei-section3" id="odd-customization-parameters"><pb-observable data="0,3.12.9.15" emit="transcription">
        <h3 class="tei-title7 title">Parameters</h3>
        <p class="tei-para">
          All behaviours accept one or more parameters which are defined in the TEI
            guidelines. Every behaviour has an implicit parameter called
          <span class="tei-parameter code">content</span>
          , and, as the name suggests, it specifies which part of
            the source document should be processed: by default it uses the nested content of the
            node. You may overwrite this default and assign it another value. Some behaviours take
            other specialized parameters. For example, the
          <span class="tei-parameter code">alternate</span>
          behaviour accepts two parameters:
          <span class="tei-parameter code">default</span>
          and
          <span class="tei-parameter code">alternate</span>
          . An alternate switches between two alternative
            states. On the web this could take the form of a popup, in print it is usually
            implemented as a footnote.
        </p>
        <p class="tei-para">
          To put this to a test, let's look at the
          <span class="tei-tag code">date</span>
          elements appearing within
            the letter. Most of them also specify a normalized date in their
          <span class="tei-parameter code">@when</span>
          attribute. Seeing this may be helpful for the reader, for
            example, to know that the
          <span class="tei-parameter code">19th</span>
          mentioned in the postscript refers
            to
          <span class="tei-parameter code">1957-12-19</span>
          . However, we may want to present the normalized
            date in a more readable way. XPath has a function
          <span class="tei-function code">format-date</span>
          for
            the purpose and we could use it to show a representation of the date nicely formatted in
            the user's language.
        </p>
        <p class="tei-para">
          Add a new element spec for
          <span class="tei-tag code">date</span>
          . You'll already see 4 predefined models.
            The first two are for print only, but the third one does indeed use behaviour
          <span class="tei-function code">alternate</span>
          , which is exactly what we want. Change the parameter
            value for
          <span class="tei-parameter code">alternate</span>
          to format the date:
        </p>
        <figure class="tei-figure2 figure"><span class="tei--element">
            <span class="tei--element">
              <img src="editor-screen6.png" class="tei-imagedata2" title="">
            </span>
          </span><figcaption>
            Format the normalized date in
            <span class="tei-parameter code">@when</span>
          </figcaption></figure>
        <pb-code-highlight class="tei-programlisting5" language="xml" line-numbers="line-numbers">&lt;elementSpec ident="date" mode="change"&gt;
    &lt;model output="print" predicate="text()" behaviour="inline"/&gt;
    &lt;model output="print" predicate="@when and not(text())" behaviour="inline"&gt;
        &lt;param name="content" value="@when"/&gt;
    &lt;/model&gt;
    &lt;model output="web" predicate="@when" behaviour="alternate"&gt;
        &lt;param name="default" value="."/&gt;
        &lt;param name="alternate" value="format-date(@when, '[FNn], [D1o] [MNn], [Y]')"/&gt;
    &lt;/model&gt;
    &lt;model predicate="text()" behaviour="inline"/&gt;
&lt;/elementSpec&gt;</pb-code-highlight>
      </pb-observable></div>
      <div class="tei-section3" id="odd-customization-screencast"><pb-observable data="0,3.12.9.17" emit="transcription">
        <h3 class="tei-title7 title">Screencast</h3>
        <p class="tei-para">The screencast below recapitulates some of the modifications we just applied. It
            uses an older version of TEI Publisher, but the basic concepts and controls are still
            the same:</p>
        <figure class="tei-figure2 figure" id="edit-odd"><span class="tei--element">
            <span class="tei--element">
              <iframe src="https://www.youtube.com/embed/avRO-b2BwUI?rel=0" width="853" height="480" frameborder="0" gesture="media" allow="encrypted-media" allowfullscreen="allowfullscreen"></iframe>
            </span>
          </span><figcaption>Screencast</figcaption></figure>
      </pb-observable></div>
      <div class="tei-section3" id="oddxml"><pb-observable data="0,3.12.9.19" emit="transcription">
        <h3 class="tei-title7 title">Edit the ODD XML by hand</h3>
        <p class="tei-para">
          To switch to the XML source code of the currently edited ODD from within the visual
            editor, click on the button with the angle brackets in the toolbar of the left side
            panel. If you made changes in the form, you need to save first to update the ODD. The
            ODD XML will be opened in a new tab, showing eXist's browser-based editor,
          <span class="tei-emphasis1">eXide</span>
          .
        </p>
        <p class="tei-para">
          While using
          <span class="tei-emphasis1">eXide</span>
          is sufficient for small edits, we
            really recommend using specialized XML editor like
          <span class="tei-emphasis1">oXygen</span>
          for serious work on your TEI files. It will help you with many
            tasks, starting with the syntax and documentation. You can edit ODDs stored in eXist
            using Oxygen's
          <span class="tei-emphasis2">webdav</span>
          support or the
          <span class="tei-emphasis2">eXist data
              source</span>
          function.
        </p>
        <div class="tei-note3 note"><h4 class="tei-title4">Important</h4><p class="tei-para">
            If you edit the ODD XML by hand, there are some caveats you need to be aware of:
              the visual editor will automatically check if there are existing
            <span class="tei-tag code">elementSpec</span>
            s for a new element in any of the ODDs your ODD inherits from.
              When editing by hand, you need to do this yourself. It's best to always have the base
              ODDs:
            <span class="tei-link2"><pb-edit-xml path="/db/apps/tei-publisher/odd/tei_simplePrint.odd">
              <span class="tei-filename code">tei_simplePrint.odd</span>
            <iron-icon icon="icons:open-in-new"></iron-icon></pb-edit-xml></span>
            and
            <span class="tei-link2"><pb-edit-xml path="/db/apps/tei-publisher/odd/teipublisher.odd">
              <span class="tei-filename code">teipublisher.odd</span>
            <iron-icon icon="icons:open-in-new"></iron-icon></pb-edit-xml></span>
            open on the side. Both are located in the same collection as your odd, i.e.
            <span class="tei-filename code">/db/apps/tei-publisher/odd</span>
            .
          </p><p class="tei-para">
            For example, to modify the element spec for
            <span class="tei-tag code">dateline</span>
            , check
            <span class="tei-filename code">tei_simplePrint.odd</span>
            , where you'll find a definition already.
              Copy it over to your ODD and start modifying it.
          </p><p class="tei-para">
            Pay attention to the
            <span class="tei--element">@mode</span>
            attribute on
            <span class="tei-tag code">elementSpec</span>
            .
              You must set this to
            <span class="tei-parameter code">change</span>
            if you are overwriting an
              elementSpec which already exists in the inherited ODDs. If not, set it to
            <span class="tei-parameter code">add</span>
            .
          </p></div>
        <p class="tei-para">
          To test any changes, switch back to the tab in which you viewed your document (e.g.
            Graves' letter) and select
          <span class="tei-guibutton guibutton">Admin</span>
          /
          <span class="tei-guibutton guibutton">Recompile
              ODD</span>
          from the menu.
        </p>
      </pb-observable></div>
    </pb-observable></div>

    <div class="tei-section3" id="pm-syntax"><pb-observable data="0,3.12.11" emit="transcription">
      <h2 class="tei-title7 title">Processing Model Syntax</h2>
      <p class="tei-para">TEI gives users a lot of freedom: there's always more than one way to encode your
          material! To maintain interoperability and sustainability, you need a way to formally
          describe the schema used as well as document editorial guidelines and transcription
          processes. TEI ODD was designed for the purpose of expressing all this in the TEI language
          itself. But how a document should be rendered was previously still considered to be the
          responsibility of external publishing software and could not be described within the
          ODD.</p>
      <p class="tei-para">
        The advent of the TEI Processing Model changed this! The intended processing for all
          elements can now be expressed within the TEI vocabulary as part of the ODD thus fulfilling
          its promise of
        <span class="tei-emphasis1">One Document Does It All</span>
        . Markup elements
          are mapped to a small set of abstract transformation functions, called
        <span class="tei-emphasis1">behaviours</span>
        . Basic styling features can be set directly within the
          ODD using CSS. The processing model is media-agnostic: behaviours and rendition styles are
          transparently translated into different output media types like HTML, XSL-FO, LaTeX, or
          ePUB. A single ODD can handle a multitude of output media types with just a few small
          adjustments.
      </p>
      <div class="tei-section3" id="pm-syntax-model"><pb-observable data="0,3.12.11.9" emit="transcription">
        <h3 class="tei-title7 title">
          <span class="tei-tag code">model</span>
          element
        </h3>
        <p class="tei-para">
          <span class="tei-tag code">model</span>
          element is primarily used to document the intended processing for a
            given element. One or more of these elements may appear directly within an
          <span class="tei-tag code">elementSpec</span>
          element specification to define the processing anticipated for
            that element. Where multiple
          <span class="tei-tag code">model</span>
          elements appear, they are understood to
            document mutually exclusive processing scenarios, possibly for different outputs or
            applicable in different contexts.
        </p>
        <p class="tei-para">
          A processing model defines on an abstract level how a given element may be
            transformed to produce one or more outputs. The model is expressed in terms of
          <span class="tei-emphasis1">behaviours</span>
          and their parameters, using high-level formatting
            concepts, such as
          <span class="tei-parameter code">block</span>
          ,
          <span class="tei-parameter code">inline</span>
          ,
          <span class="tei-parameter code">note</span>
          or
          <span class="tei-parameter code">heading</span>
          . A processing model is
            thus a template description, used to generate the code needed by the publishing
            application to process the source document into required output.
        </p>
        <p class="tei-para">
          The example below depicts a situation where a single model is defined for the
          <span class="tei-tag code">app</span>
          element. As no
          <span class="tei-parameter code">@predicate</span>
          or
          <span class="tei-parameter code">@output</span>
          are specified, this model applies for all contexts in
            which
          <span class="tei-tag code">app</span>
          may appear and all possible outputs. Thus all
          <span class="tei-tag code">app</span>
          elements will be transformed into inline chunks of text containing only contents of
          <span class="tei-tag code">app</span>
          's
          <span class="tei-tag code">lem</span>
          child and omitting any possible
          <span class="tei-tag code">rdg</span>
          children.
        </p>
        <pb-code-highlight class="tei-programlisting5" language="xml" line-numbers="line-numbers">&lt;elementSpec mode="change" ident="app"&gt;
  &lt;model behaviour="inline"&gt;
    &lt;param name="content" value="lem"/&gt;
  &lt;/model&gt;
&lt;/elementSpec&gt;</pb-code-highlight>
        <div class="tei-section3" id="pm-syntax-model-children"><pb-observable data="0,3.12.11.9.13" emit="transcription">
          <h4 class="tei-title7 title">
            <span class="tei-tag code">model</span>
            children and attributes:
          </h4>
          <p class="tei-para">
            <ul class="tei-itemizedlist"><li class="tei-listitem">
                <p class="tei-para">
                  <span class="tei-parameter code">@predicate</span>
                  : the condition under which this model applies,
                    given as an XPath Predicate Expression
                </p>
              </li><li class="tei-listitem">
                <p class="tei-para">
                  <span class="tei-parameter code">@behaviour</span>
                  : names the function which this processing
                    model uses in order to produce output; possible values include: alternate,
                    block, figure, heading, inline, link, list, note, paragraph
                </p>
              </li><li class="tei-listitem">
                <p class="tei-para">
                  <span class="tei-parameter code">@output</span>
                  : identifier of the intended output for which this
                    model applies; applies to all output if no @output is present on a
                  <span class="tei-tag code">model</span>
                </p>
              </li><li class="tei-listitem">
                <p class="tei-para">
                  <span class="tei-parameter code">@useSourceRendition</span>
                  : whether to obey any rendition
                    attribute which is present in the source document
                </p>
              </li><li class="tei-listitem">
                <p class="tei-para">
                  <span class="tei-parameter code">@cssClass</span>
                  : one or more CSS class names which should be
                    added to the resulting output element where applicable
                </p>
              </li><li class="tei-listitem">
                <p class="tei-para">
                  <span class="tei-tag code">param</span>
                  : allows to pass parameters to @behaviour function; parameters
                    available depend on the behaviour in question; when parameters are not
                    explicitly passed, default values for those are assumed; all behaviour functions
                    use current element as default content
                </p>
              </li><li class="tei-listitem">
                <p class="tei-para">
                  <span class="tei-tag code">outputRendition</span>
                  : supplies information about the desired output
                    rendition in CSS; its attribute @scope provides a way of defining
                    ‘pseudo-elements’ eg: first-line, first-letter, before, after
                </p>
              </li></ul>
          </p>
          <p class="tei-para">
            Model explicitly specifying content parameter: for
            <span class="tei-tag code">app</span>
            entries only
              content of its
            <span class="tei-tag code">lem</span>
            child is to be displayed (as an inline chunk of
              text):
          </p>
          <pb-code-highlight class="tei-programlisting5" language="xml" line-numbers="line-numbers">&lt;elementSpec mode="change" ident="app"&gt;
  &lt;model behaviour="inline"&gt;
    &lt;param name="content" value="lem"/&gt;
  &lt;/model&gt;
&lt;/elementSpec&gt;</pb-code-highlight>
          <p class="tei-para">
            Model specifying output rendition: contents of
            <span class="tei-tag code">ex</span>
            elements are to be
              displayed in italic and wrapped in parentheses:
          </p>
          <pb-code-highlight class="tei-programlisting5" language="xml" line-numbers="line-numbers">&lt;elementSpec mode="change" ident="ex"&gt;
  &lt;model behaviour="inline"&gt;
    &lt;outputRendition&gt;font-style: italic;&lt;/outputRendition&gt;
    &lt;outputRendition scope="before"&gt;
      content:"(";&lt;/outputRendition&gt;
    &lt;outputRendition scope="after"&gt;content:")";&lt;/outputRendition&gt;
  &lt;/model&gt;
&lt;/elementSpec&gt;</pb-code-highlight>
          <p class="tei-para">
            Sometimes different processing models are required for the same element in
              different contexts. For example, we may wish to process the
            <span class="tei-tag code">quote</span>
            element
              as an inline italic element when it appears inside a
            <span class="tei-tag code">p</span>
            element, but as an
              indented block when it appears elsewhere. To achieve this, we need to change the
              specification for the
            <span class="tei-tag code">quote</span>
            element to include two
            <span class="tei-tag code">model</span>
            elements as follows:
          </p>
          <pb-code-highlight class="tei-programlisting5" language="xml" line-numbers="line-numbers">&lt;elementSpec mode="change" ident="quote"&gt;
  &lt;model predicate="ancestor::p" behaviour="inline"&gt;
    &lt;outputRendition&gt;font-style: italic;&lt;/outputRendition&gt;
  &lt;/model&gt;
  &lt;model behaviour="block"&gt;
    &lt;outputRendition&gt;
      left-margin: 2em;
    &lt;/outputRendition&gt;
  &lt;/model&gt;
&lt;/elementSpec&gt;</pb-code-highlight>
          <p class="tei-para">
            The first processing model will be used only for
            <span class="tei-tag code">quote</span>
            elements which
              match the XPath expression given as value for the
            <span class="tei-parameter code">@predicate</span>
            attribute. Other element occurrences will use the second processing model. Set of
              multiple
            <span class="tei-tag code">model</span>
            statements is regarded as an alternation and only the first
              model with
            <span class="tei-parameter code">@predicate</span>
            matching current context is
              applied.
          </p>
        </pb-observable></div>
        <div class="tei-section3" id="model-styling"><pb-observable data="0,3.12.11.9.15" emit="transcription">
          <h4 class="tei-title7 title">
            <span class="tei-tag code">model</span>
            output styling
          </h4>
          <p class="tei-para">The intended rendering for a particular behaviour of a processing model may be
              specified in one or all of the three following ways.</p>

          <ul class="tei-itemizedlist"><li class="tei-listitem">
              <p class="tei-para">
                the
                <span class="tei-parameter code">@cssClass</span>
                attribute may be used to specify the name
                  of a CSS style in an associated CSS stylesheet (read more on
                <a href="?odd=docbook.odd&amp;view=&amp;id=external-css" class="tei-link3" target="">specifying CSS styles in the ODD</a>
                ) which is to be
                  applied to each occurrence of a specified element found (in a given context, for a
                  specified output),
              </p>
            </li><li class="tei-listitem">
              <p class="tei-para">
                the attribute
                <span class="tei-parameter code">@useSourceRendition</span>
                may be used to
                  indicate that the rendition specified in the source document should be applied,
              </p>
            </li><li class="tei-listitem">
              <p class="tei-para">
                the styling to be applied may be specified explicitly as content of a child
                <span class="tei-tag code">outputRendition</span>
                element.
              </p>
            </li></ul>
          <p class="tei-para"> When more than one of these options is used, they are understood to be combined
              in accordance with the rules for multiple declaration of the styling language used. </p>
          <p class="tei-para">
            It is strongly recommended that use
            <span class="tei-tag code">outputRendition</span>
            should be limited
              to strictly editorial decisions, such as 'conjectures are to be displayed in square
              brackets' and not as means to record all typesetting and layout specific design
              choices. The latter are discussion in the
            <a href="?odd=docbook.odd&amp;view=&amp;id=css-styling" class="tei-link3" target="">Custom CSS
                styling</a>
            chapter.
          </p>
          <p class="tei-para">
            The processing model library translates the CSS styles into the target media
              format. Restrictions apply due to differences between the output formats. Not all CSS
              properties are supported for every format. Please refer to the section on
            <a href="?odd=docbook.odd&amp;view=&amp;id=output-media" class="tei-link3" target="">Output media settings</a>
            for further information.
          </p>


        </pb-observable></div>
      </pb-observable></div>
      <div class="tei-section3" id="pm-syntax-modelSequence"><pb-observable data="0,3.12.11.11" emit="transcription">
        <h3 class="tei-title7 title">
          <span class="tei-tag code">modelSequence</span>
          and
          <span class="tei-tag code">modelGrp</span>
        </h3>
        <p class="tei-para">
          Summary of elements that can be used to document one or more processing models for
            a given element:
          <ul class="tei-itemizedlist"><li class="tei-listitem">
              <p class="tei-para">
                <span class="tei-tag code">model</span>
                describes the processing intended for a specific context
              </p>
            </li><li class="tei-listitem">
              <p class="tei-para">
                <span class="tei-tag code">modelSequence</span>
                (sequence of processing models) a group of model elements
                  documenting intended processing models for this element, to be acted upon in
                  sequence
              </p>
            </li><li class="tei-listitem">
              <p class="tei-para">
                <span class="tei-tag code">modelGrp</span>
                (processing model group) a group of model elements documenting
                  intended processing models for this element
              </p>
            </li></ul>
        </p>
        <p class="tei-para">
          The
          <span class="tei-tag code">modelGrp</span>
          element may be used to group alternative
          <span class="tei-tag code">model</span>
          elements intended for a single kind of output. The
          <span class="tei-tag code">modelSequence</span>
          element is
            provided for the case where a sequence of models is to be processed, functioning as a
            single unit. Common use case would be to use modelSequence to generate table of contents
            along with the reading text as shown in the example below:
        </p>
        <pb-code-highlight class="tei-programlisting5" language="xml" line-numbers="line-numbers">&lt;elementSpec mode="change" ident="body"&gt;
  &lt;modelSequence&gt;
    &lt;model behaviour="index"&gt;
      &lt;param name="type" value="'toc'"/&gt;
    &lt;/model&gt;
    &lt;model behaviour="block"/&gt;
  &lt;/modelSequence&gt;
&lt;/elementSpec&gt;</pb-code-highlight>
      </pb-observable></div>

      <div class="tei-section3" id="behaviours"><pb-observable data="0,3.12.11.13" emit="transcription">
        <h3 class="tei-title7 title">Behaviours</h3>
        <p class="tei-para">
          The
          <a href="http://www.tei-c.org/release/doc/tei-p5-doc/en/html/ref-model.html" class="tei-link4" target="_new">TEI
              guidelines</a>
          document a number of default behaviours. TEI Publisher allows users
            to add their own behaviours, either within the ODD itself or by writing
          <a href="?odd=docbook.odd&amp;view=&amp;id=extension-modules" class="tei-link3" target="">XQuery code</a>
          . The following section lists the
            default behaviours.
        </p>
        <div class="tei-section3" id="behaviours-available"><pb-observable data="0,3.12.11.13.7" emit="transcription">
          <h4 class="tei-title7 title">Available Behaviours</h4>
          <p class="tei-para">
            Behaviour functions accept a range of parameters, depending on the function in
              question. Where these parameters are left unspecified in the
            <span class="tei-tag code">model</span>
            , default
              values are used. All functions take at least one parameter:
            <span class="tei-parameter code">content</span>
            . It will be added by default unless specified and
              contains the nested content of the currently processed node. You may change this by
              explicitely setting a
            <span class="tei-parameter code">content</span>
            parameter inside the
              model.
          </p>
          <p class="tei-para">
            In the parameter lists below we skip the
            <span class="tei-parameter code">content</span>
            parameter
              as it is available for every behaviour. Optional parameters are marked as
            <span class="tei-emphasis2">optional</span>
            in parenthesis, followed by the output mode they apply
              for, if relevant.
          </p>
          <dl><dt>alternate</dt><dd>
                <p class="tei-para">Display alternating elements for displaying the preferred version and an
                    alternative, both at once or by some method of toggling between the two. The
                    concrete implementation depends on the output format.</p>
                <table class="tei-informaltable table"><tr class="tei-tr">
                      <td class="tei-td1">Parameter</td>
                      <td class="tei-td1">Description</td>
                    </tr><tr class="tei-tr">
                      <td class="tei-td2">default</td>
                      <td class="tei-td2">the content to display by default</td>
                    </tr><tr class="tei-tr">
                      <td class="tei-td2">alternate</td>
                      <td class="tei-td2">alternate content</td>
                    </tr><tr class="tei-tr">
                      <td class="tei-td2">persistent</td>
                      <td class="tei-td2">(optional, web) show a persistent popup on click instead of a tooltip on
                          hover if parameter evaluates to an effective boolean value of true</td>
                    </tr></table>
              </dd><dt>anchor</dt><dd>
                <p class="tei-para">Create an anchor to which you can link, identified by the given id.</p>
                <table class="tei-informaltable table"><tr class="tei-tr">
                      <td class="tei-td1">Parameter</td>
                      <td class="tei-td1">Description</td>
                    </tr><tr class="tei-tr">
                      <td class="tei-td2">id</td>
                      <td class="tei-td2">the id</td>
                    </tr></table>
              </dd><dt>block</dt><dd>
                <p class="tei-para">Create a block structure, usually a div in HTML or fo:block in fo.</p>
              </dd><dt>body</dt><dd>
                <p class="tei-para">Create the body of a document. In HTML this will result in a &lt;body&gt;
                    tag.</p>
              </dd><dt>break</dt><dd>
                <p class="tei-para">Create a line, column, or page break according to type.</p>
                <table class="tei-informaltable table"><tr class="tei-tr">
                      <td class="tei-td1">Parameter</td>
                      <td class="tei-td1">Description</td>
                    </tr><tr class="tei-tr">
                      <td class="tei-td2">type</td>
                      <td class="tei-td2">e.g. "page", "column", "line"</td>
                    </tr><tr class="tei-tr">
                      <td class="tei-td2">label</td>
                      <td class="tei-td2">e.g. "p. 13v"</td>
                    </tr></table>
              </dd><dt>cell</dt><dd>
                <p class="tei-para">Create a table cell. If the @cols or @rows attribute is specified, the cell
                    may span several columns/rows.</p>
              </dd><dt>cit</dt><dd>
                <p class="tei-para">Show a citation, with an indication of the source.</p>
                <table class="tei-informaltable table"><tr class="tei-tr">
                      <td class="tei-td1">Parameter</td>
                      <td class="tei-td1">Description</td>
                    </tr><tr class="tei-tr">
                      <td class="tei-td2">source</td>
                      <td class="tei-td2">the citation source</td>
                    </tr></table>
              </dd><dt>document</dt><dd>
                <p class="tei-para">Start a new output document.</p>
              </dd><dt>figure</dt><dd>
                <p class="tei-para">Make a figure with provided title argument as caption</p>
                <table class="tei-informaltable table"><tr class="tei-tr">
                      <td class="tei-td1">Parameter</td>
                      <td class="tei-td1">Description</td>
                    </tr><tr class="tei-tr">
                      <td class="tei-td2">title</td>
                      <td class="tei-td2">a caption</td>
                    </tr></table>
              </dd><dt>graphic</dt><dd>
                <p class="tei-para">Display the graphic retrieved from the given url.</p>
                <table class="tei-informaltable table"><tr class="tei-tr">
                      <td class="tei-td1">Parameter</td>
                      <td class="tei-td1">Description</td>
                    </tr><tr class="tei-tr">
                      <td class="tei-td2">url</td>
                      <td class="tei-td2">the url to load the graphic from</td>
                    </tr><tr class="tei-tr">
                      <td class="tei-td2">width</td>
                      <td class="tei-td2">the width of the graphic, e.g. "300px", "50%" ...</td>
                    </tr><tr class="tei-tr">
                      <td class="tei-td2">height</td>
                      <td class="tei-td2">the height of the graphic, e.g. "300px", "50%" ...</td>
                    </tr><tr class="tei-tr">
                      <td class="tei-td2">scale</td>
                      <td class="tei-td2">a scaling factor to apply. If specified, width and height will be output
                          as percentage based on the scaling factor, which should be a number
                          between 0 and 1.</td>
                    </tr><tr class="tei-tr">
                      <td class="tei-td2">title</td>
                      <td class="tei-td2">a title for the graphics element. Usually not shown directly.</td>
                    </tr></table>
              </dd><dt>heading</dt><dd>
                <p class="tei-para">Creates a heading.</p>
                <table class="tei-informaltable table"><tr class="tei-tr">
                      <td class="tei-td1">Parameter</td>
                      <td class="tei-td1">Description</td>
                    </tr><tr class="tei-tr">
                      <td class="tei-td2">level</td>
                      <td class="tei-td2">the structural level of this heading. In HTML mode, this translates to
                          &lt;h1&gt;, &lt;h2&gt; etc.</td>
                    </tr></table>
              </dd><dt>inline</dt><dd>
                <p class="tei-para">Outputs an inline element.</p>
              </dd><dt>link</dt><dd>
                <p class="tei-para">Create a hyperlink.</p>
                <table class="tei-informaltable table"><tr class="tei-tr">
                      <td class="tei-td1">Parameter</td>
                      <td class="tei-td1">Description</td>
                    </tr><tr class="tei-tr">
                      <td class="tei-td2">uri</td>
                      <td class="tei-td2">the link url</td>
                    </tr><tr class="tei-tr">
                      <td class="tei-td2">target</td>
                      <td class="tei-td2">identifier of the tab to open the link in (only web output)</td>
                    </tr></table>
              </dd><dt>list</dt><dd>
                <p class="tei-para">
                  Creates an ordered or unordered list, depending on the type attribute (e.g.
                  <span class="tei-parameter code">type="ordered"</span>
                  ). If a label is present before each
                    item, a description list is output instead, using the label as definition
                    term.
                </p>
                <table class="tei-informaltable table"><tr class="tei-tr">
                      <td class="tei-td1">Parameter</td>
                      <td class="tei-td1">Description</td>
                    </tr><tr class="tei-tr">
                      <td class="tei-td2">type</td>
                      <td class="tei-td2">
                        The type of list: use "ordered" for an enumerated list, or "custom" to
                          specify item labels in combination with the
                        <span class="tei--element">n</span>
                        parameter
                          on each
                        <span class="tei-command code">listItem</span>
                        . The default is "unordered" for a list
                          of bullet points.
                      </td>
                    </tr></table>
              </dd><dt>listItem</dt><dd>
                <p class="tei-para">Outputs an item in a list.</p>
                <table class="tei-informaltable table"><tr class="tei-tr">
                      <td class="tei-td1">Parameter</td>
                      <td class="tei-td1">Description</td>
                    </tr><tr class="tei-tr">
                      <td class="tei-td2">n</td>
                      <td class="tei-td2">a label to use for the item</td>
                    </tr></table>
              </dd><dt>metadata</dt><dd>
                <p class="tei-para">Outputs a metadata section, e.g. a &lt;head&gt; in HTML.</p>
              </dd><dt>note</dt><dd>
                <p class="tei-para">
                  create a note, often out of line, depending on the value of
                  <span class="tei-code2 code">place</span>
                  ; could be "margin", "footnote", "endnote", "inline"
                </p>
                <table class="tei-informaltable table"><tr class="tei-tr">
                      <td class="tei-td1">Parameter</td>
                      <td class="tei-td1">Description</td>
                    </tr><tr class="tei-tr">
                      <td class="tei-td2">place</td>
                      <td class="tei-td2">defines the placement of the note, e.g. "margin", "footnote" ...</td>
                    </tr><tr class="tei-tr">
                      <td class="tei-td2">label</td>
                      <td class="tei-td2">the label to use for the footnote reference, usually a number.</td>
                    </tr></table>
              </dd><dt>omit</dt><dd>
                <p class="tei-para"> Do nothing, skip this element, do not process children </p>
              </dd><dt>paragraph</dt><dd>
                <p class="tei-para"> Create a paragraph. </p>
              </dd><dt>row</dt><dd>
                <p class="tei-para"> Create a table row. </p>
              </dd><dt>section</dt><dd>
                <p class="tei-para">Create a new section in the output document. In HTML mode, this translates
                    to a &lt;section&gt; element being output.</p>
              </dd><dt>table</dt><dd>
                <p class="tei-para">Create a table.</p>
              </dd><dt>text</dt><dd>
                <p class="tei-para">Output literal text.</p>
              </dd><dt>title</dt><dd>
                <p class="tei-para">Output the document title. In HTML mode, this creates a &lt;title&gt;
                    element. In LaTeX, it adds the title to the document metadata.</p>
              </dd><dt>webcomponent (TEI Publisher extension)</dt><dd>
                <p class="tei-para">
                  Outputs a custom HTML element (usually referencing a webcomponent) using the
                    value of parameter
                  <span class="tei-parameter code">name</span>
                  as tag name. All other parameters
                    are copied into corresponding attributes (properties of the
                    webcomponent).
                </p>
                <table class="tei-informaltable table"><tr class="tei-tr">
                      <td class="tei-td1">Parameter</td>
                      <td class="tei-td1">Description</td>
                    </tr><tr class="tei-tr">
                      <td class="tei-td2">name</td>
                      <td class="tei-td2">the tag name to use for the custom element. Must be a string value.</td>
                    </tr></table>
              </dd></dl>
        </pb-observable></div>
      </pb-observable></div>

    </pb-observable></div>

    <div class="tei-section3" id="external-css"><pb-observable data="0,3.12.13" emit="transcription">
      <h2 class="tei-title7 title">Including General CSS Styles</h2>
      <p class="tei-para">
        TEI Publisher is based on webcomponents, therefore styling of one document will not
          interfere with the styling of another document on the same page. All styles are strictly
          encapsulated within the component and do not "pollute" the global browser space. This also
          has a downside though: CSS rules defined outside the
        <span class="tei-tag code">pb-view</span>
        have no influence
          on the text styling inside the component (with some exceptions, mainly for properties
          which are inherited down the HTML tree, e.g.
        <span class="tei-parameter code">font-family</span>
        ).
      </p>
      <p class="tei-para">
        However, putting
        <span class="tei-emphasis2">all</span>
        styling information into
        <span class="tei-tag code">outputRendition</span>
        tags within the ODD is also not a good idea - it adds a lot
          of redundancy and mixes editorial responsibilities with web design concerns.
      </p>
      <p class="tei-para">
        The recommended solution would therefore be to use CSS classes for repeating styling
          aspects. TEI Publisher supports linking to an external CSS stylesheet from the
        <span class="tei-code2 code">encodingDesc/tagsDecl/rendition</span>
        section of the ODD. Just specify a relative
          link in the
        <span class="tei-parameter code">@source</span>
        attribute:
      </p>
      <pb-code-highlight class="tei-programlisting5" language="xml" line-numbers="line-numbers">
                  &lt;rendition source="docbook.css"/&gt;
          </pb-code-highlight>
      <p class="tei-para">The file should be stored in the same collection as the source ODD it is referenced
          from. The linked file should be a standard CSS stylesheet.</p>
      <p class="tei-para">Note that unfortunately, editing renditions is not yet supported by the visual ODD
          editor, so you will have to fall back to add the corresponding elements to the ODD by
          hand.</p>
      <p class="tei-para">
        Alternatively, one may also use the same TEI element
        <span class="tei-tag code">rendition</span>
        with the
        <span class="tei-parameter code">@selector</span>
        attribute to embed CSS rules directly in the
          ODD.
      </p>

      <pb-code-highlight class="tei-programlisting5" language="xml" line-numbers="line-numbers">&lt;rendition selector="h3"&gt;
  font-family: serif;
  font-weight: 400;
&lt;/rendition&gt;</pb-code-highlight>
      <p class="tei-para">Choose one of the two approaches, but do not mix them. In both cases make sure to
          recompile the ODD after changes as the CSS is merged into the generated code!</p>

      <p class="tei-para">
        New addition in Publisher 6.0 allows to pass the external CSS file in
        <span class="tei-code2 code">load-css</span>
        attribute of
        <span class="tei-code2 code">pb-view</span>
        . Recompiling ODD in this case is
          not necessary, otherwise it is functionally equivalent to using ODD
        <span class="tei-code2 code">rendition</span>
        .
      </p>
    </pb-observable></div>

    <div class="tei-section3" id="output-media"><pb-observable data="0,3.12.15" emit="transcription">
      <h2 class="tei-title7 title">Output Media Settings</h2>
      <p class="tei-para">
        The library supports various output media formats and translates styles into the
          corresponding format. Currently the following output modes are supported and can be used
          in the
        <span class="tei-parameter code">@output</span>
        attribute:
      </p>
      <dl><dt>web</dt><dd>
            <p class="tei-para">Produces HTML output</p>
          </dd><dt>fo</dt><dd>
            <p class="tei-para">Generates a PDF via XSL:FO</p>
          </dd><dt>latex</dt><dd>
            <p class="tei-para">Creates a PDF via LaTeX</p>
          </dd><dt>print</dt><dd>
            <p class="tei-para">Extends web output with a focus on Print and Paged Media</p>
          </dd><dt>epub</dt><dd>
            <p class="tei-para">A specialization of the web output mode targetted at epub documents</p>
          </dd></dl>
      <p class="tei-para">The quality of the generated output may vary a lot for the fo and latex modes,
          depending on the type of input document. The following section provides more details on
          the configuration of the FO output option:</p>
      <div class="tei-section3" id="output-media-fo"><pb-observable data="0,3.12.15.11" emit="transcription">
        <h3 class="tei-title7 title">FO Output</h3>
        <p class="tei-para">When generating XSL:FO output, the implementation tries to translate the CSS rules
            specified for renditions into the corresponding XSL:FO formatting properties. Not all
            CSS properties are recognized or can be mapped to FO properties. Unknown properties
            defined in a rendition will be ignored.</p>
        <p class="tei-para">The default rendering for headings, paragraphs and the like is defined by a separate
            CSS file. The implementation merges those defaults with the custom renditions given in
            the ODD.</p>
        <p class="tei-para">
          The library searches for default CSS styles in a file named
          <span class="tei-filename code">&lt;odd-name&gt;.fo.css</span>
          inside the specified output collection
            (in which the generated XQuery files are stored). The style definitions are copied
            literally into attributes on the output XSL:FO elements, so any property which is a
            valid attribute for the corresponding element may be used. For example,
          <span class="tei-filename code">teipublisher.fo.css</span>
          contains:
        </p>
        <pb-code-highlight class="tei-programlisting5" language="css" line-numbers="line-numbers">
.tei-text { font-family: "Junicode"; hyphenate: true; }
.tei-floatingText { padding: 6pt; }
.tei-p { text-align: justify; }
        </pb-code-highlight>
        <p class="tei-para">Every XSL:FO document needs a master layout and a page sequence definition. Because
            those tend to be rather verbose as they include things like page margins etc., they are
            read from two XML files:</p>
        <dl><dt>master.fo.xml</dt><dd>
              <p class="tei-para">Contains the layout master set</p>
            </dd><dt>page-sequence.fo.xml</dt><dd>
              <p class="tei-para">Defines the main page sequence</p>
            </dd></dl>
        <p class="tei-para">The mechanisms for configuring FO output are still very much under development and
            we welcome suggestions by users.</p>
      </pb-observable></div>
      <div class="tei-section3" id="output-media-latex"><pb-observable data="0,3.12.15.13" emit="transcription">
        <h3 class="tei-title7 title">LaTeX Output</h3>
        <p class="tei-para">The latex output mode produces good results for longer texts which fit well into the
            pre-defined LaTeX environments. The number of supported CSS properties is limited
            though:</p>
        <ul class="tei-itemizedlist"><li class="tei-listitem">
            <p class="tei-para">font-weight</p>
          </li><li class="tei-listitem">
            <p class="tei-para">font-style</p>
          </li><li class="tei-listitem">
            <p class="tei-para">font-variant</p>
          </li><li class="tei-listitem">
            <p class="tei-para">font-size</p>
          </li><li class="tei-listitem">
            <p class="tei-para">color</p>
          </li><li class="tei-listitem">
            <p class="tei-para">text-decoration</p>
          </li><li class="tei-listitem">
            <p class="tei-para">text-align</p>
          </li><li class="tei-listitem">
            <p class="tei-para">text-indent</p>
          </li></ul>
        <p class="tei-para">
          To create arbitary complex LaTeX output, you may want to use the
          <a href="?odd=docbook.odd&amp;view=&amp;id=pb-template" class="tei-link3" target="">
            <span class="tei-tag code">pb-template</span>
            extension
          </a>
          to the ODD syntax. It is
            heavily used to e.g. generate the LaTeX version of this documentation. See also
          <span class="tei-link2"><pb-edit-xml path="/db/apps/tei-publisher/odd/serafin.odd">serafin.odd<iron-icon icon="icons:open-in-new"></iron-icon></pb-edit-xml></span>
          or
          <span class="tei-link2"><pb-edit-xml path="/db/apps/tei-publisher/odd/vangogh.odd">vangogh.odd<iron-icon icon="icons:open-in-new"></iron-icon></pb-edit-xml></span>
          for examples.
        </p>
        <p class="tei-para">
          TEI Publisher creates a default LaTeX prolog based on standard packages and
            settings. You may overwrite the defaults by providing your own template within the ODD
            element spec for the TEI root element. See the example ODDs mentioned above. Note that
            TEI Publisher will generate some LaTeX macros for styles defined in
          <span class="tei-tag code">outputRendition</span>
          which should be imported into the prolog. The styles are
            added to the default configuration map and can be accessed via
          <span class="tei-command code">$config('latex-styles')</span>
          . Refer to the example ODDs and just
            copy/paste the corresponding lines.
        </p>
        <p class="tei-para">
          This output mode requires a local installation of LaTeX on the machine running TEI
            Publisher. The examples have been tested on a default installation of MacTeX 2018. If
            you are not running MacTeX, you likely need to adjust the path to the LaTeX binary in
            the XQuery configuration module
          <span class="tei-filename code">modules/config.xqm</span>
          . Search for the
            variable
          <span class="tei-parameter code">$config:tex-command</span>
          and adjust it to point to a binary
            of
          <span class="tei-command code">xelatex</span>
          ,
          <span class="tei-command code">pdflatex</span>
          or
          <span class="tei-command code">lualatex</span>
          .
        </p>
      </pb-observable></div>
      <div class="tei-section3" id="output-media-epub"><pb-observable data="0,3.12.15.15" emit="transcription">
        <h3 class="tei-title7 title">ePub Output</h3>
        <p class="tei-para">
          The
          <span class="tei-parameter code">epub</span>
          output mode extends the HTML mode. You may define
            general styling in an extra CSS file, located in
          <span class="tei-filename code">resources/css/epub.css</span>
          . This external stylesheet is included into
            all generated epub files and may be used to configure general settings like page breaks,
            hyphenation, font sizes etc.
        </p>
      </pb-observable></div>
      <div class="tei-section3" id="output-print-css"><pb-observable data="0,3.12.15.17" emit="transcription">
        <h3 class="tei-title7 title">Print CSS</h3>
        <p class="tei-para">This output mode targets printed HTML. Browser support for the corresponding CSS specifications is not very good, but there are various tools to improve this. If you select the print CSS download option for any of the documents in TEI Publisher, which support it, you will be directed to a preview page. This page uses a library called <a href="https://pagedjs.org/" class="tei-link5" target="">paged.js</a> to "teach" the browser how to handle certain layout aspects. Thanks to this, using the <span class="tei-command code">print page</span> dialog of your browser will result in a much nicer page layout than if you just tried to print TEI Publisher's document view.</p>
        <p class="tei-para">The preview page uses TEI Publisher's <span class="tei-code2 code">pb-print-preview</span> web component. This component will retrieve the full HTML of the document, enhanced with additional CSS stylesheets for print, and passes it to paged.js for the page formatting. For testing purposes you can also click on the bottom-most button with the <span class="tei-guibutton guibutton">eye</span> icon to see the raw HTML (without paged.js applied).</p>
        <p class="tei-para">To generate the HTML of the document, the component calls Publisher's API endpoint:</p>
        <pb-code-highlight class="tei-synopsis4" language="">/api/document/doc%2Fdocumentation.xml/print?base=%2Fexist%2Fapps%2Ftei-publisher%2Fdoc%2F&amp;style=resources%2Ffonts%2Ffont.css&amp;style=resources%2Fcss%2Fprint.css</pb-code-highlight>
        <p class="tei-para">The optional <span class="tei-parameter code">base</span> parameter specifies the base URI for resolving relative links, e.g. to locate images. Additional CSS stylesheets can be imported with the <span class="tei-parameter code">style</span> parameter, extra Javascript imports with <span class="tei-parameter code">script</span>. By default, web components in the page won't be enabled (paper unfortunately does not support interactive content yet). If you need them (e.g. to format the source code examples in the documentation), pass <span class="tei-parameter code">wc</span> with a value of "true".</p>
        <p class="tei-para">For sure, being an open source project, paged.js does not support every fancy layout you may wish for. For example, support for formatting footnotes will be limited. There are other, mainly commercial tools, which you may use to generate PDF out of your HTML. Those include e.g. <a href="https://www.princexml.com/" class="tei-link5" target="">Prince XML</a>, <a href="https://www.pdfreactor.com/" class="tei-link5" target="">PDF Reactor</a> or <a href="https://antennahouse.com/" class="tei-link5" target="">Antennahouse</a>. Each of those may have different strengths and weaknesses. Please try yourself.</p>
        <p class="tei-para">For command line tools, you can use the API endpoint described above to retrieve the full HTML of the page and feed this to princeXML or whatever you want to use.</p>
      </pb-observable></div>
    </pb-observable></div>


    <div class="tei-section3" id="pm-extensions"><pb-observable data="0,3.12.17" emit="transcription">
      <h2 class="tei-title7 title">Extensions to the Processing Model Specification</h2>
      <div class="tei-section3" id="pm-extensions-xquery"><pb-observable data="0,3.12.17.5" emit="transcription">
        <h3 class="tei-title7 title">XQuery Instead of XPath</h3>
        <p class="tei-para">The implementation directly translates processing model instructions into an XQuery
            3.1 module by generating executable XQuery code. This is straightforward as the
            resulting XQuery will closely resemble the specification in the ODD, thus being easy to
            debug. It also leads to very efficient code, which is as fast or even faster as a
            hand-written, optimized transformation.</p>
        <p class="tei-para">
          As a welcome side effect, any valid XQuery expression might be used wherever the
            spec expects an XPath expression, e.g. in predicates or parameters. For example, one can
            define variables inside a parameter using a standard XQuery
          <span class="tei-code2 code">let
              $x := ... return ...</span>
          syntax.
        </p>
      </pb-observable></div>
      <div class="tei-section3" id="pm-extensions-default"><pb-observable data="0,3.12.17.7" emit="transcription">
        <h3 class="tei-title7 title">Default Processing Model Rules</h3>
        <p class="tei-para">
          It is possible to define a default
          <span class="tei-tag code">elementSpec</span>
          to be applied to all
            elements which are not already matched by another elementSpec. For example, if no
          <span class="tei-tag code">elementSpec</span>
          is present for an element, its text content is output. To
            change this behaviour and omit content elements without specification, you may want to
            define a default
          <span class="tei-tag code">elementSpec</span>
          as shown below:
        </p>
        <pb-code-highlight class="tei-programlisting5" language="xml" line-numbers="line-numbers">&lt;elementSpec ident="*"&gt; &lt;model behaviour="omit"/&gt; &lt;/elementSpec&gt;</pb-code-highlight>
        <p class="tei-para">You can also define models to be applied to all text nodes, e.g. if you need to
            normalize certain nodes:</p>
        <pb-code-highlight class="tei-programlisting5" language="xml" line-numbers="line-numbers">&lt;elementSpec ident="text()"&gt;
  &lt;model behaviour="text"/&gt;
&lt;/elementSpec&gt;</pb-code-highlight>
        <p class="tei-para">Note that outputting text nodes is a performance critical operation, so use with
            care. Too complex processing may dramatically slow down rendering.</p>
      </pb-observable></div>
      <div class="tei-section3" id="external-parameters"><pb-observable data="0,3.12.17.9" emit="transcription">
        <h3 class="tei-title7 title">External Parameters</h3>
        <p class="tei-para">
          The script calling the processing model may pass external parameters into the ODD.
            They will be available in the variable
          <span class="tei-parameter code">$parameters</span>
          , which is an
            XQuery map. Access parameters using
          <span class="tei-code2 code">?</span>
          , the XQuery lookup operator.
        </p>
        <p class="tei-para">For example, one can use this feature to control how specific parts of the document
            are output, without having to define a separate output mode, which would result in much
            more code. Below we display a shortened header for the document, containing simply its
            title, but only if the parameter "header" is set to "short":</p>
        <pb-code-highlight class="tei-programlisting5" language="xml" line-numbers="line-numbers">&lt;elementSpec mode="change" ident="fileDesc"&gt;
    &lt;model predicate="$parameters?header='short' behaviour="block" cssClass="header-short"&gt;
      &lt;param name="content" value="titleStmt"/&gt;
    &lt;/model&gt;
  ...
&lt;/elementSpec&gt;</pb-code-highlight>
        <p class="tei-para">
          The
          <span class="tei-tag code">pb-view</span>
          webcomponent also lets you define arbitrary parameters to be
            passed to the ODD via
          <span class="tei-tag code">pb-param</span>
          . For example, the breadcrumbs shown above this
            documentation page are realized by setting a parameter
          <span class="tei-parameter code">mode</span>
          and
            can be queried in model predicates with
          <span class="tei-parameter code">$parameters?mode='breadcrumbs'</span>
          .
        </p>
        <pb-code-highlight class="tei-programlisting5" language="xml" line-numbers="line-numbers">&lt;section class="breadcrumbs"&gt;
    &lt;pb-view id="title-view1" src="document1" subscribe="transcription"&gt;
        &lt;pb-param name="mode" value="breadcrumbs"/&gt;
    &lt;/pb-view&gt;
&lt;/section&gt;</pb-code-highlight>
        <p class="tei-para">If the parameter is set, the processing model rules in the ODD will output the
            headings of all ancestor sections of the current division only, ignoring everything
            else. This approach helps to reuse the same ODD for viewing specific aspects of the
            document.</p>
        <p class="tei-para">
          A dedicated user interface webcomponent
          <a href="https://cdn.tei-publisher.com/api.html#pb-toggle-feature.0" class="tei-link4" target="_new">
            <span class="tei-tag code">pb-toggle-feature</span>
          </a>
          exists for toggling between two values of a
            parameter. Example below would produce a checkbox which when on results in the value of
          <span class="tei-parameter code">$parameters?mode</span>
          set to
          <span class="tei-parameter code">diplomatic</span>
          ,
            otherwise to
          <span class="tei-parameter code">norm</span>
          .
        </p>
        <pb-code-highlight class="tei-programlisting5" language="xml" line-numbers="line-numbers">&lt;pb-toggle-feature name="mode" on="diplomatic" off="norm"&gt;Diplomatic View&lt;/pb-toggle-feature&gt;</pb-code-highlight>
      </pb-observable></div>
      <div class="tei-section3" id="pm-extensions-templates"><pb-observable data="0,3.12.17.11" emit="transcription">
        <h3 class="tei-title7 title">Code Templates and Custom Behaviours</h3>
        <p class="tei-para">The two dozen behaviours defined by the TEI processing model are enough to cover
          most standard HTML output tasks like a listItem or heading, but more complex HTML markup or even other output formats like LaTeX require more
          customization and control over the generated output. The TEI Publisher library thus
          extends the processing model syntax with two custom elements for defining code
          templates.</p>
        <p class="tei-para">While TEI Publisher does provide ways to write your own behaviours in XQuery and
            thus extend the ones defined in the guidelines, this should only be used as last resort:
            custom XQuery behaviours limit the portability of the ODD and are bad for
            maintenance.</p>
        <p class="tei-para">
          Avoiding custom behaviours works quite well for HTML output and we have realized
            complex projects with just two or three extension behaviours. Things start to become
            more difficult if you try to output LaTeX though: there are hundreds of packages to use,
            and users typically define their own macros or environments for all recurring
            typesetting tasks. For example, to print a TEI
          <span class="tei-tag code">persName</span>
          , experienced LaTeX
            users would normally create a corresponding
          <span class="tei-code2 code">\persName</span>
          macro and handle the
            formatting details there. Unfortunately, out of the box the TEI processing model does
            not facilitate this level of customization.
        </p>
        <div class="tei-section3" id="pb-template"><pb-observable data="0,3.12.17.11.11" emit="transcription">
          <h4 class="tei-title7 title">
            Introducing
            <span class="tei-tag code">pb:template</span>
          </h4>
          <p class="tei-para">
            TEI Publisher thus supports an extension to the ODD syntax in its own namespace
                (
            <span class="tei-parameter code">http://teipublisher.com/1.0</span>
            ).
          </p>
          <p class="tei-para">
            Within the ODD, a
            <span class="tei-tag code">model</span>
            may define a
            <span class="tei-tag code">pb:template</span>
            element
              containing a code template. The template is expanded first and the result is passed
              into the behaviour specified for the model, replacing the default
            <span class="tei-parameter code">content</span>
            parameter accepted by all behaviours. The very simple
              case of outputting a
            <span class="tei-tag code">persName</span>
            in LaTeX could thus be written as:
          </p>

          <pb-code-highlight class="tei-programlisting5" language="xml" line-numbers="line-numbers">&lt;elementSpec ident="persName" mode="add"&gt;
    &lt;model behaviour="inline" output="latex"&gt;
        &lt;pb:template&gt;\persName{[[content]]}&lt;/pb:template&gt;
    &lt;/model&gt;
&lt;/elementSpec&gt;</pb-code-highlight>
          <p class="tei-para">
            The template can reference other parameters defined within the
            <span class="tei-tag code">model</span>
            by
              enclosing the parameter name in double brackets. In the example above we're
              referencing the default parameter
            <span class="tei-parameter code">content</span>
            , which contains the
              nested content of the
            <span class="tei-tag code">persName</span>
            tag. The parameter will be processed before
              it is passed into the template, so if
            <span class="tei-tag code">persName</span>
            contains nested TEI markup,
              the corresponding processing model rules will be applied first.
          </p>
          <p class="tei-para">
            The result of expanding the template then becomes the new
            <span class="tei-parameter code">content</span>
            parameter to be passed to the behaviour
                (
            <span class="tei-code2 code">inline</span>
            in the example above), which is processed in the normal way as
              defined in the TEI guidelines.
          </p>
          <p class="tei-para">
            You may also specify additional parameters to be included in the template. For
              example, the TEI document may contain a glossary of terms which are referenced in the
              text using
            <span class="tei-code2 code">&lt;term ref="#termid"&gt;text&lt;/term&gt;</span>
            . In LaTeX this
              would translate to
            <span class="tei-code2 code">\glslink{ref}{text}</span>
            , which can be easily produced by
              the following
            <span class="tei-tag code">model</span>
            :
          </p>
          <pb-code-highlight class="tei-programlisting5" language="xml" line-numbers="line-numbers">&lt;elementSpec ident="term" mode="add"&gt;
    &lt;model behaviour="inline" output="latex"&gt;
        &lt;param name="ref" value="substring-after(@ref, '#')"/&gt;
        &lt;pb:template&gt;\glslink{[[ref]]}{[[content]]}&lt;/pb:template&gt;
    &lt;/model&gt;
&lt;/elementSpec&gt;</pb-code-highlight>
          <p class="tei-para">
            We define an additional parameter
            <span class="tei-parameter code">ref</span>
            , which contains the
              id string from the
            <span class="tei-parameter code">@ref</span>
            attribute, stripping out the leading
              '#'.
          </p>
          <p class="tei-para">The templating mechanism is not limited to LaTeX, but may also be used to generate
            HTML or FO, for example, if you have to generate a complex HTML fragment to represent
            a single TEI element. This is hard and sometimes impossible to achieve without
            templates</p>
          <p class="tei-para">This following sample uses the <span class="tei-parameter code">pb-popover</span> webcomponent to display 
            the tei:persName from a person register for a given tei:persName/@key of your TEI 
            document. </p>
        <pb-code-highlight class="tei-programlisting5" language="xml" line-numbers="line-numbers">&lt;elementSpec ident="persName" mode="add"&gt;
        &lt;model behaviour="inline" cssClass="popover"&gt;
            &lt;param name="content" value="."/&gt;
            &lt;param name="key" value="@key"/&gt;
            &lt;param name="person-from-register" value="doc('/path/to/person.xml')//person[@id = @key]/persName[@type='full']/text()"&gt;
            &lt;pb:template xmlns="" xml:space="preserve"&gt;
                &lt;pb-popover data-ref="[[key]]"&gt;
                    &lt;span slot="default"&gt;[[content]]&lt;/span&gt;
                    &lt;span slot="alternate"&gt;[[person-from-register]]&lt;/span&gt;
                &lt;/pb-popover&gt;
            &lt;/pb:template&gt;
        &lt;/model&gt;
        </pb-code-highlight>              
      </pb-observable></div>
      <div class="tei-section3" id="pb-behaviour"><pb-observable data="0,3.12.17.11.13" emit="transcription">
        <h4 class="tei-title7 title">Defining New Behaviours in the ODD</h4>
        <p class="tei-para">By combining code templates with parameters we can come up with a very simple
            mechanism to define new behaviours right inside the ODD!</p>
        <p class="tei-para">
          Take the TEI Publisher documentation as an example: it is written in docbook 5 and
            transformed via ODD. The documentation includes some videos which are hosted on youtube.
            In docbook those are represented by
          <span class="tei-tag code">videodata</span>
          elements inside a
          <span class="tei-tag code">videoobject</span>
          :
        </p>
        <pb-code-highlight class="tei-programlisting5" language="xml" line-numbers="line-numbers">&lt;figure xml:id="edit-odd"&gt;
    &lt;title&gt;Screencast&lt;/title&gt;
    &lt;mediaobject&gt;
      &lt;videoobject&gt;
        &lt;videodata fileref="https://www.youtube.com/embed/avRO-b2BwUI?rel=0" width="853" depth="480"/&gt;
      &lt;/videoobject&gt;
    &lt;/mediaobject&gt;
&lt;/figure&gt;</pb-code-highlight>
        <p class="tei-para">
          In the HTML output we would need to transform this into an
          <span class="tei-tag code">iframe</span>
          , so the
            reader can view the video embedded in the page. We can achieve this with a
          <span class="tei-tag code">pb:template</span>
          as sketched in the previous section, but it would be nice to
            turn this into a general-purpose behaviour, which we can re-use in other situations
            requiring an iframe. The TEI Publisher library allows us to define a behaviour right
            inside the ODD as follows:
        </p>

        <pb-code-highlight class="tei-programlisting5" language="xml" line-numbers="line-numbers">&lt;pb:behaviour ident="iframe" output="web"&gt;
    &lt;pb:param name="src"/&gt;
    &lt;pb:param name="width"/&gt;
    &lt;pb:param name="height"/&gt;
    &lt;pb:template xmlns=""&gt;
        &lt;iframe src="[[src]]" width="[[width]]" height="[[height]]" frameborder="0" gesture="media" allow="encrypted-media" allowfullscreen="allowfullscreen"&gt;&lt;/iframe&gt;
    &lt;/pb:template&gt;
&lt;/pb:behaviour&gt;</pb-code-highlight>

        <div class="tei-note3 note"><h4 class="tei-title4">Note</h4><p class="tei-para">
            Note how we have to reset the namespace on the
            <span class="tei-tag code">pb:template</span>
            ? This is
              required because the default namespace in an ODD document is the TEI namespace. You
              thus need to reset it whenever you want to output elements in another or no namespace
              inside a template. Without this, the iframe would end up in the TEI namespace.
              Webbrowsers will usually ignore it, but it will be wrong nevertheless.
          </p></div>
        <p class="tei-para">
          All behaviours should be included in the TEI header or - to be exact: the
          <span class="tei-tag code">tagsDecl</span>
          inside the
          <span class="tei-tag code">encodingDesc</span>
          . You may have multiple
            behaviour declarations with the same
          <span class="tei-parameter code">@ident</span>
          , given that they
            apply to different
          <span class="tei-parameter code">@output</span>
          modes. Parameters specified via
          <span class="tei-tag code">pb:param</span>
          without
          <span class="tei-parameter code">@value</span>
          attribute are expected to be
            passed to the behaviour from the calling model. A parameter may be empty though. If you
            define an XPath expression as
          <span class="tei-parameter code">@value</span>
          attribute, the result of the
            XPath evaluation will be used as value for the parameter.
        </p>
        <p class="tei-para">
          The new behaviour will be named
          <span class="tei-function code">iframe</span>
          and takes three
            parameters:
          <span class="tei-parameter code">src</span>
          ,
          <span class="tei-parameter code">width</span>
          and
          <span class="tei-parameter code">height</span>
          . It can now be called from a
          <span class="tei-tag code">model</span>
          as
            follows:
        </p>
        <pb-code-highlight class="tei-programlisting5" language="xml" line-numbers="line-numbers">&lt;model behaviour="iframe"&gt;
    &lt;param name="width" value="@width"/&gt;
    &lt;param name="height" value="@depth"/&gt;
    &lt;param name="src" value="@fileref"/&gt;
&lt;/model&gt;</pb-code-highlight>
        <p class="tei-para">
          For further code examples, please have a look at
          <span class="tei-link2"><pb-edit-xml path="/db/apps/tei-publisher/odd/docbook.odd">docbook.odd<iron-icon icon="icons:open-in-new"></iron-icon></pb-edit-xml></span>
          , which is used for viewing the documentation.
        </p>
        <div class="tei-note3 note"><h4 class="tei-title4">Note</h4><p class="tei-para">
            At the time of writing, the graphical ODD editor in TEI Publisher does not yet
              support defining your own behaviours via
            <span class="tei-tag code">pb-behaviour</span>
            . You thus have to
              make those changes in the source XML using eXide, oXygen or another XML editor. You
              can, however, use the graphical editor to continue editing the ODD afterwards. It is
              smart enough to not overwrite your hand-written code upon save.
          </p></div>
      </pb-observable></div>
    </pb-observable></div>

    <div class="tei-section3" id="extension-modules"><pb-observable data="0,3.12.17.13" emit="transcription">
      <h3 class="tei-title7 title">Extension Modules</h3>
      <p class="tei-para">
        Where possible, developers should stick to the standard behaviours defined by the TEI
          guidelines, or use the
        <span class="tei-tag code">pb-behaviour</span>
        and
        <span class="tei-tag code">pb-template</span>
        <a href="?odd=docbook.odd&amp;view=&amp;id=pb-behaviour" class="tei-link3" target="">extensions</a>
        of the ODD syntax. However, there might be
          situations in which it is necessary to generate a specific type of complex output, which
          requires the full power of XQuery. To facilitate this, the implementation allows
          additional extension modules to be configured:
      </p>
      <div class="tei-section3" id="extension-configuration"><pb-observable data="0,3.12.17.13.7" emit="transcription">
        <h4 class="tei-title7 title">Configuration</h4>
        <p class="tei-para">
          Configuration is done via an XML file which must reside in the same collection as
            the source ODD files. It contains a series of
          <span class="tei-tag code">output</span>
          elements, representing
            particular output modes (e.g. web or print) via
          <span class="tei-parameter code">@mode</span>
          attribute.
          <span class="tei-tag code">output</span>
          element without a mode groups modules available for all output
            modes.
        </p>
        <p class="tei-para">
          Each
          <span class="tei-tag code">output</span>
          element lists modules to be loaded for specified output mode.
            Each definition may optionally be limited to a specific ODD, name of which is specified
            in the
          <span class="tei-parameter code">@odd</span>
          attribute.
        </p>
        <pb-code-highlight class="tei-programlisting5" language="xml" line-numbers="line-numbers">&lt;modules&gt;
    &lt;!-- functions or behaviours common to all output modes --&gt;
    &lt;output&gt;
      &lt;module uri="http://www.tei-c.org/tei-simple/xquery/common-functions" prefix="tc" at="xmldb:exist:///db/apps/my-app/modules/common.xql"/&gt;
    &lt;/output&gt;
    &lt;!-- General fo extension functions --&gt;
    &lt;output mode="print"&gt;
      &lt;module uri="http://www.tei-c.org/tei-simple/xquery/ext-fo" prefix="ext-fo" at="xmldb:exist:///db/apps/tei-publisher/modules/ext-fo.xql"/&gt;
    &lt;/output&gt;
    &lt;!-- Special web configuration for the documentation (to handle &lt;code&gt;) --&gt;
    &lt;output mode="web" odd="documentation"&gt;
      &lt;module uri="http://www.tei-c.org/tei-simple/xquery/ext-html" prefix="ext-html" at="xmldb:exist:///db/apps/tei-publisher/modules/ext-html.xql"/&gt;
    &lt;/output&gt;
&lt;/modules&gt;</pb-code-highlight>
        <p class="tei-para">
          Whenever the library tries to locate a processing model function for a given
            behaviour, it will
          <span class="tei-emphasis1">first</span>
          check any extension module it
            knows to see if it contains a matching function. One can thus
          <span class="tei-emphasis1">overwrite</span>
          the default functions as well as define new ones.
        </p>
        <p class="tei-para">
          An extension module may also contain general purpose XQuery functions you want to
            call from within an ODD parameter, e.g. for formatting a date, outputting a number etc.
            To make those functions available to all output modes, just skip the
          <span class="tei-parameter code">@mode</span>
          attribute.
        </p>
      </pb-observable></div>
      <div class="tei-section3" id="extension-modules-behaviours"><pb-observable data="0,3.12.17.13.9" emit="transcription">
        <h4 class="tei-title7 title">Implementing Custom Behaviours</h4>
        <p class="tei-para">To be recognized by the library, an extension function must accept at least 4
            default arguments, plus any number of custom parameters. The required parameters
            are:</p>
        <dl><dt>$config</dt><dd>
              <p class="tei-para">
                a map containing configuration information as well as function references to
                  be called. The most important ones are
                <span class="tei-function code">$config?apply($config,
                    $node)</span>
                and
                <span class="tei-function code">$config?apply-children($config, $node,
                    $content)</span>
                . Both are function items and when called, continue
                  processing with either a single
                <span class="tei-parameter code">$node</span>
                or a sequence of
                  nodes in
                <span class="tei-parameter code">$content</span>
                .
              </p>
            </dd><dt>$node</dt><dd>
              <p class="tei-para">the TEI element being processed at the moment</p>
            </dd><dt>$class</dt><dd>
              <p class="tei-para">
                a list of HTML class names to be used. This includes automatically generated
                  class names as well as those passed via
                <span class="tei-parameter code">@cssClass</span>
                on a
                  model item.
              </p>
            </dd><dt>$content</dt><dd>
              <p class="tei-para">
                because
                <span class="tei-parameter code">content</span>
                is defined for every model rule, it is
                  always passed to a behaviour function (though it might be empty)
              </p>
            </dd></dl>
        <p class="tei-para">
          For all additional parameters, the processing model implementation tries to fill
            each custom parameter with a corresponding value by looking through the
          <span class="tei-tag code">param</span>
          children of the
          <span class="tei-tag code">model</span>
          in the ODD to find one with a name matching the
            variable name. If no matching parameter can be found, the function argument will be set
            to the empty sequence. You should not enforce a type or cardinality for any of the
            custom parameters as this may lead to unexpected errors. The parameters may be empty or
            contain more than one item.
        </p>
        <p class="tei-para">
          For example, a custom behaviour called
          <span class="tei-code2 code">code</span>
          for syntax highlighting in
            an extension module named
          <span class="tei-filename code">ext-html.xql</span>
          might look as
            follows:
        </p>
        <pb-code-highlight class="tei-programlisting5" language="xquery" line-numbers="line-numbers">xquery version "3.1";
(:~ : Non-standard extension functions, mainly used for the documentation. :)
module namespace pmf="http://www.tei-c.org/tei-simple/xquery/ext-html";
declare namespace tei="http://www.tei-c.org/ns/1.0";

declare function pmf:code($config as map(*), $node as element(), $class as xs:string+, $content as node()*, $lang as item()?) {
    &lt;pre class="code {$class}" data-language="{if ($lang) then $lang else 'xquery'}"&gt;
    {replace(string-join($content/node()), "^\s+?(.*)\s+$", "$1")}
    &lt;/pre&gt;
};</pb-code-highlight>
        <p class="tei-para">
          It defines one function,
          <span class="tei-function code">pmf:code</span>
          , which can be called from the
            ODD as follows, provided that the
          <span class="tei-filename code">ext-html.xql</span>
          module has been
            configured as described in the
          <a href="?odd=docbook.odd&amp;view=&amp;id=extension-configuration" class="tei-link3" target="">previous
              section</a>
          .
        </p>
        <pb-code-highlight class="tei-programlisting5" language="xml" line-numbers="line-numbers">
&lt;model behaviour="code"&gt; 
    &lt;param name="lang" value="@lang"/&gt; 
&lt;/model&gt;
        </pb-code-highlight>
      </pb-observable></div>
      <div class="tei-section3" id="extension-modules-behaviour-parameters"><pb-observable data="0,3.12.17.13.11" emit="transcription">
        <h4 class="tei-title7 title">Custom Behaviours Accepting User-Defined Parameters</h4>
        <p class="tei-para">Sometimes you may like to implement a generic behaviour which takes arbitrary
            parameters from the user. This means the parameter list of your behaviour will not be
            fixed.</p>
        <p class="tei-para">
          To facilitate this, a behaviour function may declare a final parameter
          <span class="tei-code2 code">$optional as map(*)</span>
          . If the processor finds
          <span class="tei-tag code">param</span>
          children in
            the model which cannot be mapped to an explicitly declared parameter, it stores all such
            extra parameters as a key/value pairs in the
          <span class="tei-parameter code">$optional</span>
          map.
        </p>
      </pb-observable></div>
    </pb-observable></div>


    <div class="tei-section3" id="odd-by-example"><pb-observable data="0,3.12.17.15" emit="transcription">
      <h3 class="tei-title7 title">Building a Sample-Based ODD</h3>
      <p class="tei-para">
        If you do not want to start a customized ODD from a blank template, you can
          alternatively generate one that covers the classes and elements of a selection of TEI
          files stored in TEI Publisher's data collection. Simply select one or more sample
          documents in the list to the left, enter a name and title into the form and click on
        <span class="tei-guibutton guibutton">Create from examples</span>
        . Note that if you haven't removed the
          default examples TEI files that shipped with tei-publisher their markup will be included
          in the constructed ODD as well.
      </p>
      <span class="tei--element">
        <span class="tei--element">
          <img src="BuildODD.gif" class="tei-imagedata2" title="">
        </span>
      </span>
      <p class="tei-para">
        This method uses the
        <span class="tei-filename code">oddbyexample.xsl</span>
        stylesheet that is part of
          the TEI consortium's
        <a href="https://github.com/TEIC/Stylesheets" class="tei-link4" target="_new">stylesheets</a>
        . Users with a corpus
          of one or more TEI files can generate a custom odd that contains explicit additions and
          deletions for all possible TEI modules, as well as,
        <span class="tei-tag code">valList</span>
        for attribute
          values in the input corpus.
      </p>
      <p class="tei-para">
        By default the basis of the comparison for which elements have been modified in the
          examples is the full
        <span class="tei-filename code">tei_all.odd</span>
        .
      </p>
      <div class="tei-section3" id="odd-by-example-advanced"><pb-observable data="0,3.12.17.15.13" emit="transcription">
        <h4 class="tei-title7 title">Advanced Use</h4>
        <p class="tei-para">
          To further tweak the building process you can call the functions of the
          <span class="tei-filename code">odd-by-example.xql</span>
          module from your own XQuery code. If you wish
            to generate your own basis for the comparison you can call the following function to
            store a compiled ODD in the default odd location of tei-publisher:
        </p>
        <pb-code-highlight class="tei-programlisting5" language="XQuery" line-numbers="line-numbers">obe:compile-odd(doc('../odd/my-file.odd'), 'my-file-name')</pb-code-highlight>
        <div class="tei-note3 note"><h4 class="tei-title4">Note</h4><p class="tei-para">
            Due to a bug in the
            <span class="tei-filename code">odd2odd.xsl</span>
            stylesheet the output of this
              function is not always valid. To use it for further processing you need to make sure
              that only valid documents are used for further processing
          </p></div>
        <p class="tei-para">You can also modify the transformation parameters of:</p>
        <pb-code-highlight class="tei-programlisting5" language="XQuery" line-numbers="line-numbers">obe:process-example(doc('../data/test/myTEI.xml'), 'odd-name', 'simplePrint')</pb-code-highlight>
        <p class="tei-para">The above example uses simplePrint as a basis for building the new ODD. The full
            list of configurable options are:</p>
        <pb-code-highlight class="tei-programlisting5" language="xml" line-numbers="line-numbers">&lt;parameters&gt;
  &lt;!-- the document corpus --&gt;
  &lt;param name="corpus" value="."/&gt;
  &lt;!-- name of odd --&gt;
  &lt;param name="schema" value="{substring-before($output, '.odd')}"/&gt;
  &lt;!-- the source of the TEI (just needs *Spec)--&gt;
  &lt;param name="defaultSource" value="{$base}"/&gt;
  &lt;!-- should we make valList for @rend and @rendition --&gt;
  &lt;param name="enumerateRend" value="false"/&gt;
  &lt;!-- whether to do all the global attributes --&gt;
  &lt;param name="keepGlobals" value="true"/&gt;
  &lt;!-- should elements in teiHeader be included?--&gt;
  &lt;param name="includeHeader" value="true"/&gt;
  &lt;!-- should we make valList for @type --&gt;
  &lt;param name="enumerateType" value="true"/&gt;
  &lt;!-- should we deal with non-TEI namespaces --&gt;
  &lt;param name="processNonTEI" value="false"/&gt;
  &lt;!-- do you want moduleRef generated with @include or @except? --&gt;
  &lt;!-- seems broken see https://github.com/TEIC/Stylesheets/issues/212 --&gt;
  &lt;param name="method" value="include"/&gt;
  &lt;!-- turn on debug messages --&gt;
  &lt;param name="debug" value="false"/&gt;
  &lt;!-- turn on messages --&gt;
  &lt;param name="verbose" value="false"/&gt;
  &lt;!-- which files to look at? provide suffix --&gt;
  &lt;param name="suffix" value="xml"/&gt;
  &lt;!-- should P4 files be considered? --&gt;
  &lt;param name="processP4" value="false"/&gt;
  &lt;!-- should P5 files be considered? --&gt;
  &lt;param name="processP5" value="true"/&gt;
&lt;/parameters&gt;
          </pb-code-highlight>
      </pb-observable></div>
    </pb-observable></div>
  </pb-observable></div>
  </pb-observable></div>
  <div class="tei-section3" id="css-styling"><pb-observable data="0,3.14" emit="transcription">
    <h1 class="tei-title7 title">Custom CSS styling</h1>

    <p class="tei-para">
      CSS stylesheet
      <span class="tei-code2 code">resources/css/theme.css</span>
      defines styles used by all pages of
        the TEI Publisher and publisher-generated applications. Nevertheless, users
      <span class="tei-emphasis1">should not</span>
      directly modify this file but create a project-specific
        css customization file and include it alongside
      <span class="tei-code2 code">theme.css</span>
      instead.
    </p>
    <pb-code-highlight class="tei-programlisting5" language="html" line-numbers="line-numbers">
                  &lt;link rel="stylesheet" href="resources/css/theme.css" /&gt;
                  &lt;link rel="stylesheet" href="resources/css/my-project.css" /&gt;
          </pb-code-highlight>
    <p class="tei-para">
      This approach allows to selectively overwrite certain styles and CSS variables from
      <span class="tei-code2 code">theme.css</span>
      while remaining on the easy upgrade path for future TEI Publisher
        and
      <span class="tei-code2 code">pb-components</span>
      updates.
    </p>

    <div class="tei-section3" id="css-styling-components"><pb-observable data="0,3.14.11" emit="transcription">
      <h2 class="tei-title7 title">Customizing web components styling</h2>
      <p class="tei-para">A web component completely shields its content, so it cannot be styled from outside.
          Web component styles remain encapsulated, preventing style contamination between
          individual components and general application context. A blessing in general, allowing
          components to be scripted and styled without the fear of collision with other parts of the
          page, but poses additional challenges when adjusting the look and feel of a component to
          fit a project's theme.</p>
      <p class="tei-para">
        For Publisher, encapsulation of web components means that definitions in
        <span class="tei-code2 code">theme.css</span>
        or equivalent project customization CSS files are not able to
          directly govern web components styling.
      </p>
      <p class="tei-para">
        While some aspects of component styling remained unaccessible for customization in
          versions preceding Publisher 6, currently
        <span class="tei-code2 code">pb-components</span>
        expose style
          properties to the outside world via standard CSS variables. This way variables like
        <span class="tei-code2 code">--pb-footnote-color</span>
        defined in
        <span class="tei-code2 code">theme.css</span>
        can be accessed by
          e.g.
        <span class="tei-code2 code">pb-view</span>
        component and thus determine the color of the footnote marker in
          the rendered transcription.
      </p>

      <p class="tei-para">Note that while you cannot change the inner appearance of a component except by
          setting its custom CSS properties, you can style the component itself within the HTML
          template, e.g. to position it within the layout of the page.</p>
    </pb-observable></div>
    <div class="tei-section3" id="css-styling-external"><pb-observable data="0,3.14.13" emit="transcription">
      <h2 class="tei-title7 title">External stylesheets</h2>
      <p class="tei-para">
        ODD specification allows for explicit declaration of an external CSS file which may
          define styles and CSS classes to be applied to tranformed sources (in
        <span class="tei-code2 code">encodingDesc/tagsDecl/rendition</span>
        ), e.g.
      </p>
      <pb-code-highlight class="tei-programlisting5" language="xml" line-numbers="line-numbers">
                  &lt;rendition source="docbook.css"/&gt;
          </pb-code-highlight>
      <p class="tei-para">
        Styles and classes from that file are loaded into
        <span class="tei-code2 code">pb-view</span>
        component and
          thus accessible for its content.
      </p>
      <p class="tei-para">
        External stylesheets for
        <span class="tei-code2 code">pb-view</span>
        can also be specified via
        <span class="tei-code2 code">load-css</span>
        component configuration attribute. In this scenario, unlike with
          ODD
        <span class="tei-code2 code">rendition</span>
        , regenerating the ODD is not required for changes to the CSS
          file to be applied, otherwise both methods are functionally equivalent.
      </p>

      <pb-code-highlight class="tei-programlisting5" language="html" line-numbers="line-numbers">
                  &lt;pb-view id="view1" src="document1" load-css="odd/docbook.css"/&gt;
          </pb-code-highlight>

      <p class="tei-para">
        Broader discussion of using
        <span class="tei-tag code">rendition</span>
        for custom styles can be found in
        <a href="?odd=docbook.odd&amp;view=&amp;id=external-css" class="tei-link3" target="">this section</a>
        .
      </p>
      
    </pb-observable></div>
  </pb-observable></div>

  <div class="tei-section3" id="webcomponents"><pb-observable data="0,3.16" emit="transcription">
    <h1 class="tei-title7 title">Page templates and pb-components</h1>
    <p class="tei-para">
      As described earlier, the various sample documents included in the TEI Publisher Demo
        collection differ not only in the ODD they use, but also concerning the general layout and
        composition of the page. They are based on different HTML templates, which can be found in
        the
      <span class="tei-filename code">templates/pages</span>
      collection of the TEI Publisher app. Each template
        assembles various building blocks in a slightly different way - some
      <a href="?odd=docbook.odd&amp;view=&amp;id=selected-use-cases" class="tei-link3" target="">examples</a>
      show a facsimile view next to the text,
        others a parallel display of transcription andtranslation, some include a map and another
        showcase collapsible metadata section. Which template is being used is determined by a
      <a href="?odd=docbook.odd&amp;view=&amp;id=pi-config" class="tei-link3" target="">processing instruction</a>
      in the TEI sources of these
        examples.
    </p>
    <p class="tei-para">The building blocks we mentioned are custom HTML elements. Each of them encapsulates a
        certain functionality and appearance. The map, the facsimile, but also the text view itself
        and all controls are custom HTML elements. They are like "Lego" blocks which can be freely
        moved around and rearranged without knowing anything about internal implementation of the
        component.</p>
    <div class="tei-section3" id="webcomponents-intro"><pb-observable data="0,3.16.9" emit="transcription">
      <h2 class="tei-title7 title">Web Components</h2>


      <p class="tei-para">
        The technology enabling this Lego-like modular approach is a W3C standard called
        <span class="tei-emphasis2">Web Components</span>
        . It is already built into many browsers and support
          is improving quickly, reducing the need for external frameworks. There's a growing
          collection of ready-to-use components available, e.g. the
        <a href="https://www.webcomponents.org/author/PolymerElements" class="tei-link4" target="_new">Polymer
            elements</a>
        we use for menus, buttons, dropdowns etc. TEI Publisher from version 6.0
          exposes its collection of Web Components targeted at creating digital editions as a
          separate
        <span class="tei-code2 code">pb-components</span>
        package.
      </p>
      <p class="tei-para">
        You do not need to know much about
        <span class="tei-emphasis2">Web Components</span>
        to use them in
          TEI Publisher. From a user perspective, a component looks like any other HTML element. You
          configure it by setting its properties via attributes. For example, the following HTML
          code snippet will display the first page/section of two completely different documents as
          you can see below in the embedded
        <a href="https://codepen.io/" class="tei-link4" target="_new">Codepen</a>
        (to learn more on embedding Publisher output and components see
        <a href="?odd=docbook.odd&amp;view=&amp;id=embedding" class="tei-link3" target="">further chapters</a>
        )
      </p>
      <pb-code-highlight class="tei-programlisting5" language="xml" line-numbers="line-numbers">
&lt;pb-page&gt;
  &lt;pb-document id="document1" path="test/kant_rvernunft_1781.TEI-P5.xml" odd="dta" view="page"&gt;&lt;/pb-document&gt;
  &lt;pb-document id="document2" path="doc/documentation.xml" odd="docbook" view="div"&gt;&lt;/pb-document&gt;

  &lt;!-- Display two document views side by side --&gt;
  &lt;main&gt;
      &lt;pb-view id="view1" src="document1"&gt;&lt;/pb-view&gt;
      &lt;pb-view id="view2" src="document2"&gt;&lt;/pb-view&gt;
  &lt;/main&gt;
&lt;/pb-page&gt;</pb-code-highlight>

      <pb-codepen class="tei-programlisting3" hash="WNvYYWB" user="wolfgangmm" theme="dark" height="480" editable="editable"></pb-codepen>
      <p class="tei-para">
        <span class="tei-tag code">pb-page</span>
        ,
        <span class="tei-tag code">pb-document</span>
        and
        <span class="tei-tag code">pb-view</span>
        are three web
          components from
        <span class="tei-code2 code">pb-components</span>
        library, while
        <span class="tei-tag code">main</span>
        is a standard
          HTML5 tag. The name of the custom element
        <span class="tei-emphasis1">must</span>
        start with
          a prefix to distinguish it from standard HTML. This concept should be familiar to XML
          people. For TEI Publisher components, the prefix is always
        <span class="tei-code2 code">pb-</span>
        . Components
          from other sources will use different prefixes, e.g.
        <span class="tei-code2 code">paper-</span>
        and
        <span class="tei-code2 code">iron-</span>
        for the
        <span class="tei-emphasis2">Polymer</span>
        collection.
      </p>
      <p class="tei-para">
        The part of the page which uses TEI Publisher web components should always be wrapped
          into an
        <span class="tei-tag code">pb-page</span>
        element. This element determines the TEI Publisher server
          instance all other components will be communicating with (see the next section below). It
          is also responsible for some other initialization steps, e.g. loading the list of
          available user interface translations. .
      </p>
      <p class="tei-para">
        <span class="tei-tag code">pb-document</span>
        specifies a document source, which can then be referenced by id
          from other components. The component provides a way to configure basic properties
          governing document's default rendering, like associated ODD file, etc. In the example
          above, we define three properties for each document:
      </p>
      <dl><dt>path</dt><dd>
            <p class="tei-para">
              the relative path to the XML document. This will be interpreted as relative to
                the
              <span class="tei-emphasis2">data root collection</span>
              of TEI Publisher, by default pointing
                to the
              <span class="tei-filename code">data</span>
              collection within the TEI Publisher app.
            </p>
          </dd></dl>
      <dl><dt>odd</dt><dd>
            <p class="tei-para">
              the name - without suffix - of the ODD to use for rendering the document. In the
                example, the first document is encoded in TEI and thus transformed through
              <span class="tei-filename code">dta.odd</span>
              , while the second is written in DocBook and passed
                through
              <span class="tei-filename code">docbook.odd</span>
              .
            </p>
          </dd></dl>
      <dl><dt>view</dt><dd>
            <p class="tei-para">this property determines how the document will be paginated if the user
                navigates forward/backward. Currently three possible methods are available:</p>
            <ol class="tei-orderedlist"><li class="tei-listitem">
                <p class="tei-para">
                  <span class="tei-parameter code">div</span>
                  : displays one structural division (TEI div, DocBook
                    section …) at a time
                </p>
              </li><li class="tei-listitem">
                <p class="tei-para">
                  <span class="tei-parameter code">page</span>
                  : displays the document page by page. This requires
                    page break indicators to be present (
                  <span class="tei-tag code">pb</span>
                  in TEI, not supported for
                    docbook).
                </p>
              </li><li class="tei-listitem">
                <p class="tei-para">
                  <span class="tei-parameter code">single</span>
                  : the entire document (or a selected fragment of
                    it) is displayed at once
                </p>
              </li></ol>
          </dd></dl>
      <p class="tei-para">
        <span class="tei-tag code">pb-view</span>
        is the critical component in TEI Publisher: it provides the actual text
          view by transforming a part or entirety of the source XML into HTML based on the
          processing model instructions in the ODD.
      </p>

      <p class="tei-para">
        Because webcomponents are all about encapsulation,
        <span class="tei-tag code">pb-view</span>
        ensures that the
          styling of the text as governed by the ODD will be confined to the boundaries of the
          component. This makes it possible to display two completely heterogenous texts (like the
          documentation and Kant's Kritik) on the same page without styles contaminating each other.
          As a downside, encapsulation also poses some challenges, which we discussed in the section
          about
        <a href="?odd=docbook.odd&amp;view=&amp;id=external-css" class="tei-link3" target="">CSS styling</a>
        .
      </p>
    </pb-observable></div>

    <div class="tei-section3" id="webcomponents-docs"><pb-observable data="0,3.16.11" emit="transcription">
      <h2 class="tei-title7 title">Webcomponent Documentation</h2>
      <p class="tei-para">
        To better understand the various components TEI Publisher provides, it is best to have
          a look at the small examples contained in the
        <a href="https://cdn.tei-publisher.com/api.html" class="tei-link4" target="_new">web
            components API documentation</a>
        . The list of components may be overwhelming at first
          sight. However you don’t need to learn them all. There are just a few components that
          should be understood before you start customizing. Their demo pages showcase a working
          example along with the code snippet which actually implements it.
      </p>
      <p class="tei-para">
        You can also get an editable live view like the one above if you click on the
        <span class="tei-guibutton guibutton">Edit Code</span>
        button to the bottom right of each example.
      </p>
      <p class="tei-para">In particular you may want to look at the following examples:</p>
      <dl><dt>
            <a href="https://cdn.tei-publisher.com/api.html#pb-document.1" class="tei-link4" target="_new">pb-document</a>
          </dt><dd>
            <p class="tei-para">shows the example given above in action</p>
          </dd><dt>
            <a href="https://cdn.tei-publisher.com/api.html#pb-view.1" class="tei-link4" target="_new">pb-view</a>
          </dt><dd>
            <p class="tei-para">adds navigation buttons to read the document page by page</p>
          </dd><dt>
            <a href="https://cdn.tei-publisher.com/api.html#pb-facsimile.1" class="tei-link4" target="_new">pb-facsimile</a>
          </dt><dd>
            <p class="tei-para">display facsimiles via IIIF server and link to them</p>
          </dd><dt>
            <a href="https://cdn.tei-publisher.com/api.html#pb-leaflet-map.1" class="tei-link4" target="_new">pb-leaflet-map</a>
          </dt><dd>
            <p class="tei-para">show a map and link to geo coordinates</p>
          </dd><dt>
            <a href="https://cdn.tei-publisher.com/api.html#pb-load.1" class="tei-link4" target="_new">pb-load</a>
          </dt><dd>
            <p class="tei-para">call a server-side XQuery to retrieve additional information about the document,
                in this case actors appearing in the play</p>
          </dd><dt>
            <a href="https://cdn.tei-publisher.com/api.html#pb-search.1" class="tei-link4" target="_new">pb-search</a>
          </dt><dd>
            <p class="tei-para">execute a search on the database, retrieve the results and paginate through
                them</p>
          </dd><dt>
            <a href="https://cdn.tei-publisher.com/api.html#pb-grid.1" class="tei-link4" target="_new">pb-grid</a>
          </dt><dd>
            <p class="tei-para">dynamically add more columns to a horizontal grid of components</p>
          </dd></dl>
      <div class="tei-note3 note"><h4 class="tei-title4">Caveat</h4><p class="tei-para">
          Some properties of pb-view and other components are boolean properties. In HTML5
            this corresponds to an attribute without value, which is illegal in XML. If you want to
            preserve valid XML, just write the attribute with the same name and value, e.g.
          <span class="tei-code2 code">append-footnotes="append-footnotes"</span>
          .
        </p></div>
    </pb-observable></div>

    <div class="tei-section3" id="webcomponents-communication"><pb-observable data="0,3.16.13" emit="transcription">
      <h2 class="tei-title7 title">Communication between Components</h2>
      <p class="tei-para">
        To allow for maximum flexibility, nearly all of the TEI Publisher webcomponents
          communicate via events: this way avoids hard wiring and components may appear anywhere on
          the page. For example, the controls for paginating through a document do not directly talk
          to the document view: they just send an
        <span class="tei-emphasis2">event</span>
        , indicating the users'
          wish to navigate backward or forward. Components listening for this event may then react
          to it by refreshing the text being displayed.
      </p>
      <p class="tei-para">
        Since you can have multiple text views showing content from different sources, every
          event can be announced at a specific communication
        <span class="tei-emphasis2">channel</span>
        . This
          allows us to distinguish between different sources, e.g. two transcriptions being shown
          side by side. Most TEI Publisher components therefore accept two properties to configure
          the channel they are listening or sending events to:
      </p>
      <dl><dt>subscribe</dt><dd>
            <p class="tei-para">name of the channel to which this component subscribes to. It will only react to
                events coming in via this channel.</p>
          </dd><dt>emit</dt><dd>
            <p class="tei-para">name of the channel to which this components sends events.</p>
          </dd></dl>
      <p class="tei-para">If neither of these properties is given, the component will subscribe and emit to the
          global default channel. A component may also send to a different channel than it
          subscribes to, allowing chains of events.</p>
      <p class="tei-para">Common properties and methods accepted by many TEI Publisher components are defined in
          the class PbMixin.</p>
    </pb-observable></div>

    <div class="tei-section3" id="webcomponents-page-templates"><pb-observable data="0,3.16.15" emit="transcription">
      <h2 class="tei-title7 title">Page Templates</h2>
      <p class="tei-para">
        TEI Publisher currently includes several different page templates, which combine the
          building blocks described above with off-the-shelf components to achieve a certain page
          layout and composition. If you look at the HTML code, you'll see a mix of
        <span class="tei-parameter code">pb-</span>
        elements and
        <span class="tei-parameter code">app-</span>
        ,
        <span class="tei-parameter code">paper-</span>
        ,
        <span class="tei-parameter code">iron-</span>
        elements. The last three
          belong to the
        <span class="tei-emphasis2">Polymer</span>
        collection and you can find them documented in
          the public
        <a href="https://www.webcomponents.org/" class="tei-link5" target="">webcomponent registry</a>
        .
          TEI Publisher components are not yet available there, though we may move some of the
          general purpose components there later.
      </p>
      <p class="tei-para">To avoid redundancy, the page template files use eXist's templating feature to drag in
          some repeating parts which are the same for all pages, for example, the toolbar and the
          menu. You'll find these files in the corresponding sub-collection:</p>
      <pb-code-highlight class="tei-programlisting5" language="xml" line-numbers="line-numbers">&lt;app-toolbar data-template="lib:include" data-template-path="templates/menu.html"/&gt;
&lt;app-toolbar data-template="lib:include" data-template-path="templates/toolbar.html"/&gt;</pb-code-highlight>
      <p class="tei-para">The following page templates are currently available in TEI Publisher:</p>
      <dl><dt>
            <span class="tei-link2"><pb-edit-xml path="/db/apps/tei-publisher/templates/pages/view.html">view.html<iron-icon icon="icons:open-in-new"></iron-icon></pb-edit-xml></span>
          </dt><dd>
            <p class="tei-para">the default template showing a single text view at the center</p>
          </dd><dt>
            <span class="tei-link2"><pb-edit-xml path="/db/apps/tei-publisher/templates/pages/facsimile.html">facsimile.html<iron-icon icon="icons:open-in-new"></iron-icon></pb-edit-xml></span>
          </dt><dd>
            <p class="tei-para">a template featuring a facsimile view to the right, retrieving images from a
                IIIF server</p>
          </dd><dt>
            <span class="tei-link2"><pb-edit-xml path="/db/apps/tei-publisher/templates/pages/letter.html">letter.html<iron-icon icon="icons:open-in-new"></iron-icon></pb-edit-xml></span>
          </dt><dd>
            <p class="tei-para">used for Graves' letter, this template displays an additional map to the right
                and a list of places, people and organizations</p>
          </dd><dt>
            <span class="tei-link2"><pb-edit-xml path="/db/apps/tei-publisher/templates/pages/translation.html">translation.html<iron-icon icon="icons:open-in-new"></iron-icon></pb-edit-xml></span>
          </dt><dd>
            <p class="tei-para">
              shows a transcription and its translation side by side. Both are contained in
                the same TEI document and extracted via an XPath expression passed to
              <span class="tei-tag code">pb-view</span>
            </p>
          </dd><dt>
            <span class="tei-link2"><pb-edit-xml path="/db/apps/tei-publisher/templates/pages/cortez-with-translation.html">cortez-with-translation.html<iron-icon icon="icons:open-in-new"></iron-icon></pb-edit-xml></span>
          </dt><dd>
            <p class="tei-para">
              similar to
              <span class="tei-filename code">translation.html</span>
              but the alignment between
                transcription and translation is more complex as the translation contains no page
                breaks. The part of the translation corresponding to a given fragment of the
                transcription thus needs to be computed dynamically for each page, using an XQuery
                function (defined by the
              <span class="tei-parameter code">map</span>
              on
              <span class="tei-tag code">pb-view</span>
              .
            </p>
          </dd><dt>
            <span class="tei-link2"><pb-edit-xml path="/db/apps/tei-publisher/templates/pages/cortez">cortez.html<iron-icon icon="icons:open-in-new"></iron-icon></pb-edit-xml></span>
          </dt><dd>
            <p class="tei-para">like above but with additional facsimile panel</p>
          </dd><dt>
            <span class="tei-link2"><pb-edit-xml path="/db/apps/tei-publisher/templates/pages/vangogh.html">vangogh.html<iron-icon icon="icons:open-in-new"></iron-icon></pb-edit-xml></span>
          </dt><dd>
            <p class="tei-para">demonstrates three columns by default: a metadata column, a transcription which
                can be switched to a diplomatic view including line endings, and a translation.
                Other columns, e.g. facsimile or commentary can be added dynamically.</p>
          </dd><dt>
            <span class="tei-link2"><pb-edit-xml path="/db/apps/tei-publisher/templates/pages/dantiscus.html">dantiscus.html<iron-icon icon="icons:open-in-new"></iron-icon></pb-edit-xml></span>
          </dt><dd>
            <p class="tei-para">
              builds upon
              <span class="tei-code2 code">facsimile.html</span>
              adding a collapsible
              <span class="tei-code2 code">pb-drawer</span>
              element to display metadata from
              <span class="tei-emphasis2">teiHeader</span>
              section.
            </p>
          </dd><dt>
            <span class="tei-link2"><pb-edit-xml path="/db/apps/tei-publisher/templates/pages/osinski.html">osinski.html<iron-icon icon="icons:open-in-new"></iron-icon></pb-edit-xml></span>
          </dt><dd>
            <p class="tei-para">
              similarly builds upon
              <span class="tei-code2 code">facsimile.html</span>
              but a collapsible metadata
                section is realized with a
              <span class="tei-code2 code">pb-collapse</span>
              element.
            </p>
          </dd></dl>
      <div class="tei-note3 note"><h4 class="tei-title4">Important Note</h4><p class="tei-para">The page templates are meant as examples to be copied and modified by users. They
            were written to match the concrete example and do not intend to be universal. TEI is too
            heterogenous to provide a one-size-fits-all solution. We thus believe that providing a
            wide range of practical examples is the best way to help users realize their own
            project.</p><p class="tei-para">
          Only the generic template,
          <span class="tei-filename code">view.html</span>
          should work with all
            example TEI documents.
        </p></div>
    </pb-observable></div>

    <div class="tei-section3" id="customizing-page-template"><pb-observable data="0,3.16.17" emit="transcription">
      <h2 class="tei-title7 title">Create your own Template</h2>
      <p class="tei-para">To create your own template</p>
      <ol class="tei-orderedlist"><li class="tei-listitem">
          <p class="tei-para">open one of the existing templates in e.g. eXide (by clicking the links in the
              list above)</p>
        </li><li class="tei-listitem">
          <p class="tei-para">
            adjust
            <span class="tei-code2 code">content</span>
            attribute in
            <span class="tei-code2 code">meta</span>
            tag to a label that
              fits your template
          </p>
          <pb-code-highlight class="tei-programlisting5" language="html" line-numbers="line-numbers">
                  &lt;meta name="description" content="XYZ edition project" /&gt;
              </pb-code-highlight>

        </li><li class="tei-listitem">
          <p class="tei-para">
            save the file under a different name into the same collection
                (
            <span class="tei-filename code">templates/pages</span>
            )
          </p>
        </li></ol>

      <p class="tei-para">Now reload the document you'd like the template to apply to and you'll be able to
          switch to your new template, either by</p>


      <ul class="tei-itemizedlist"><li class="tei-listitem">
          <p class="tei-para">
            using the
            <span class="tei-guibutton guibutton">Template</span>
            dropdown in the
            <span class="tei-guibutton guibutton">Settings</span>
            panel
          </p>
        </li><li class="tei-listitem">
          <p class="tei-para">
            adding a parameter
            <span class="tei-parameter code">template=mytemplate.html</span>
            to the URL
              showed by the browser
          </p>
        </li><li class="tei-listitem">
          <p class="tei-para">
            adding a
            <a href="?odd=docbook.odd&amp;view=&amp;id=pi-config" class="tei-link3" target="">processing instruction</a>
            to a TEI document
              to make a specific template the default:
          </p>
          <pb-code-highlight class="tei-programlisting5" language="html" line-numbers="line-numbers">&lt;?teipublisher template="translation.html" odd="dantiscus.odd" view="page"?&gt;</pb-code-highlight>
        </li></ul>
    </pb-observable></div>

    <div class="tei-section3" id="alignment"><pb-observable data="0,3.16.19" emit="transcription">
      <h2 class="tei-title7 title">Handling Complex Alignments</h2>
      <p class="tei-para">
        It is often desirable to show two or more views of a document at the same time, for
          example to display the translation aligned with a given source fragment. In the simplest
          case, the transcription and translation may be aligned on the level of divisions or page
          breaks and one can simply use two
        <span class="tei-tag code">pb-view</span>
        referencing different starting points
          in the TEI document (this approach is implemented by the
        <span class="tei-link2"><pb-edit-xml path="/db/apps/tei-publisher/templates/pages/translation.html">translation.html<iron-icon icon="icons:open-in-new"></iron-icon></pb-edit-xml></span>
        template for Serafin's letter).
      </p>
      <p class="tei-para">Unfortunately things are not always as simple as that. For example, even if the
          transcription contains page breaks or milestones which can be used to display a single
          page, the translation might not. One thus needs a different approach to compute the
          alignment between fragments. Nevertheless, the logic of the alignment algorithm will
          highly depend on the conventions used in the encoding. TEI allows a wide variety of
          alignment mechanisms and we do not want to limit the freedom of the editor by prescribing
          a particular method.</p>
      <p class="tei-para">TEI Publisher thus implements a generic way to plug an XQuery function into the
          processing pipeline. The function takes the source element being processed as input and
          may replace it by its aligned equivalent. Such an equivalent may be another element or
          fragment from the same or a different document. The source element will usually point to
          the part of the transcription being displayed. The mapping function uses this as starting
          point to determine an aligned fragment and returns it. The returned fragment will then be
          further passed through the processing model.</p>
      <p class="tei-para">
        The XQuery mapping function should be defined in the module
        <span class="tei-filename code">modules/map.xql</span>
        . It takes an element as its only argument and may
          return any valid TEI fragment, which will become the input for futher processing through
          the processing model.
      </p>
      <p class="tei-para">
        The local name of the mapping function can then be supplied in the attribute
        <span class="tei-parameter code">map</span>
        of
        <span class="tei-tag code">pb-view</span>
        . As an illustration, the Van Gogh
          example includes the following
        <span class="tei-code2 code">pb-view</span>
        for displaying the translation:
      </p>
      <pb-code-highlight class="tei-programlisting5" language="xquery" line-numbers="line-numbers">&lt;pb-view src="document1" map="vg-translation" xpath="//div[@type='original']"
    subscribe="transcription"/&gt;</pb-code-highlight>
      <p class="tei-para">
        In the Van Gogh letters, the translation contains page breaks corresponding to page
          breaks in the original letter, but these are using a different prefix for the
        <span class="tei-code2 code">xml:id</span>
        . To align the translation with the transcription, we only need to
          adjust the id, and retrieve the corresponding page break to be done. The XQuery mapping
          function is thus rather simple:
      </p>
      <pb-code-highlight class="tei-programlisting5" language="xquery" line-numbers="line-numbers">declare function mapping:vg-translation($root as element()) {
    let $id := ``[pb-trans-`{$root/@f}`-`{$root/@n}`]``
    let $node := root($root)/id($id)
    return
        $node
};</pb-code-highlight>
      <p class="tei-para">
        Note that returning the corresponding
        <span class="tei-tag code">pb</span>
        node of the translation is
          sufficient here as further processing will automatically extract the page fragment up to
          the next
        <span class="tei-tag code">pb</span>
        . More complex cases may require that mapping function returns
          arbitrary TEI fragment. Also note that the
        <span class="tei-parameter code">xpath</span>
        attribute of the
        <span class="tei-tag code">pb-view</span>
        element in the template must still point to the source transcription
            (
        <span class="tei-parameter code">div[@type='original']</span>
        in this case). It's just the mapping
          function which translates a position in the source transcription to a corresponding
          fragment in the translation.
      </p>
      <p class="tei-para">The letter by Cortez to Dantiscus sent from Mexico demonstrates a much more
          sophisticated alignment, determining the translation fragment to be shown by inspecting
          the ID range of the transcription. It illustrates the case where no milestone elements
          exist in the translation to explicitly mark page boundaries of the original, thus mapping
          algorithm aims to display closest corresponding fragment of the translated text.</p>
    </pb-observable></div>
  </pb-observable></div>

  <div class="tei-section3" id="api"><pb-observable data="0,3.18" emit="transcription">
    <h1 class="tei-title7 title">Server-side API</h1>
    <p class="tei-para">
      Many of the user interface web components need to communicate with the server to request
        certain data to be retrieved, processed and returned before the client-side components can
        display it to the user. For example, when user clicks the
      <span class="tei-guibutton guibutton">Table of
          Contents</span>
      button, the corresponding
      <span class="tei-parameter code">pb-load</span>
      component
        sends an ajax request to retrieve the list of chapters. Similarly, when user types something
        in the autocomplete field, a request is sent after each keystroke to find matching terms in
        the index. These requests need to be received and processed by the server with the eXist
        instance running and only then data will be returned to the browser.
    </p>

    <p class="tei-para">
      Previous versions of the TEI Publisher included a number of XQuery modules implementing
        the server-side functionality, located in
      <span class="tei-parameter code">modules</span>
      collection. In
        version 7, a new approach has been introduced. Formal
      <a href="../api.html" class="tei-link4" target="_new">API specification</a>
      , based on the
      <a href="http://spec.openapis.org/oas/v3.0.3" class="tei-link4" target="_new">Open API standard</a>
      defines all the
        server-side API endpoints available in Publisher.
    </p>

    <p class="tei-para">The image below presents a section of the API handling all ODD-related operations:
        creating, retrieving, updating, deleting, recompiling; syntax check for a code fragment
        (lint); retrieving a list of all available ODDs.</p>

    <figure class="tei-figure2 figure"><span class="tei--element">
        <span class="tei--element">
          <img src="api-spec.png" class="tei-imagedata2" title="" style="width: 900px; ">
        </span>
      </span><figcaption>TEI Publisher API page - the odd endpoint</figcaption></figure>

    <div class="tei-section3" id="api-advantages"><pb-observable data="0,3.18.13" emit="transcription">
      <h2 class="tei-title7 title">Advantages of the API-based approach</h2>
      <ul class="tei-itemizedlist"><li class="tei-listitem">
          <p class="tei-para">
            <span class="tei-emphasis1">clear specification and easy overview</span>
          </p>
          <p class="tei-para">users and developers will benefit from the clear specification for available
              functionality</p>
        </li><li class="tei-listitem">
          <p class="tei-para">
            <span class="tei-emphasis1">customizable</span>
          </p>
          <p class="tei-para">users can easily overwrite and extend existing API endpoints as well as add custom
              ones for project-specific functionality</p>
        </li><li class="tei-listitem">
          <p class="tei-para">
            <span class="tei-emphasis1">separation of concerns</span>
          </p>
          <p class="tei-para">server-side functionality can be used directly by any software system, not
              necessarily within the context of the TEI Publisher or using Publisher's UI
              components; further changes in internal API implementation do not require any
              adjustments of the UI components</p>
        </li><li class="tei-listitem">
          <p class="tei-para">
            <span class="tei-emphasis1">standard-based</span>
          </p>
          <p class="tei-para">OAS compliance means we are using a well-known and documented standard and can
              benefit from existing tools for writing, testing and generating documentation</p>
        </li></ul>
    </pb-observable></div>

    
    <div class="tei-section3" id="api-endpoints"><pb-observable data="0,3.18.17" emit="transcription">
      <h2 class="tei-title7 title">API endpoint groups</h2>
      <p class="tei-para">TEI Publisher 7 groups server-side functionality into several main sections:</p>
      <dl><dt>documents</dt><dd>
            <p class="tei-para">Retrieve entire or part of a document content transformed to a target format;
                retrieve document's table of contents; delete a document.</p>
          </dd><dt>collection</dt><dd>
            <p class="tei-para">Browse the collection hierarchy and upload new files.</p>
          </dd><dt>odd</dt><dd>
            <p class="tei-para">Manage the ODD files stored in TEI Publisher: create, retrieve, update, delete,
                recompile; check syntax for a code fragment (lint); retrieve a list of available
                ODDs.</p>
          </dd><dt>search</dt><dd>
            <p class="tei-para">Search: run a search through collections; list facets for the search results;
                list autocomplete options.</p>
          </dd><dt>transform</dt><dd>
            <p class="tei-para">Transform content on the fly: convert a Word document to TEI or POST an XML
                document and get its preview rendered via ODD.</p>
          </dd><dt>view</dt><dd>
            <p class="tei-para">View documents via an HTML template; list available templates.</p>
          </dd><dt>apps</dt><dd>
            <p class="tei-para"> Operations for managing apps: generate a standalone application or package and
                download an app.</p>
          </dd><dt>dts</dt><dd>
            <p class="tei-para"> Implementation of the DTS (Distributed Text Services) API.</p>
          </dd><dt>user</dt><dd>
            <p class="tei-para">Login: authorize the user.</p>
          </dd><dt>info</dt><dd>
            <p class="tei-para">Information about the server: the API version.</p>
          </dd></dl>

      
    </pb-observable></div>
    <div class="tei-section3" id="api-custom-endpoints"><pb-observable data="0,3.18.19" emit="transcription">
      <h2 class="tei-title7 title">Custom API endpoints</h2>
      <p class="tei-para">
        Beyond the standard server-side functionality provided by TEI Publisher, careful
          provisions have been made to allow users to add their own API endpoints. The
        <a href="../api.html#operations-tag-default" class="tei-link4" target="_new">Custom API</a>
        section demonstrates how project-specific functionality can be added within the OAS API
          scheme.
      </p>
      <p class="tei-para">
        All that is required is to edit the
        <span class="tei-filename code">modules/custom-api.json</span>
        file
          and add specifications for custom endpoints in JSON format. The
        <span class="tei-parameter code">operationId</span>
        property specifies the XQuery function to be called
          to process the request. All function module with the function definition needs to be
          imported into
        <span class="tei-filename code">modules/custom-api.xql</span>
        so that the request can be
          correctly resolved.
      </p>
      <p class="tei-para">
        The function implementation can either be added to the XQuery module
        <span class="tei-filename code">modules/custom-api.xql</span>
        or to a new module, which should be imported
          into this file to make it known. See the
        <a href="https://github.com/eeditiones/oas-router" class="tei-link4" target="_new">README</a>
        of the oas-router
          package for more information about how to write a request handler function.
      </p>
      <figure class="tei-figure2 figure"><span class="tei--element">
          <span class="tei--element">
            <img src="api-custom-json.png" class="tei-imagedata2" title="" style="width: 900px; ">
          </span>
        </span><figcaption>Custom API specification - show article</figcaption></figure>
      <p class="tei-para">
        To reference a custom function declared directly in
        <span class="tei-filename code">modules/custom-api.xql</span>
        , use the prefix
        <span class="tei-parameter code">custom:</span>
        in the
        <span class="tei-parameter code">operationId</span>
        . For functions
          in imported modules, use the prefix defined in the import statement.
      </p>
    </pb-observable></div>
  </pb-observable></div>

  <div class="tei-section3" id="i18n"><pb-observable data="0,3.20" emit="transcription">
    <h1 class="tei-title7 title">Language versions</h1>
    <p class="tei-para">TEI Publisher is already available in twenty languages and this number increases thanks
        to the engagement of our user community.</p>

    <p class="tei-para">With version 6.0 i18n support has been greatly extended to cover not only labels and
        attribute values in HTML templates but also within web components. A mechanism for project
        specific language files extending the default Publisher label collection has been
        added.</p>
    <p class="tei-para">
      Thanks to community contributions via
      <a href="https://crwd.in/tei-publisher" class="tei-link5" target="">Crowdin</a>
      a number of languages has been added and existing ones are updated when
        needed. We welcome and encourage additions and amendments. Please consider Crowdin a master
        repository for translations and publish your contributions there instead of submitting PR
        directly. Do not hesitate to get in touch if a language you'd like to support is not yet
        listed.
    </p>
    <p class="tei-para">
      Crowdin users are only exposed to form-based graphical user interface but i18n files are
        using JSON format to preserve their logical structure. Initial portion of German
        localization file
      <span class="tei-filename code">de.json</span>
      is shown below for illustration.
    </p>
    <figure class="tei-figure2 figure"><span class="tei--element">
        <span class="tei--element">
          <img src="i18n-json-structure.png" class="tei-imagedata2" title="">
        </span>
      </span><figcaption>Translation JSON file structure</figcaption></figure>
    <p class="tei-para">
      In TEI Publisher and in generated apps translation files are by default loaded from CDN
        with
      <span class="tei-code2 code">pb-components</span>
      . When it is necessary for a project to add new labels or
        change wording of existing ones, a customization mechanism is described
      <a href="?odd=docbook.odd&amp;view=&amp;id=i18n-customization" class="tei-link3" target="">below</a>
      .
    </p>
    <div class="tei-section3" id="i18n-page-templates"><pb-observable data="0,3.20.17" emit="transcription">
      <h2 class="tei-title7 title">Using i18n in page templates</h2>
      <p class="tei-para">There are several scenarios for using i18n labels:</p>
      <ul class="tei-itemizedlist"><li class="tei-listitem">
          <p class="tei-para">directly within HTML element</p>
        </li><li class="tei-listitem">
          <p class="tei-para">in an attribute</p>
        </li><li class="tei-listitem">
          <p class="tei-para">passed in component-specific structure</p>
        </li></ul>
      <div class="tei-section3" id="i18n-page-templates-pb-i18n"><pb-observable data="0,3.20.17.9" emit="transcription">
        <h3 class="tei-title7 title">
          HTML text node with
          <span class="tei-code2 code">pb-i18n</span>
        </h3>
        <p class="tei-para">
          Any text fragment within HTML element can be considered a target for i18n when
            wrapped in
          <span class="tei-tag code">pb-i18n</span>
          component.
          <span class="tei-tag code">pb-i18n</span>
          elements are listening for
            events emitted by
          <span class="tei-tag code">pb-lang</span>
          .
        </p>
        <pb-code-highlight class="tei-programlisting5" language="html" line-numbers="line-numbers">
&lt;h3 slot="collapse-trigger"&gt;
   &lt;pb-i18n key="menu.documentation"&gt;Documentation&lt;/pb-i18n&gt;
&lt;/h3&gt;
        </pb-code-highlight>
      </pb-observable></div>
      <div class="tei-section3" id="i18n-page-templates-attributes"><pb-observable data="0,3.20.17.11" emit="transcription">
        <h3 class="tei-title7 title">Attributes (on HTML elements or custom web components)</h3>
        <p class="tei-para">
          When it is necessary to translate the value of an attribute a mechanism based on
          <span class="tei-code2 code">data-</span>
          attributes is used. Supply additional
          <span class="tei-code2 code">data-i18n</span>
          attribute specifying the key of the i18n label to use preceded by the name of the
            attribute that needs to be translated. In the example below it's the
          <span class="tei-code2 code">heading</span>
          attribute that needs to be filled with the translated version of
          <span class="tei-emphasis2">ODD Files</span>
          label. The label is stored in JSON file under
          <span class="tei-code2 code">odd.files</span>
          , so
          <span class="tei-code2 code">[heading]odd.files</span>
          needs to be used for the
          <span class="tei-code2 code">data-i18n</span>
          attribute.
        </p>
        <pb-code-highlight class="tei-programlisting5" language="xml" line-numbers="line-numbers">
&lt;paper-card data-i18n="[heading]odd.files" class="odds" heading="ODD Files"&gt;
   &lt;div class="card-content"&gt; ... content of the ODD list &lt;/div&gt;
&lt;/paper-card&gt;
        </pb-code-highlight>
        <p class="tei-para">
          When
          <span class="tei-tag code">pb-lang</span>
          is switched to Spanish, the
          <span class="tei-tag code">paper-card</span>
          heading
            will read
          <span class="tei-emphasis2">Archivos ODD</span>
          instead of
          <span class="tei-emphasis2">ODD
            Files</span>
          .
        </p>
        <figure class="tei-figure2 figure"><span class="tei--element">
            <span class="tei--element">
              <img src="i18n-attribute.png" class="tei-imagedata2" title="" style="width: 300px; ">
            </span>
          </span><figcaption>
            Output for
            <span class="tei-tag code">paper-card</span>
            with translated
            <span class="tei-code2 code">@heading</span>
          </figcaption></figure>
      </pb-observable></div>
      <div class="tei-section3" id="i18n-page-templates-properties"><pb-observable data="0,3.20.17.13" emit="transcription">
        <h3 class="tei-title7 title">Special web component properties configured via attributes</h3>
        <p class="tei-para">
          Some web components accept more complex configuration options via arrays passed in
            attributes. For example,
          <span class="tei-tag code">pb-browse-docs</span>
          component allows to specify a number
            of label/value pairs for dropdown menus used for ordering and filtering the document
            list. Understandably, the labels should switch in line with changes to the language
            chosen via
          <span class="tei-tag code">pb-lang</span>
          . Therefore i18n translation keys like
          <span class="tei-emphasis2">browse.title</span>
          or
          <span class="tei-emphasis2">browse.author</span>
          are used
            instead of text values. Note that web components may have particular expectations for
            the data format expected so consult API documentation for each component.
        </p>
        <pb-code-highlight class="tei-programlisting5" language="html" line-numbers="line-numbers">
&lt;pb-browse-docs id="document-list" url="collection/" 
      sort-options='[{"label": "browse.title", "value": "title"},{"label": "browse.author", "value": "author"}]' 
      sort-by="title"
      filter-options='[{"label": "browse.title", "value": "title"},{"label": "browse.author", "value": "author"},{"label": "browse.file", "value": "file"}]' 
      filter-by="title" 
      auto="auto" history="history" login="login" emit="docs" subscribe="docs"&gt;
  &lt;pb-paginate slot="toolbar" id="paginate" per-page="10" range="5" emit="docs" subscribe="docs"&gt;&lt;/pb-paginate&gt;
&lt;/pb-browse-docs&gt;
         </pb-code-highlight>
      </pb-observable></div>
    </pb-observable></div>

    <div class="tei-section3" id="i18n-customization"><pb-observable data="0,3.20.19" emit="transcription">
      <h2 class="tei-title7 title">Project specific i18n files</h2>
      <p class="tei-para">It is a common need that projects will need their own internationalized labels for
          menu items, dialogs and other user interface elements.</p>
      <p class="tei-para">All these can be stored in JSON language files, following the same naming conventions
          and basic structure as TEI Publisher ones. To use custom language files, you need to
          specify the path under which they can be found relative to your application:</p>
      <pb-code-highlight class="tei-programlisting5" language="html" line-numbers="line-numbers">&lt;pb-page locales="resources/i18n/{{ns}}/{{lng}}.json"&gt;</pb-code-highlight>
      <p class="tei-para">
        The path expression requires placeholders for two parameters
        <span class="tei-parameter code">ns</span>
        and
        <span class="tei-parameter code">lng</span>
        :
      </p>
      <dl><dt>lng</dt><dd>
            <p class="tei-para">
              the language code for a selected language, e.g.
              <span class="tei-code2 code">de</span>
              or
              <span class="tei-code2 code">fr</span>
            </p>
          </dd><dt>ns</dt><dd>
            <p class="tei-para">
              the namespace prefix used to distinguish between different collections of
                language files. By default, TEI Publisher expects custom language files to be in a
                namespace called
              <span class="tei-code2 code">app</span>
              , though this can be configured.
            </p>
          </dd></dl>
      <p class="tei-para">
        So given above configuration, TEI Publisher will search for a custom language file
          for, say, French in
        <span class="tei-code2 code">resources/i18n/app/fr.json</span>
        . If you prefer a flat
          directory structure, you could change the
        <span class="tei-parameter code">locale</span>
        to
        <span class="tei-code2 code">resources/i18n/{{ns}}_{{lng}}.json</span>
        and TEI Publisher will look for a file
        <span class="tei-code2 code">resources/i18n/app_fr.json</span>
        .
      </p>
      <p class="tei-para">
        You may also define additional namespaces to be searched with the
        <span class="tei-parameter code">locale-fallback-ns</span>
        parameter:
      </p>
      <pb-code-highlight class="tei-programlisting5" language="html" line-numbers="line-numbers">&lt;pb-page locales="resources/i18n/{{ns}}/{{lng}}.json"
        locale-fallback-ns="app my-module"&gt;</pb-code-highlight>
      <p class="tei-para">
        which means that TEI Publisher will search for labels in the
        <span class="tei-code2 code">my-module</span>
        namespace first, then falling back to the
        <span class="tei-code2 code">app</span>
        namespace, and if the label
          could still not be found, using TEI Publisher's default namespace. The latter is called
        <span class="tei-code2 code">common</span>
        and should not be overwritten.
      </p>
      <p class="tei-para">
        Listing below demonstrates a fictional
        <span class="tei-filename code">en.js</span>
        with a custom set of
          labels. A new top-level key has been added as well as 3 subkeys for the
        <span class="tei-code2 code">menu</span>
        section. Now the project has access to a number of new i18n keys:
        <span class="tei-code2 code">menu.about</span>
        ,
        <span class="tei-code2 code">menu.contact</span>
        ,
        <span class="tei-code2 code">menu.statute</span>
        and
        <span class="tei-code2 code">greeting</span>
        .
      </p>
      <p class="tei-para">
        Furthermore, a value for
        <span class="tei-code2 code">menu.documentation</span>
        has been specified. That key
          already existed in Publisher (set to "Documentation") but the version from custom file
          will take precedence and be used in the custom app.
      </p>
      <pb-code-highlight class="tei-programlisting5" language="js" line-numbers="line-numbers">
{
  "menu": {
    "documentation": "Docu",
    "about": "About",
    "contact": "Contact",
    "statute": "Statute"
    },
  "greeting": "Welcome"
}
      </pb-code-highlight>
      <p class="tei-para"></p>
    </pb-observable></div>
  </pb-observable></div>

  <div class="tei-section3" id="appgen"><pb-observable data="0,3.22" emit="transcription">
    <h1 class="tei-title7 title">Creating applications with the App Generator</h1>
    <p class="tei-para">Once you are happy with a certain ODD and HTML template customization, you can easily
        create a complete, standalone application. Such application can be tailored further to fit
        your needs. The generated app can be downloaded as a portable xar package, to be installed
        into other eXist instances, or synchronised to disk for further development. It provides a
        fully functional application scaffolding based on TEI Publisher components and modules,
        pre-configured to use a certain ODD, page template and other settings.</p>
    <div class="tei-note3 note"><h4 class="tei-title4">Note</h4><p class="tei-para">Early versions of the TEI Publisher included everything they needed to run without TEI
          Publisher. This had some advantages, but also made it more difficult to update to newer
          releases.</p><p class="tei-para">
        Starting with version 5 we are gradually moving towards more lightweight app design,
          ultimately containing only resources which are truly specific to the app (ODDs, HTML
          templates, images), while all generic functionality will be provided by TEI Publisher and
          its libraries and packages. Version 6 has seen all web components extracted into
        <span class="tei-code2 code">pb-components</span>
        package and in version 7 the server-side code has been based
          on a well designed API specification with provisions for easy customization.
        
      </p><p class="tei-para">
        Please make sure you are following our
        <a href="?odd=docbook.odd&amp;view=&amp;id=customization-best-practice" class="tei-link3" target="">best practice recommendations</a>
        for a smooth upgrade path.
      </p></div>
    <p class="tei-para">
      To get started, click on
      <span class="tei--element">App Generator</span>
      in the menu bar and
        fill out the form.
    </p>

    <p class="tei-para">The following form fields are of particular importance:</p>
    <dl><dt>ODD</dt><dd>
          <p class="tei-para">Here you select the ODD(s) to be used for transformations. If multiple ODDs are
              selected, the first one will be the default.</p>
        </dd><dt>URL to identify the app</dt><dd>
          <p class="tei-para">This is the main identifier for your app and should be a globally unique URI. It
              does not need to correspond to any existing web site. eXist's package manager is using
              this URI as a unique identifier for the app.</p>
        </dd><dt>Abbreviation</dt><dd>
          <p class="tei-para">The abbreviation will be used as the name of the root collection of your app and
              as the last path component in any URL pointing to the app. It should be unique within
              one database instance.</p>
        </dd><dt>Template</dt><dd>
          <p class="tei-para">The HTML template to be used as default for viewing a document. If you created a
              custom template or modified any of the existing templates, you likely want to select
              this here.</p>
        </dd><dt>Data Collection</dt><dd>
          <p class="tei-para">Only specify something here if you have existing data inside the database or if
              you want to ship the data set as part of a second, separate app. In all other cases,
              leave this field empty.</p>
        </dd><dt>Default View</dt><dd>
          <p class="tei-para">
            Default document view - whole document, page by page or division by division. If
              you would like to choose page by page, set this to
            <span class="tei--element">"By
                Page"</span>
            but please note that all your documents must be appropriately
              encoded with page breaks as
            <span class="tei-tag code">pb</span>
            elements. You will still be able to change
              the view settings in HTML template or users can do it via query parameters.
          </p>
        </dd><dt>User/Password</dt><dd>
          <p class="tei-para">The user account which will own all application files. For security reasons, it is
              advisable to create a new account for every app.</p>
        </dd></dl>
    <p class="tei-para">Once you created the new application, log into it using the account details you
        provided. You can then upload XML documents using the upload panel in the sidebar.</p>
    <figure class="tei-figure2 figure" id="create-app"><span class="tei--element">
        <span class="tei--element">
          <img src="CreateApp.gif" class="tei-imagedata2" title="">
        </span>
      </span><figcaption>Create an App</figcaption></figure>
    <div class="tei-section3" id="appgen-code-overview"><pb-observable data="0,3.22.19" emit="transcription">
      <h2 class="tei-title7 title">Generated Code Overview</h2>
      <div class="tei-section3" id="appgen-code-overview-xquery"><pb-observable data="0,3.22.19.5" emit="transcription">
        <h3 class="tei-title7 title">XQuery Code</h3>
        <p class="tei-para">
          The collection structure of the generated app follows typical design of many eXist
            apps.
          <a href="?odd=docbook.odd&amp;view=&amp;id=customization-best-practice" class="tei-link3" target="">Best practices</a>
          for modifying
            the app are discussed in further sections of this document. You can find the code of
            your generated app within the
          <span class="tei-filename code">/db/apps</span>
          collection under the name
            you provided in the
          <span class="tei-emphasis2">abbreviation</span>
          field of the generator
            form.
        </p>
        <dl><dt>modules</dt><dd>
              <p class="tei-para">
                Contains XQuery modules used by the app, including the copied TEI Publisher
                  libraries in
                <span class="tei-filename code">modules/lib</span>
                subcollection.
              </p>
            </dd><dt>resources</dt><dd>
              <p class="tei-para">
                Contains a number of subcollections for various resources used by the app,
                  such as images, fonts or JavaScript libraries. Of particular interest is the
                <span class="tei-filename code">resources/odd</span>
                subcollection where app's own ODD files are
                  stored.
              </p>
              <p class="tei-para">
                All of the app styling is done via a set of modularized less stylesheets,
                  residing in
                <span class="tei-filename code">resources/css</span>
                . The main file is
                <span class="tei-filename code">style.less</span>
                , which defines a number of core parameters.
                  Ideally this should be the only file you ever need to modify.
              </p>
            </dd><dt>templates</dt><dd>
              <p class="tei-para">Html templates for the templating framework. Contain page templates as well as
                  smaller components such as menu or login pane.</p>
            </dd><dt>transform</dt><dd>
              <p class="tei-para">This collections contains XQuery modules governing the transformations and
                  styles generated from app's ODD. Its content will be overwritten with each ODD
                  recompilation, thus there's no point modifying it. It's worth consulting though to
                  gain better understanding and troubleshoot the transformations with TEI Processing
                  Model. In case of an issue, it may help to know the files: </p>
              <dl><dt>{myodd}-web.xql</dt><dd>
                    <p class="tei-para">The transformation module generated for output mode "web".</p>
                  </dd><dt>{myodd}-web-module.xql</dt><dd>
                    <p class="tei-para">Library module which calls the transformation module.</p>
                  </dd><dt>{myodd}.css</dt><dd>
                    <p class="tei-para">CSS styles generated from the ODD.</p>
                  </dd></dl>
              <p class="tei-para">Files start with the name of the odd and the output mode they belong
                  to.</p>
            </dd></dl>
      </pb-observable></div>
    </pb-observable></div>
    <div class="tei-section3" id="appgen-modify"><pb-observable data="0,3.22.21" emit="transcription">
      <h2 class="tei-title7 title">Modifying the App</h2>
      <p class="tei-para">
        When you are logged in, the
        <span class="tei-guibutton guibutton">Admin</span>
        menu in the top navbar
          provides various links for ease of customization of your app:
      </p>
      <dl><dt>Recompile ODD</dt><dd>
            <p class="tei-para">After changing the application's ODD, click here to update the app.</p>
          </dd><dt>Edit ODD</dt><dd>
            <p class="tei-para">Opens the application's ODD in eXide for editing.</p>
          </dd></dl>

      <div class="tei-section3" id="multiple-odds"><pb-observable data="0,3.22.21.9" emit="transcription">
        <h3 class="tei-title7 title">Using Multiple ODDs</h3>

        <p class="tei-para">For performance reasons, the mechanism used by generated apps to transform a
            document via an ODD is slightly different to the one in the main TEI Publisher app:
            while TEI Publisher resolves ODDs dynamically, generated apps use a static lookup
            method. </p>
        <p class="tei-para">The static method is much faster, resulting in better overall performance, but as a
            consequence ODDs are not automatically detected by the app, and need to be explicitly
            registered.</p>
        <p class="tei-para">
          Each generated app will by default use a single ODD for all transformations but it
            is possible to add additional ODDs, e.g. to be used with a
          <span class="tei-code2 code">pb-view</span>
          in a
            custom HTML template. If multiple ODDs are selected when generating the app, the app
            generator will take care of registering those ODDs. If you would like to add ODDs
            manually later, the procedure is as follows:
        </p>
        <ol class="tei-procedure"><li class="tei-step">
            <p class="tei-para">
              Upload the ODD to the
              <span class="tei-filename code">resources/odd</span>
              collection below your
                app root. This can either be done via
              <span class="tei-emphasis2">eXide</span>
              or the
              <span class="tei-guibutton guibutton">Upload</span>
              panel on the start page of your app.
            </p>
          </li><li class="tei-step">
            <p class="tei-para">
              In
              <span class="tei-filename code">modules/config.xqm</span>
              find the variable called
              <span class="tei-parameter code">$config:odd-available</span>
              and add the name of the new ODD to
                the sequence.
            </p>
            <pb-code-highlight class="tei-programlisting5" language="xquery" line-numbers="line-numbers">(:~
 : The main ODD to be used by default
 :)
declare variable $config:default-odd :="shakespeare.odd";

(:~
 : Complete list of ODD files used by the app. If you add another ODD to this list,
 : make sure to run modules/generate-pm-config.xql to update the main configuration
 : module for transformations (modules/pm-config.xql).
 :)
declare variable $config:odd-available :=("shakespeare.odd");</pb-code-highlight>
          </li><li class="tei-step">
            <p class="tei-para">
              In eXide, open
              <span class="tei-filename code">modules/generate-pm-config.xql</span>
              (path
                relative to your app root) and execute it once. This will regenerate the XQuery
                module
              <span class="tei-filename code">modules/pm-config.xql</span>
              , which registers all the ODD
                modules known to the app.
            </p>
          </li><li class="tei-step">
            <p class="tei-para">Additionally you need to regenerate all ODDs used by the app by either</p>
            <ol class="tei-orderedlist"><li class="tei-listitem">
                <p class="tei-para">
                  Clicking the
                  <span class="tei-guibutton guibutton">Regenerate all ODDs</span>
                  button on the start
                    page of the app
                </p>
              </li><li class="tei-listitem">
                <p class="tei-para">
                  Via the api documentation page
                  <span class="tei-filename code">api.html</span>
                  by executing
                    the
                  <span class="tei-parameter code">POST</span>
                  version of the
                  <span class="tei-code2 code">/api/odd</span>
                  .
                </p>
              </li></ol>
          </li></ol>
        <div class="tei-section3" id="multiple-odds-collection"><pb-observable data="0,3.22.21.9.13" emit="transcription">
          <h4 class="tei-title7 title">Using different ODDs depending on the collection</h4>
          <p class="tei-para">
            By default the same ODD will be used for all documents within the app. It is
              possible though to organize documents into a
            <a href="?odd=docbook.odd&amp;view=&amp;id=subcollections" class="tei-link3" target="">hierarchy
                of collections</a>
            beneath
            <span class="tei-parameter code">$config:data-root</span>
            and use
              different ODDs and general view settings for each collection or document type.
          </p>
          <p class="tei-para">
            To do so, search for the function
            <span class="tei-function code">config:collection-config</span>
            ,
              which by default returns an empty sequence - meaning that the default configuration
              should be used. Comment this out and enable the switch/case statement below to return
              a different config depending on the current collection. The
            <span class="tei-parameter code">$collection</span>
            and
            <span class="tei-parameter code">$docUri</span>
            parameters be
              relative paths, i.e. relative to
            <span class="tei-parameter code">$config:data-root</span>
            . So for a
              single level hierarchy as used in TEI Publisher by default,
            <span class="tei-parameter code">$collection</span>
            will be either
            <span class="tei-code2 code">test</span>
            ,
            <span class="tei-code2 code">playground</span>
            or
            <span class="tei-code2 code">doc</span>
            . For multi-level hierarchies it might
              also be e.g.
            <span class="tei-code2 code">volume1/transcripts</span>
            . In this case a simple switch/case might
              not be enough, but you can just replace it with an if/then/else and apply any path
              matching you like.
          </p>

          <pb-code-highlight class="tei-programlisting5" language="xquery" line-numbers="line-numbers">
declare function config:collection-config($collection as xs:string?, $docUri as xs:string?) {
    (: Return empty sequence to use default config :)
    ()

    (: 
     : Replace line above with the following code to switch between different view configurations per collection.
     : $collection corresponds to the relative collection path (i.e. after $config:data-root). 
     :)
    (:
    switch ($collection)
        case "playground" return
            map {
                "odd": "dodis.odd",
                "view": "body",
                "depth": $config:pagination-depth,
                "fill": $config:pagination-fill,
                "template": "facsimile.html"
            }
        default return
            ()
    :)
};
          </pb-code-highlight>
          <p class="tei-para">Instead of switching by collection, you could also configure different views
              depending on the type of document, e.g. by checking the type of the first div: </p>
          <pb-code-highlight class="tei-synopsis4" language="xquery">doc($config:data-root || "/" || $docUri)//tei:body/tei:div/@type</pb-code-highlight>
        </pb-observable></div>
      </pb-observable></div>
    </pb-observable></div>

    <div class="tei-section3" id="appgen-export"><pb-observable data="0,3.22.23" emit="transcription">
      <h2 class="tei-title7 title">Exporting the Finished App</h2>
      <p class="tei-para">
        To save your finished application or exchange it with other people, you need to save
          it as an application archive. Application archives use a standardized
        <a href="https://exist-db.org/exist/apps/doc/repo#expath-pkg" class="tei-link4" target="_new">EXPath
            Packaging</a>
        format: the resulting
        <span class="tei-filename code">.xar</span>
        file can be uploaded to
          any eXist instance via the
        <span class="tei-guibutton guibutton">Dashboard</span>
        and the
        <span class="tei-guibutton guibutton">Package
            manager</span>
        will take care of the deployment.
      </p>
      <p class="tei-para">
        There are two ways to create a
        <span class="tei-filename code">.xar</span>
        file from your
          application:
      </p>
      <ol class="tei-orderedlist"><li class="tei-listitem">
          <p class="tei-para">
            Use the
            <span class="tei-guibutton guibutton">Admin </span>
            /
            <span class="tei-guibutton guibutton">Download App</span>
            menu
              entry in generated app to directly download a
            <span class="tei-filename code">.xar</span>
          </p>
        </li><li class="tei-listitem">
          <p class="tei-para">
            Synchronize the application to a directory on disk via
            <span class="tei-guibutton guibutton">Application</span>
            /
            <span class="tei-guibutton guibutton">Synchronize</span>
            in
            <span class="tei-emphasis1">eXide</span>
          </p>
        </li></ol>
      <p class="tei-para">
        The first approach is recommended if all you need is a copy of you app on disk. A
        <span class="tei-filename code">.xar</span>
        is just a ZIP archive, so you can unpack it into a directory
          of your choice, which you can then commit to a version control system like git.
      </p>
      <p class="tei-para">However, if you continue to make changes inside the database (e.g. further work on the
          ODD), you may want to use the second method, i.e. call eXide's synchronization. It
          requires that you have access to the file system of the server running eXist though, so
          it's usually only an option if you run your own eXist instance locally. The synchronize
          steps in detail:</p>
      <ul class="tei-itemizedlist"><li class="tei-listitem">
          <p class="tei-para">
            Prerequisite: you need to have the
            <a href="http://ant.apache.org/" class="tei-link4" target="_new">Apache Ant</a>
            build tool installed.
          </p>
        </li><li class="tei-listitem">
          <p class="tei-para">
            Open one resource belonging to your application in eXide. It doesn't matter which
              one. The only important thing is that the name of your app is displayed next to
            <span class="tei-guibutton guibutton">Current app:</span>
            on the top right of the eXide window. If this is
              not the case, stop and check again!
          </p>
        </li><li class="tei-listitem">
          <p class="tei-para">
            Click
            <span class="tei-guibutton guibutton">Application</span>
            /
            <span class="tei-guibutton guibutton">Synchronize</span>
            in
              the menu. It opens up a dialog with two fields:
            <span class="tei-guibutton guibutton">Start time</span>
            and
            <span class="tei-guibutton guibutton">Target directory</span>
            . When you synchronize the first time, empty
              the
            <span class="tei-guibutton guibutton">Start time</span>
            field. Enter a valid, absolute directory path on
              your server machine into
            <span class="tei-guibutton guibutton">Target directory</span>
            .
          </p>
        </li><li class="tei-listitem">
          <p class="tei-para">
            Click the
            <span class="tei-guibutton guibutton">Synchronize</span>
            button. This may take a moment, but
              you should see a list of written files at the bottom of the dialog afterwards.
          </p>
        </li><li class="tei-listitem">
          <p class="tei-para">Change to the directory you specified for synchronize.</p>
        </li></ul>

      <p class="tei-para">Watch the screencast below for the whole synchronization procedure.</p>
      <div class="tei-note3 note"><h4 class="tei-title4">Note</h4><p class="tei-para">
          for security reasons, the password you entered when creating the app is not stored
            in the database, so it cannot be synchronized to disk. To restore a password for your
            app, you thus need to edit the
          <span class="tei-filename code">repo.xml</span>
          file in the directory and
            add a
          <span class="tei-parameter code">@password</span>
          attribute to the
          <span class="tei-tag code">permissions</span>
          element.
        </p></div>
      <figure class="tei-figure2 figure" id="sync"><span class="tei--element">
          <span class="tei--element">
            <img src="Sync.gif" class="tei-imagedata2" title="">
          </span>
        </span><figcaption>Export an App</figcaption></figure>
    </pb-observable></div>
    <div class="tei-section3" id="appgen-build"><pb-observable data="0,3.22.25" emit="transcription">
      <h2 class="tei-title7 title">Building from a directory</h2>
      <p class="tei-para">
        Once you have a copy of your app extracted in a local directory, you can always
          rebuild a fresh
        <span class="tei-filename code">.xar</span>
        from it. In the simplest case it is sufficient
          to call
        <span class="tei-command code">ant</span>
        inside the directory.
      </p>
      <p class="tei-para">
        For up to date build instructions which also cover more advanced uses, refer to the
          "Building" section in the
        <a href="https://github.com/eeditiones/tei-publisher-app" class="tei-link5" target="">readme of the TEI Publisher
            repository</a>
        .
      </p>
    </pb-observable></div>
  </pb-observable></div>
  <div class="tei-section3" id="customization-best-practice"><pb-observable data="0,3.24" emit="transcription">
    <h1 class="tei-title7 title">Best Practice Recommendations</h1>
    <p class="tei-para">In case you'd wish to further customize the generated app it's worth to keep the changes
        as much separated from the generated code as possible to allow for future alignment with
        newer versions of the TEI Publisher. </p>
    <p class="tei-para">
      The generated app shares most of its XQuery libraries with the main TEI Publisher app. A
        copy of those is included in the
      <span class="tei-filename code">lib/</span>
      collection of the generated app
        and
      <span class="tei-emphasis1">should not</span>
      be modified! This way you can later update
        the libraries to a newer TEI Publisher release without breaking your app. Including the
        libraries in the generated app creates some redundancy, but we chose to accept this
        trade-off to make it easier to view and modify everything relevant to the app.
    </p>
    <p class="tei-para">
      Meanwhile, if you find that modifications of
      <span class="tei-filename code">lib/</span>
      modules are
        necessary, please consider if your change would be generally beneficial for TEI Publisher
        and create PR for the TEI Publisher if so.
    </p>
    <p class="tei-para">
      It is
      <span class="tei-emphasis1">considered safe</span>
      :
    </p>
    <ol class="tei-orderedlist"><li class="tei-listitem">
        <p class="tei-para">
          to modify all HTML templates below
          <span class="tei-filename code">templates/</span>
          as well as
          <span class="tei-filename code">index.html</span>
          and
          <span class="tei-filename code">search.html</span>
          in the root of
            the app
        </p>
      </li><li class="tei-listitem">
        <p class="tei-para">
          to change XQuery modules in
          <span class="tei-filename code">modules</span>
          , excluding those in
          <span class="tei-filename code">modules/lib</span>
        </p>
      </li><li class="tei-listitem">
        <p class="tei-para">
          to add images, fonts or change i18n translations below
          <span class="tei-filename code">resources</span>
        </p>
      </li><li class="tei-listitem">
        <p class="tei-para">
          to add custom API functions (written in XQuery) to
          <span class="tei-filename code">custom-api.json</span>
          and
          <span class="tei-filename code">custom-api.xql</span>
        </p>
      </li></ol>
    <p class="tei-para">
      The following core XQuery modules in every app are safe to be modified (all are stored
        in
      <span class="tei-filename code">modules</span>
      subcollection:
    </p>
    <dl><dt>
          <span class="tei-filename code">config.xqm</span>
        </dt><dd>
          <p class="tei-para">The main configuration file for the app. It contains a number of parameters which
              control important aspects.</p>
        </dd><dt>
          <span class="tei-filename code">custom-api.xql</span>
        </dt><dd>
          <p class="tei-para">Custom API functions should be defined in this module - or a module imported by
              it. Also, HTML templating modules should be imported into this module to be registered
              with the TEI Publisher.</p>
        </dd><dt>
          <span class="tei-filename code">app.xql</span>
        </dt><dd>
          <p class="tei-para">Add your own HTML templating functions in XQuery here if needed. With TEI
              Publisher 4.0 or later, there should be less of a need to extend this file as most of
              the application logic is realized via web components.</p>
        </dd><dt>
          <span class="tei-filename code">pm-config.xql</span>
        </dt><dd>
          <p class="tei-para">
            This file is usually generated by calling
            <span class="tei-filename code">modules/generate-pm-config.xql</span>
            (see the
            <a href="?odd=docbook.odd&amp;view=&amp;id=multiple-odds" class="tei-link3" target="">corresponding section</a>
            ). It defines the functions to
              be called for rendering TEI content via the processing model. It imports the modules
              generated from your ODD and assigns them to variables as function pointers. This
              approach is much more efficient than the dynamic lookups done by the main TEI
              Publisher app. It has been production tested on large web sites.
          </p>
        </dd><dt>
          <span class="tei-filename code">navigation-*.xql</span>
        </dt><dd>
          <p class="tei-para">This group of modules contains functions relevant for the display and navigation
              of documents corresponding to a given document type</p>
        </dd><dt>
          <span class="tei-filename code">query-*.xql</span>
        </dt><dd>
          <p class="tei-para">Modules with functions powering the search features</p>
        </dd><dt>
          <span class="tei-filename code">view.xql</span>
        </dt><dd>
          <p class="tei-para">The main module of the app. This module initializes eXist's templating system. The
              only case when it should be modified is if you want to add further XQuery library
              modules containing template functions.</p>
        </dd></dl>
  </pb-observable></div>

  <div class="tei-section3" id="updating"><pb-observable data="0,3.26" emit="transcription">
    <h1 class="tei-title7 title">Updating Applications</h1>
    <p class="tei-para">With TEI Publisher 7, we have redesigned the server-side API. Combined with the
        client-side reorganization brought by TEI Publisher 6, this will make future updates for
        generated applications a lot easier. Client-side UI and server-side API are now cleanly
        separated from any custom app elements.</p>
    <p class="tei-para">For apps created with TEI Publisher 6 updating to 7 requires only small modifications.
        Migrating from earlier versions, like 4 or 5, requires more effort, and is described in
        futher sections.</p>
    <div class="tei-section3" id="upgrade7"><pb-observable data="0,3.26.9" emit="transcription">
      <h2 class="tei-title7 title">Upgrading from TEI Publisher 7 to 7.x</h2>
      <p class="tei-para">Upgrading an app generated by TEI Publisher 7 to another minor release involves the following general steps:</p>
      <ol class="tei-procedure"><li class="tei-step">
          <p class="tei-para">Update the webcomponents library (also see the <a href="https://faq.teipublisher.com/webcomponents/version-upgrade/" class="tei-link5" target="">faq</a>). The version used is defined by a single variable in <span class="tei-filename code">modules/config.xqm</span>:</p>
          <pb-code-highlight class="tei-synopsis4" language="xquery">declare variable $config:webcomponents := "1.24.12";</pb-code-highlight>
        </li><li class="tei-step">
          <p class="tei-para">Update server-side modules: those live in <span class="tei-filename code">modules/lib</span>. You can safely remove the entire folder and replace it with the corresponding one from the new version.</p>
        </li></ol>
      <div class="tei-section3" id="upgrade71"><pb-observable data="0,3.26.9.9" emit="transcription">
        <h3 class="tei-title7 title">Extra Steps for TEI Publisher 7.1</h3>
        <p class="tei-para">The new annotation editor in TEI Publisher 7.1 requires a bunch of files to be copied. If you do not intend to support web annotations in your app (we recommend having a separate app for this), you only need step 1 and 2:</p>
        <ol class="tei-procedure"><li class="tei-step">
            <p class="tei-para">Copy <span class="tei-filename code">modules/annotation-config.xqm</span> into the corresponding location in your app</p>
          </li><li class="tei-step">
            <p class="tei-para">Copy <span class="tei-filename code">templates/basic/controller.xql</span> into the root of your app. This contains an important security fix. If you modified your controller yourself, just replace the last "else", which in the new version should start with:<span class="tei-programlisting4 code">let $main :=
        if (matches($exist:path, "^/+api/+(?:odd|lint)")) then 
            "api-odd.xql" 
        else if (matches($exist:path, "/+tex$") or matches($exist:path, "/+api/+apps/+generate$")) then
            "api-dba.xql"
        else 
            "api.xql"</span></p>
          </li><li class="tei-step">
            <p class="tei-para">Copy <span class="tei-filename code">odd/annotations.odd</span> to <span class="tei-filename code">resources/odd</span> in the generated app.</p>
          </li><li class="tei-step">
            <p class="tei-para">Copy <span class="tei-filename code">templates/pages/annotate.html</span> and <span class="tei-filename code">templates/pages/annotate.css</span> to the corresponding folders.</p>
          </li><li class="tei-step">
            <p class="tei-para">Also copy <span class="tei-filename code">resources/scripts/annotations</span></p>
          </li></ol>
      </pb-observable></div>
    </pb-observable></div>
    <div class="tei-section3" id="update6-7"><pb-observable data="0,3.26.11" emit="transcription">
      <h2 class="tei-title7 title">Upgrading from TEI Publisher 6 to 7</h2>
      <p class="tei-para">
        To upgrade a custom application generated with TEI Publisher 6 to version 7, we
          recommend to clone the source code of both, TEI Publisher 7 and the custom application,
          into a local directory. The commands shown below were used on a Linux system for
        <a href="https://github.com/eeditiones/dodis-wall/commit/491267575a97c101361e10de4001db2f97cc3d29" class="tei-link5" target="">updating the Dodis demo app</a>
        , but with appropriate adjustments to the syntax the
          same actions could be performed on a different operating system. Alternatively the
          migration can be executed using eXide's file manager.
      </p>
      <p class="tei-para">If you decide to work with the command line, as suggested here, clone TEI Publisher 7
          into the directory one level above the one containing your own application source
          code:</p>
      <pb-code-highlight class="tei-programlisting5" language="shell" line-numbers="line-numbers">git clone https://github.com/eeditiones/tei-publisher-app.git
cd tei-publisher-app
git checkout v7.0.0</pb-code-highlight>
      <p class="tei-para">At this point we need to move to the directory where your own application source code
          is stored:</p>
      <pb-code-highlight class="tei-programlisting5" language="shell" line-numbers="line-numbers">cd ../my-custom-app</pb-code-highlight>
      <div class="tei-section3" id="updating-copy"><pb-observable data="0,3.26.11.15" emit="transcription">
        <h3 class="tei-title7 title">Copy files</h3>
        <p class="tei-para">
          Now we need to remove the old
          <span class="tei-filename code">modules/lib</span>
          directory and replace
            it entirely with the new one from the TEI Publisher 7. We'll also copy a bunch of files
            from the
          <span class="tei-filename code">templates</span>
          subdirectory of TEI Publisher:
        </p>
        <pb-code-highlight class="tei-programlisting5" language="shell" line-numbers="line-numbers">
rm -rf modules/lib
cp -r ../tei-publisher-app/modules/lib/ modules/
cp ../tei-publisher-app/templates/basic/pre-install.xql .
cp ../tei-publisher-app/templates/basic/post-install.xql .
cp ../tei-publisher-app/templates/basic/controller.xql .
cp ../tei-publisher-app/resources/css/theme.css resources/css
cp ../tei-publisher-app/templates/basic/modules/custom-api.* modules/
cp ../tei-publisher-app/templates/basic/modules/facets.xql modules/
cp ../tei-publisher-app/templates/api.html templates/</pb-code-highlight>
        <p class="tei-para">
          Ideally, these files should not have been modified by you, if you followed our
            earlier
          <a href="?odd=docbook.odd&amp;view=&amp;id=customization-best-practice" class="tei-link3" target="">best practice
            recommendations</a>
          . Otherwise you may need to reapply your changes.
        </p>
        <p class="tei-para">
          Next, copy the
          <span class="tei-filename code">navigation*</span>
          and
          <span class="tei-filename code">query*</span>
          modules. These are intended to be customized, so you may have changed them in your
            custom app. Compare the versions and make sure you reapply your modifications, if
            any.
        </p>
        <pb-code-highlight class="tei-programlisting5" language="shell" line-numbers="line-numbers">cp ../tei-publisher-app/modules/navigation* modules/
cp ../tei-publisher-app/modules/query*.xql modules/</pb-code-highlight>
        <div class="tei-note3 note"><p class="tei-para">
            Note that the naming of the
            <span class="tei-filename code">query-*.xql</span>
            has changed to be
              constistent with the
            <span class="tei-filename code">navigation-*.xql</span>
            files.
          </p></div>
        <p class="tei-para">Same considerations apply to the HTML templates for menus and the toolbar.
            Nevertheless, changes in these areas were quite minor, so you may alternatively postpone
            this step untill you encounter concrete issues in your application:</p>
        <pb-code-highlight class="tei-programlisting5" language="shell" line-numbers="line-numbers">cp ../tei-publisher-app/templates/menu.* templates/
cp ../tei-publisher-app/templates/toolbar.html templates/
cp ../tei-publisher-app/templates/drawer.html templates/</pb-code-highlight>
      </pb-observable></div>
      <div class="tei-section3" id="updating-templates"><pb-observable data="0,3.26.11.17" emit="transcription">
        <h3 class="tei-title7 title">Edit HTML templates</h3>
        <div class="tei-note3 note"><h4 class="tei-title4">Important</h4><p class="tei-para">
            TEI Publisher 7 expects all HTML files to reside in the
            <span class="tei-filename code">templates</span>
            subfolder. Previous versions used a mix of locations
              with some HTML files in the root of the app. You should thus copy your
            <span class="tei-filename code">index.html</span>
            ,
            <span class="tei-filename code">search.html</span>
            ,
            <span class="tei-filename code">error-page.html</span>
            and any other custom HTML files into
            <span class="tei-filename code">templates</span>
            first.
          </p></div>
        <p class="tei-para">
          Also, because TEI Publisher 7 has a well-defined API to handle the communication
            between user interface components and server-side functionality, we need to change some
            of the URLs in the HTML templates we're using. As a rule of thumb, all URLs previously
            calling XQuery modules directly, should now start with
          <span class="tei-code2 code">api/</span>
          followed by the
            correct API path. The main HTML template to be changed is
          <span class="tei-filename code">index.html</span>
          . Please search and replace the properties for the
            following webcomponents:
        </p>
        <pb-code-highlight class="tei-synopsis4" language="xml">&lt;pb-download url="modules/lib/app-download.xql"&gt;</pb-code-highlight>
        <p class="tei-para">should be changed into</p>
        <pb-code-highlight class="tei-synopsis4" language="xml">&lt;pb-download url="api/apps/download"&gt;</pb-code-highlight>
        <p class="tei-para">and</p>
        <pb-code-highlight class="tei-synopsis4" language="xml">&lt;pb-custom-form id="facets" url="modules/facets.xql" event="pb-results-received" subscribe="docs" emit="docs"/&gt;
&lt;pb-browse-docs id="document-list" url="collection/" ...&gt;</pb-code-highlight>
        <p class="tei-para">should be changed into</p>
        <pb-code-highlight class="tei-synopsis4" language="xml">&lt;pb-custom-form id="facets" url="api/search/facets" event="pb-results-received" subscribe="docs" emit="docs"&gt;&lt;/pb-custom-form&gt;
&lt;pb-browse-docs id="document-list" url="api/collection/" ...&gt;</pb-code-highlight>
        <p class="tei-para">
          The last change should also be applied to
          <span class="tei-filename code">search.html</span>
          and you
            should change the
          <span class="tei-tag code">pb-load</span>
          loading the search results to read:
        </p>
        <pb-code-highlight class="tei-synopsis4" language="xml">&lt;pb-load id="results" url="api/search" emit="results"&gt;&lt;/pb-load&gt;</pb-code-highlight>
        <p class="tei-para">
          Also check
          <span class="tei-filename code">templates/pages/view.html</span>
          and any other page
            template your app uses. Search for calls to
          <span class="tei-filename code">.xql</span>
          or
          <span class="tei-filename code">modules/</span>
          and replace them with appropriate API paths. If you were
            making direct calls to custom modules, e.g. from
          <span class="tei-code2 code">pb-load</span>
          component, these
            need to be added as
          <a href="?odd=docbook.odd&amp;view=&amp;id=customizations6-7" class="tei-link3" target="">custom API
            endpoints</a>
          .
        </p>
      </pb-observable></div>
      <div class="tei-section3" id="updating-config"><pb-observable data="0,3.26.11.19" emit="transcription">
        <h3 class="tei-title7 title">Update config.xqm</h3>
        <p class="tei-para">
          Finally, a few settings need to be added to the main configuration module,
          <span class="tei-filename code">modules/config.xqm</span>
          :
        </p>
        <ol class="tei-orderedlist"><li class="tei-listitem">
            <p class="tei-para">
              Change
              <span class="tei-parameter code">$config:webcomponents</span>
              to at least version
              <span class="tei-code2 code">1.13.0</span>
              .
            </p>
          </li><li class="tei-listitem">
            <p class="tei-para">
              Check for missing variables or functions and copy these from
              <span class="tei-filename code">tei-publisher-app/templates/basic/modules/config.xqm</span>
              , in
                particular:
            </p>
            <ul class="tei-itemizedlist"><li class="tei-listitem">
                <p class="tei-para">$config:odd-available</p>
              </li><li class="tei-listitem">
                <p class="tei-para">$config:odd-internal</p>
              </li><li class="tei-listitem">
                <p class="tei-para">config:collection-config()</p>
              </li><li class="tei-listitem">
                <p class="tei-para">config:default-config()</p>
              </li><li class="tei-listitem">
                <p class="tei-para">config:document-type()</p>
              </li><li class="tei-listitem">
                <p class="tei-para">config:get-document()</p>
              </li></ul>
          </li></ol>
      </pb-observable></div>

      <div class="tei-section3" id="customizations6-7"><pb-observable data="0,3.26.11.21" emit="transcription">
        <h3 class="tei-title7 title">Check for other customizations</h3>
        <p class="tei-para">In most cases you will now be able to rebuild your custom app, redeploy it to eXist
            and test. If you encounter any error messages, they are most likely due to additional
            modifications you applied to your custom app. These are usually located in two main
            areas:</p>
        <dl><dt>Custom HTML templating functions</dt><dd>
              <p class="tei-para">
                Earlier versions of TEI Publisher relied heavily on eXist's HTML templating
                  framework and custom apps would add their own templating functions into
                <span class="tei-filename code">modules/app.xql</span>
                (or additional modules). This approach is
                  still perfectly valid.
              </p>
              <p class="tei-para">
                Everything will work as expected if you've just extended
                <span class="tei-filename code">modules/app.xql</span>
                . However, if you have added other modules
                  containing templating functions, now you need to import these explicitly into
                <span class="tei-filename code">modules/custom-api.xql</span>
                .
              </p>
            </dd><dt>Custom XQuery main modules</dt><dd>
              <p class="tei-para">
                If your custom app makes direct calls to XQuery main modules (e.g. via the
                <span class="tei-code2 code">pb-load</span>
                component), these have to be rewritten. TEI Publisher 7
                  expects all API calls to go through the Open API router - direct calls to XQuery
                  modules are no longer supported. Therefore you need to transform your code into
                  functions which can be called via the Open API, e.g. by adding them to
                <span class="tei-filename code">modules/custom-api.xql</span>
                or importing them there.
              </p>
            </dd></dl>
      </pb-observable></div>
      <div class="tei-section3" id="customizations6-7-cleanup"><pb-observable data="0,3.26.11.23" emit="transcription">
        <h3 class="tei-title7 title">Remove superfluous code</h3>
        <p class="tei-para">Now you can remove files which are no longer used:</p>
        <pb-code-highlight class="tei-programlisting5" language="shell" line-numbers="line-numbers">
rm templates/toc.html
rm templates/search-results.html
rm modules/view.xql</pb-code-highlight>
      </pb-observable></div>
      <div class="tei-section3" id="customizations6-7-endpoints"><pb-observable data="0,3.26.11.25" emit="transcription">
        <h3 class="tei-title7 title">Change API endpoints</h3>
        <p class="tei-para">
          Finally, to be able to view and test the API of your custom app, you should change
            the endpoints in the Open API specification files. In both,
          <span class="tei-code2 code">modules/lib/api.json</span>
          and
          <span class="tei-code2 code">modules/custom-api.json</span>
          , change the
            url property in the following section:
        </p>
        <pb-code-highlight class="tei-programlisting5" language="javascript" line-numbers="line-numbers">
"servers": [
    {
        "description": "Endpoint for testing on localhost",
        "url": "http://localhost:8080/exist/apps/tei-publisher"
    }
],</pb-code-highlight>
        <p class="tei-para">Change the final part of the URL to match the name of your app instead of
            "tei-publisher". If you are on a remote server, adjust the whole url accordingly.</p>
      </pb-observable></div>
    </pb-observable></div>
    <div class="tei-section3" id="update5-7"><pb-observable data="0,3.26.13" emit="transcription">
      <h2 class="tei-title7 title">Migrating from TEI Publisher 4, 5 or earlier</h2>
      <p class="tei-para">If you are migrating to version 7 from TEI Publisher 5, 4 or earlier, you also need to
          pay attention to the user interface redesign introduced by TEI Publisher 6. This makes
          things more difficult and there are two possible approaches for updating:</p>
      <ul class="tei-itemizedlist"><li class="tei-listitem">
          <p class="tei-para">
            generate a new application with TEI Publisher 7 and merge your changes in into the
              newly generated app. This is the recommended method. If your customizations were
              limited to e.g. ODD files, CSS styles, templates, index configurations or adding your
              own code in
            <span class="tei-filename code">modules/</span>
            , it should all go very smoothly.
          </p>
        </li><li class="tei-listitem">
          <p class="tei-para">update your generated app by modifying the HTML templates you use and copying
              files from TEI Publisher.</p>
        </li></ul>
      <p class="tei-para">The first option is strongly recommended and much easier in general. The second option
          is only for experienced users who have to update apps containing a lot of customized
          code.</p>
      <div class="tei-section3" id="update5-7-newapp"><pb-observable data="0,3.26.13.11" emit="transcription">
        <h3 class="tei-title7 title">Update by Generating a New Application</h3>
        <ol class="tei-procedure"><li class="tei-step">
            <p class="tei-para">Upload your customized ODD to the TEI Publisher 7</p>
          </li><li class="tei-step">
            <p class="tei-para">
              If you created a custom HTML template for your document view, upload it to the
              <span class="tei-filename code">templates/pages</span>
              collection of the TEI Publisher. You can use
                eXide's file manager to do so.
            </p>
          </li><li class="tei-step">
            <p class="tei-para">Generate a new application using your custom ODD. Make sure to choose a
                different URL and short name to not confuse the old and new app.</p>
          </li><li class="tei-step">
            <p class="tei-para">
              Adjust
              <span class="tei-filename code">modules/config.xqm</span>
              variables, if necessary.
            </p>
          </li><li class="tei-step">
            <p class="tei-para">
              Selectively upload all other files you changed or resources you added to the
                generated app (data, CSS). In case of custom page templates and XQuery modules
                follow recommendations for
              <a href="?odd=docbook.odd&amp;view=&amp;id=update6-7" class="tei-link3" target="">updating from Publisher
                  6</a>
              .
            </p>
          </li></ol>
      </pb-observable></div>
      <div class="tei-section3" id="update5-7-copy"><pb-observable data="0,3.26.13.13" emit="transcription">
        <h3 class="tei-title7 title">Update by copying</h3>
        <div class="tei-note3 note"><p class="tei-para">
            This approach is for experienced users only and not recommended. We mainly keep it
              here for reference. This guide has been created for updating to TEI Publisher 6, so
              you will also need to follow the instructions for
            <a href="?odd=docbook.odd&amp;view=&amp;id=update6-7" class="tei-link3" target="">migrating
                from 6 to 7</a>
            and apply the steps not described below.
          </p></div>
        <p class="tei-para">The following steps assume that you either</p>
        <ul class="tei-itemizedlist"><li class="tei-listitem">
            <p class="tei-para">have a copy of your app's code on the filesystem and either a clone of TEI
                Publisher 6 or an app skeleton generated by TEI Publisher 6 (preferred) next to
                it</p>
          </li><li class="tei-listitem">
            <p class="tei-para">or have your app and TEI Publisher installed in your database. In this case use
                eXide's file manager to copy files</p>
          </li></ul>
        <p class="tei-para">
          In the following, the TEI Publisher 6 app you are copying from will be identified as
          <span class="tei-parameter code">$source</span>
          .
        </p>
        <ol class="tei-procedure"><li class="tei-step">
            <p class="tei-para">
              Edit
              <span class="tei-filename code">modules/config.xqm</span>
              and add two variables at the top:
              <span class="tei-code2 code">$config:origin-whitelist</span>
              and
              <span class="tei-code2 code">$config:webcomponents</span>
              .
            </p>
            <p class="tei-para">
              <span class="tei-parameter code">$config:webcomponents</span>
              should point to the latest version
                of pb-components.
            </p>
            <pb-code-highlight class="tei-programlisting5" language="xquery" line-numbers="line-numbers">
(:~
 : A list of regular expressions to check which external hosts are
 : allowed to access this TEI Publisher instance. The check is done
 : against the Origin header sent by the browser.
 :)
declare variable $config:origin-whitelist := (
"(?:https?://localhost:.*|https?://127.0.0.1:.*)"
);

(:~~
 : The version of the pb-components webcomponents library to be used by this app.
 : Should either point to a version published on npm,
 : or be set to 'local'. In the latter case, webcomponents
 : are assumed to be self-hosted in the app (which means you
 : have to npm install it yourself using the existing package.json).
 : If a version is given, the components will be loaded from a public CDN.
 : This is recommended unless you develop your own components.
 :)
declare variable $config:webcomponents := "0.9.11";</pb-code-highlight>
            <p class="tei-para">
              Other variables in
              <span class="tei-filename code">conf.xml</span>
              which may need to be updated
                are:
            </p>
            <ul class="tei-itemizedlist"><li class="tei-listitem">
                <p class="tei-para">$config:data-default</p>
              </li><li class="tei-listitem">
                <p class="tei-para">$config:data-exclude</p>
              </li><li class="tei-listitem">
                <p class="tei-para">$config:context-path</p>
              </li></ul>
          </li><li class="tei-step">
            <p class="tei-para">
              Copy all XQuery files from
              <span class="tei-filename code">$source/modules/lib</span>
              into the
              <span class="tei-filename code">modules/lib</span>
              of your application.
            </p>
          </li><li class="tei-step">
            <p class="tei-para">
              Copy
              <span class="tei-filename code">$source/resources/css/theme.css</span>
              into the same location
                in your application.
            </p>
          </li><li class="tei-step">
            <p class="tei-para">
              In all HTML files
              <span class="tei-emphasis2">you changed for your app</span>
              , check
              <span class="tei-tag code">head</span>
              and remove any
              <span class="tei-tag code">script</span>
              element or
              <span class="tei-tag code">link</span>
              doing
                an import like:
            </p>
            <pb-code-highlight class="tei-programlisting5" language="html" line-numbers="line-numbers">&lt;link rel="import" href="components/dependencies-dev.html"/&gt;</pb-code-highlight>
            <p class="tei-para">Instead add the following line to the head:</p>
            <pb-code-highlight class="tei-programlisting5" language="html" line-numbers="line-numbers">&lt;script type="module" src="pb-components-bundle.js" data-template="pages:load-components"&gt;&lt;/script&gt;</pb-code-highlight>
            <p class="tei-para">
              Also add a link to
              <span class="tei-filename code">theme.css</span>
              :
            </p>
            <pb-code-highlight class="tei-programlisting5" language="html" line-numbers="line-numbers">&lt;link rel="stylesheet" href="resources/css/theme.css"/&gt;</pb-code-highlight>
          </li><li class="tei-step">
            <p class="tei-para">
              Copy
              <span class="tei-filename code">$source/resources/css/theme.css</span>
            </p>
          </li><li class="tei-step">
            <p class="tei-para">
              Copy
              <span class="tei-filename code">$source/resources/i18n</span>
              . The existing
              <span class="tei-filename code">*.xml</span>
              in your directory can be deleted - unless you added
                your own translated keys, in which case you would need to move them into the
                corresponding json format.
            </p>
          </li><li class="tei-step">
            <p class="tei-para">
              HTML files you did not change may just be overwritten by copying the
                corresponding versions from
              <span class="tei-code2 code">$source</span>
              . In particular this includes files
                in the
              <span class="tei-filename code">$source/templates/basic/templates</span>
              subdirectory.
            </p>
          </li><li class="tei-step">
            <p class="tei-para">
              Copy
              <span class="tei-filename code">$source/templates/basic/controller.xql</span>
              into the root
                of your application - unless you made changes to this file yourself, in which case
                you would need to merge it.
            </p>
          </li><li class="tei-step">
            <p class="tei-para">
              Check the files in modules within your app: if you have not changed any of them,
                just copy the corresponding files from
              <span class="tei-filename code">tei-publisher-app/modules</span>
              . See if you need to merge the
                modified ones.
            </p>
          </li><li class="tei-step">
            <p class="tei-para">
              i18n translations are now applied client-side rather than server-side. This
                means you should drop all references to
              <span class="tei-code2 code">data-template="i18n:translate"</span>
              and the i18n namespace from your HTML. Also remove the i18n module import from your
              <span class="tei-filename code">modules/view.xql</span>
              or overwrite the file if you have not
                modified it.
            </p>
          </li></ol>
        <p class="tei-para">
          You may consult the diff of an actual update from Publisher 5 to 6 in the dodis-wall
            repository on github:
          <a href="https://github.com/eeditiones/dodis-wall/commit/9c3757d909932db458d2a777b7a952a8ee4dcc9e" class="tei-link4" target="_new">update to publisher 6: update templates, configuration and
              styling</a>
        </p>
      </pb-observable></div>
    </pb-observable></div>
  </pb-observable></div>
  <div class="tei-section3" id="data-organization"><pb-observable data="0,3.28" emit="transcription">
    <h1 class="tei-title7 title">Data</h1>
    <p class="tei-para">TEI Publisher ships its data files within the same application package. Nevertheless,
        separating your data from application code has many benefits, particularly for actively
        developed applications and data sets. This way changes to your code can be deployed without
        redeploying and reindexing your data and vice versa. It is also easier to maintain separate
        repositories (e.g. in Git) and differentiate privileges for editorial and developer
        teams.</p>
    <p class="tei-para">
      While we would generally recommend separating data and code, some projects may still
        prefer to keep their data and application integrated in a single
      <span class="tei-emphasis2">xar</span>
      package for the sake of marginally easier distribution.
    </p>
    <p class="tei-para">Internal structure of the data collection can be arbitrary, though there are some
        considerations regarding index configuration to take into account.</p>
    <div class="tei-section3" id="data-collection"><pb-observable data="0,3.28.11" emit="transcription">
      <h2 class="tei-title7 title">Data collection</h2>
      <p class="tei-para">
        Two variables in
        <span class="tei-filename code">config.xqm</span>
        are used to configure location of the
          data collection.
        <span class="tei-code2 code">$config:data-root</span>
        specifies where in the collection
          hierarchy the data is stored. Only the top level collection needs to be specified.
      </p>
      <pb-code-highlight class="tei-programlisting5" language="xquery" line-numbers="line-numbers">
(:~
 : The root of the collection hierarchy containing data.
 :)
declare variable $config:data-root := $config:app-root || "/data";
    </pb-code-highlight>
      <p class="tei-para">
        Switching to a separate data package is as simple as changing this variable, e.g.
          assuming that we store our data in
        <span class="tei-code2 code">/db/apps/lgpn-ling-data/data</span>
        , the
        <span class="tei-code2 code">data-root</span>
        should be defined as:
      </p>
      <pb-code-highlight class="tei-programlisting5" language="xquery" line-numbers="line-numbers">
      declare variable $config:data-root := '/db/apps/lgpn-ling-data/data';
    </pb-code-highlight>
      <p class="tei-para">
        In the variable
        <span class="tei-parameter code">$config:data-exclude</span>
        you may specifiy a
          sequence of root elements which should be excluded from the list of document shown in the
          browsing view, e.g. secondary data files like a taxonomy or entity lists.
      </p>
      <p class="tei-para">
        You may find it helpful to create and build the data package starting from the
          template hosted in the
        <a href="https://github.com/eeditiones/tei-publisher-data-template" class="tei-link4" target="_new">e-editiones repository</a>
        . README document provided there explains shortly roles of
          all the files and how to adjust them to your needs.
      </p>

      <div class="tei-note3 note"><p class="tei-para">
          It is critical to store index configuration file,
          <span class="tei-filename code">collection.xconf</span>
          in the correct location. Refer to
          <a href="https://exist-db.org/exist/apps/doc/indexing.xml" class="tei-link4" target="_new">eXist-db documentation</a>
          for details but it is common practice to store a
            collection configuration in the data package and rely on mechanisms of pre-install
            script (
          <span class="tei-filename code">pre-install.xql</span>
          ) to copy the file to its required position
            in
          <span class="tei-filename code">/db/system/config</span>
          .
        </p><p class="tei-para">
          Similar consideration applies if fulltext index makes use of any external function
            module, which in TEI Publisher and generated apps is commonly the case for facet and
            field definitions. This module needs to be stored before the index is to be applied and
            usually it's best to store it in the same location as
          <span class="tei-filename code">collection.xconf</span>
          .
        </p></div>
    </pb-observable></div>
    <div class="tei-section3" id="subcollections"><pb-observable data="0,3.28.13" emit="transcription">
      <h2 class="tei-title7 title">Subcollections</h2>
      <p class="tei-para">
        Many editions will simply present a number of documents, e.g. a collection of letters
          like
        <a href="https://teipublisher.com/exist/apps/vangogh/index.html" class="tei-link4" target="_new">Van Gogh</a>
        or plays like
        <a href="https://teipublisher.com/exist/apps/shakespeare-pm/index.html" class="tei-link5" target="">Shakespeare</a>
        demo. Structure of the data is therefore very simple, all the files
          are stored on the same level in the
        <span class="tei-code2 code">data-root</span>
        collection.
      </p>

      <p class="tei-para">
        Other publications, particularly those including heterogeneous material may require a
          more complex organization. TEI Publisher itself is a good example - its
        <span class="tei-code2 code">data</span>
        collection is further divided into three subcollections:
        <span class="tei-filename code">doc</span>
        (for
          documentation),
        <span class="tei-filename code">test</span>
        (for examples) and
        <span class="tei-filename code">playground</span>
        (for user-supplied material).
      </p>
      <figure class="tei-figure2 figure"><span class="tei--element">
          <span class="tei--element">
            <img src="data-collection.png" class="tei-imagedata2" title="" style="width: 312px; ">
          </span>
        </span><figcaption>Structure of TEI Publisher's data collection</figcaption></figure>
      <p class="tei-para">
        You will note that it also contains other resources: image files and even an HTML
          file. Specify the
        <span class="tei-code2 code">$config:data-default</span>
        variable in
        <span class="tei-filename code">modules/config.xqm</span>
        to set which collection should be used as a
          point of entry to your data. Whenever
        <span class="tei-filename code">collection.html</span>
        is present in
          that location, it will be used as a custom landing page displayed instead of a simple
          document listing. In case of the TEI Publisher it would be the Demo Collection, Playground
          and Documentation
      </p>

      <pb-code-highlight class="tei-programlisting5" language="xquery" line-numbers="line-numbers">
(:~
 : The root of the collection hierarchy whose files should be displayed
 : on the entry page. Can be different from $config:data-root.
 :)
declare variable $config:data-default := $config:data-root;
    </pb-code-highlight>
      <p class="tei-para">
        This approach can be extended further, say if you wanted to add a
        <span class="tei-filename code">prints</span>
        and
        <span class="tei-filename code">manuscripts</span>
        subcollection to the
        <span class="tei-filename code">playground</span>
        and present them in a custom landing page. Just add the
          data and a corresponding
        <span class="tei-filename code">collection.html</span>
        into the
        <span class="tei-filename code">playground</span>
        . You can shape the custom landing page however you like,
          using the full power of HTML and eXist templating.
      </p>
      <figure class="tei-figure2 figure"><span class="tei--element">
          <span class="tei--element">
            <img src="data-subcollections.png" class="tei-imagedata2" title="" style="width: 312px; ">
          </span>
        </span><figcaption>Subcollections</figcaption></figure>
      <figure class="tei-figure2 figure"><span class="tei--element">
          <span class="tei--element">
            <img src="data-subcollection-landing.png" class="tei-imagedata2" title="" style="width: 512px; ">
          </span>
        </span><figcaption>Fragment of the subcollections landing page</figcaption></figure>
      <p class="tei-para">
        The landing page like this could be created with this HTML template stored in
        <span class="tei-filename code">data/playground/collection.html</span>
        .
      </p>
      <pb-code-highlight class="tei-programlisting5" language="html" line-numbers="line-numbers">
&lt;div class="collection" data-template="browse:clear-facets"&gt;
    &lt;h3&gt;Custom landing page demonstrating sub-subcollections.&lt;/h3&gt;
    &lt;ul class="documents"&gt;
        &lt;li class="document"&gt;
            &lt;div class="thumbnail"&gt;&lt;img src="demo.png" width="128"/&gt;&lt;/div&gt;
            &lt;div class="document-info"&gt;
                &lt;h3&gt;&lt;a href="#" data-collection="playground/prints"&gt;Prints&lt;/a&gt;&lt;/h3&gt;
                &lt;p&gt;This one is for prints.&lt;/p&gt;
            &lt;/div&gt;
        &lt;/li&gt;
        &lt;li class="document"&gt;
            &lt;div class="thumbnail"&gt;&lt;img src="demo.png" width="128"/&gt;&lt;/div&gt;
            &lt;div class="document-info"&gt;
                &lt;h3&gt;&lt;a href="#" data-collection="playground/manuscripts"&gt;Manuscripts&lt;/a&gt;&lt;/h3&gt;
                &lt;p&gt;This one is for manuscripts.&lt;/p&gt;
            &lt;/div&gt;
        &lt;/li&gt;
    &lt;/ul&gt;
&lt;/div&gt;
      </pb-code-highlight>
    </pb-observable></div>

    <div class="tei-section3" id="pi-config"><pb-observable data="0,3.28.15" emit="transcription">
      <h2 class="tei-title7 title">Processing instructions</h2>
      <p class="tei-para">
        The default view for a specific document can be configured via a processing
          instruction. Before displaying a document, TEI publisher will check if a processing
          instruction exists at the start of the document, telling it which ODD and view template to
          use (along with other configuration parameters). For example, the following processing
          instruction associates the document with the view template
        <span class="tei-filename code">translation.html</span>
        , the ODD
        <span class="tei-filename code">dantiscus.odd</span>
        , and
          switches to a page-by-page display (along TEI page break boundaries):
      </p>
      <pb-code-highlight class="tei-programlisting5" language="xml" line-numbers="line-numbers">&lt;?teipublisher template="translation.html" odd="dantiscus.odd" view="page"?&gt;</pb-code-highlight>
      <p class="tei-para">When viewing the document by structural divisions, two additional settings control the
          amount of content displayed at a time:</p>
      <pb-code-highlight class="tei-programlisting5" language="xml" line-numbers="line-numbers">&lt;?teipublisher depth="2" fill="6" odd="dta.odd"?&gt;</pb-code-highlight>
      <dl><dt>odd</dt><dd>
            <p class="tei-para">The ODD file to use for rendering the document.</p>
          </dd><dt>template</dt><dd>
            <p class="tei-para">
              The HTML view template to use. Default is
              <span class="tei-code2 code">view.html</span>
              as configured
                in
              <span class="tei-filename code">modules/config.xqm</span>
              .
            </p>
          </dd><dt>view</dt><dd>
            <p class="tei-para">
              Default view to show when browsing the document. Supported values are
              <span class="tei-parameter code">div</span>
              ,
              <span class="tei-parameter code">page</span>
              or
              <span class="tei-parameter code">single</span>
              :
            </p>
            <ol class="tei-orderedlist"><li class="tei-listitem">
                <p class="tei-para">
                  <span class="tei-parameter code">div</span>
                  : displays one structural division (TEI div, docbook
                    section …) at a time
                </p>
              </li><li class="tei-listitem">
                <p class="tei-para">
                  <span class="tei-parameter code">page</span>
                  : displays the document page by page. This requires
                    page break indicators to be present (
                  <span class="tei-tag code">pb</span>
                  in TEI, not supported for
                    docbook).
                </p>
              </li><li class="tei-listitem">
                <p class="tei-para">
                  <span class="tei-parameter code">single</span>
                  : the entire document (or a selected fragment of
                    it) is displayed at once
                </p>
              </li></ol>
          </dd><dt>depth</dt><dd>
            <p class="tei-para">
              When viewing entire divisions, the software tries to determine if it should show
                child divisions in separate pages or include them with the current div.
              <span class="tei-tag code">depth</span>
              indicates the nesting level up to which divisions should be shown
                separately. So setting it to "2" will result in divisions on level 3 or greater to
                be shown together with their enclosing div.
            </p>
          </dd><dt>fill</dt><dd>
            <p class="tei-para">
              If child divisions appear on separate pages, it may happen that the enclosing
                div contains just a heading or a single line of text. In this case, the algorithm
                will try to fill the page by showing the first child division as well. The
              <span class="tei-tag code">fill</span>
              paramter defines the number of elements which should at least be
                present on a page. If not, the software tries to fill it up.
            </p>
          </dd></dl>
    </pb-observable></div>
  </pb-observable></div>

  <div class="tei-section3" id="facets"><pb-observable data="0,3.30" emit="transcription">
    <h1 class="tei-title7 title">Facet Search Configuration</h1>
    <p class="tei-para">Facets allow users to quickly navigate through a set of documents or query results by
        selecting from predefined categories or properties. This way, users can "drill down" into
        the set, reducing the number of displayed items with every step. For demonstration purposes,
        TEI Publisher configures two facets by default: "Genre" and "Language". You can see those to
        the left of the document list on the start page, or below the search box on the search
        result page.</p>
    <figure class="tei-figure2 figure"><span class="tei--element">
        <span class="tei--element">
          <img src="facets.png" class="tei-imagedata2" title="">
        </span>
      </span><figcaption>Facets on the start page</figcaption></figure>
    <p class="tei-para">
      From a user perspective, the main concept behind facets is the
      <span class="tei-emphasis2">drill
          down</span>
      : initially the user sees all facet values associated with the set of
        documents or search results displayed. The number behind each value denotes the number of
        items in the set having the particular facet set. As the user selects one facet, the set
        necessarily becomes smaller, so non-matching facet values will disappear and the numbers
        adjust accordingly.
    </p>
    <p class="tei-para">
      Facets are a new feature in eXist 5.0. They are super fast because eXist will create
        them when indexing the document. No extra computation is needed when the user clicks on a
        facet to drill down into a displayed set: all information is already available in the index.
        To see a more complex example of facets in action, visit our
      <a href="https://teipublisher.com/exist/apps/vangogh/index.html" class="tei-link4" target="_new">Van Gogh</a>
      demo.
    </p>
    <p class="tei-para">If you would like to configure other or additional facets, you need to edit three
        files:</p>
    <dl><dt>
          <span class="tei-filename code">collection.xconf</span>
        </dt><dd>
          <p class="tei-para">
            The
            <span class="tei-filename code">collection.xconf</span>
            tells eXist how to index the collection.
              The default configuration in TEI Publisher creates two Lucene full-text indexes for
              TEI on
            <span class="tei-tag code">tei:text</span>
            and
            <span class="tei-tag code">tei:div</span>
            . Each of those may have facets
              attached. Every facet must have a
            <span class="tei-parameter code">dimension</span>
            and an
            <span class="tei-parameter code">expression</span>
            attribute. The expression is an arbitrary
              XPath/XQuery string. For every element being indexed, the expression is evaluated once
              and the result defines the string values which will be associated with the specified
              facet dimension.
          </p>
          <p class="tei-para">
            For a description of how full-text indexes and facets are defined in the
            <span class="tei-filename code">collection.xconf</span>
            , please refer to the
            <a href="http://exist-db.org/exist/apps/doc/lucene" class="tei-link4" target="_new">eXist
              documentation</a>
            .
          </p>
        </dd><dt>
          <span class="tei-filename code">index.xql</span>
        </dt><dd>
          <p class="tei-para">
            If you open the default
            <span class="tei-filename code">collection.xconf</span>
            , you'll see that
              most facet expressions call a function
            <span class="tei-function code">nav:get-metadata</span>
            . This
              function is declared in
            <span class="tei-filename code">index.xql</span>
            . By externalizing most of the
              code into a separate function, we can keep the index configuration clean and
              short.
          </p>
          <p class="tei-para">
            The default
            <span class="tei-filename code">index.xql</span>
            already does some advanced
              preprocessing, in particular for the "genre" facet: each of the sample documents
              references a central taxonomy (contained in
            <span class="tei-filename code">data/taxonomy.xml</span>
            ).
              The references are resolved at indexing time by following the
            <span class="tei-tag code">catRef</span>
            element's
            <span class="tei-parameter code">@target</span>
            attribute. Note that we create a hierarchical
              facet, because e.g. "Philosophy" is a sub-category of "Prose". The code in function
            <span class="tei-function code">idx:get-genre</span>
            will automatically include the
              super-category.
          </p>
        </dd><dt>
          <span class="tei-filename code">config.xqm</span>
        </dt><dd>
          <p class="tei-para">
            While the other two files cover the server-side creation of facets, we also need a
              place where we define how facets should be displayed in the user interface. The main
              configuration module:
            <span class="tei-filename code">config.xqm</span>
            declares a variable
            <span class="tei-parameter code">$config:facets</span>
            . It should contain an array of maps, where
              each map defines the settings for one dimension, e.g.:
          </p>
          <pb-code-highlight class="tei-programlisting5" language="xquery" line-numbers="line-numbers">
(:
 : Display configuration for facets to be shown in the sidebar. The facets themselves
 : are configured in the index configuration, collection.xconf.
 :)
declare variable $config:facets := [
    map {
        "dimension": "genre",
        "heading": "Genre",
        "max": 5,
        "hierarchical": true()
    },
    map {
        "dimension": "language",
        "heading": "Language",
        "max": 5,
        "hierarchical": false(),
        "output": function($label) {
            switch($label)
                case "de" return "German"
                case "es" return "Spanish"
                case "la" return "Latin"
                case "fr" return "French"
                case "en" return "English"
                default return $label
        }
    }
];
</pb-code-highlight>
          <p class="tei-para">The map properties are as follows:</p>
          <dl><dt>dimension</dt><dd>
                <p class="tei-para">
                  The name of the dimension. Should correspond to the value of the
                  <span class="tei-parameter code">@dimension</span>
                  attribute used in
                  <span class="tei-filename code">collection.xconf</span>
                </p>
              </dd><dt>heading</dt><dd>
                <p class="tei-para">The heading to display above the facet values</p>
              </dd><dt>max</dt><dd>
                <p class="tei-para">
                  Maximum number of facet values to be displayed initially. More can be shown
                    if the user clicks on the
                  <span class="tei-guilabel">Show All</span>
                  checkbox. Pass an empty
                    sequence, i.e. (), to not limit the number and hide the checkbox.
                </p>
              </dd><dt>hierarchical</dt><dd>
                <p class="tei-para">
                  Defines if the facet is hierarchical, which means that only the top-level
                    facet values in the hierarchy will be shown initially. If the user selects one
                    top-level value, the interface will expand and show the sub-categories. For this
                    to work the facet must be configured as "hierarchical" in
                  <span class="tei-filename code">collection.xconf</span>
                </p>
              </dd><dt>output</dt><dd>
                <p class="tei-para">A function which can be used to process the facet value before display. The
                    facet label will be replaced by whatever the function returns.</p>
              </dd></dl>
        </dd></dl>
  </pb-observable></div>

  <div class="tei-section3" id="embedding"><pb-observable data="0,3.32" emit="transcription">
    <h1 class="tei-title7 title">Embedding TEI Publisher in other systems</h1>
    <p class="tei-para">
      Since version 6.0, all
      <span class="tei-code2 code">pb-components</span>
      can be used
      <span class="tei-emphasis2">outside</span>
      TEI Publisher itself. The components can be embedded into any
        environment, e.g. a CMS or blog software (like WordPress or Drupal) or integrated into any
        modern front-end framework (like vue, react or angular). All that is needed is a TEI
        Publisher instance available on the web which stores the source TEI and provides a
        communication endpoint for the components to talk to.
    </p>

    <div class="tei-section3" id="embedding-examples"><pb-observable data="0,3.32.7" emit="transcription">
      <h2 class="tei-title7 title">Live Examples</h2>
      <p class="tei-para">
        The embedded example below demonstrates such a use case: it provides a sandbox running
          on
        <a href="https://codepen.io" class="tei-link4" target="_new">codepen.io</a>
        but
          communicates with the TEI Publisher instance on
        <a href="https://teipublisher.com" class="tei-link4" target="_new">teipublisher.com</a>
        which stores the
          documents. The magic happens in the
        <span class="tei-code2 code">endpoint</span>
        attribute passed to
        <span class="tei-tag code">pb-page</span>
        , which tells the components where to talk to:
      </p>
      <pb-codepen class="tei-programlisting3" hash="YzXEvvw" user="wolfgangmm" theme="dark" height="480" editable="editable"></pb-codepen>
      <p class="tei-para">
        You can actually edit the code above: for example, try to change the path for the
          first document to
        <span class="tei-filename code">test/F-rom.xml</span>
        and the odd to
        <span class="tei-code2 code">shakespeare</span>
        . See how the live view changes?
      </p>
      <p class="tei-para">
        And if you would like to read
        <span class="tei-emphasis2">Romeo and Juliet</span>
        in two-column
          mode, just add
        <span class="tei-code2 code">column-separator=".tei-cb"</span>
        to the main
        <span class="tei-tag code">pb-view</span>
        .
      </p>
    </pb-observable></div>

    <div class="tei-section3" id="embedding-whole-doc"><pb-observable data="0,3.32.9" emit="transcription">
      <h2 class="tei-title7 title">Retrieving the whole document as a simple HTML</h2>
      
      <p class="tei-para">Embedding results of applying Processing Model transformation on a document is even
          simpler. Behind the scenes, TEI Publisher has a separate library part, which is
          essentially an implementation of the TEI processing model. This library can be used
          independently to retrieve the entire content of a TEI document as HTML, transformed
          through an ODD with processing instructions.</p>
      <p class="tei-para">All you need is a small XQuery which calls the library modules, setting the correct
          source document and ODD. Fortunately, TEI Publisher already contains a boilerplate XQuery
          script for this job, which you can call as follows in your browser:</p>
      <p class="tei-para">
        <a href="https://teipublisher.com/exist/apps/tei-publisher/api/document/test%2FF-rom.xml/html?odd=shakespeare.odd" class="tei-link4" target="_new">https://teipublisher.com/exist/apps/tei-publisher/api/document/test%2FF-rom.xml/html?odd=shakespeare.odd</a>
      </p>
      <p class="tei-para">
        This will retrieve the content of Shakespeare's
        <span class="tei-emphasis2">Romeo and Juliet</span>
        as an HTML page, transformed through the odd
        <span class="tei-filename code">shakespeare.odd</span>
        . For
          embedding an entire document in an iframe or similar, this should already be enough.
          Please note that
        <span class="tei-emphasis1">/</span>
        character in the path to the document
        <span class="tei-parameter code">test/F-rom.xml</span>
        had to be URL encoded as
        <span class="tei-parameter code">%2F</span>
        .
      </p>
    </pb-observable></div>
    <div class="tei-section3" id="embedding-webcomponents"><pb-observable data="0,3.32.11" emit="transcription">
      <h2 class="tei-title7 title">Embedding webcomponents for navigation</h2>
      <p class="tei-para">For longer documents, embedding the entire content in a page may not be too
          user-friendly. A better way is to use the library of webcomponents provided by TEI
          Publisher. This way, we can show the content page by page or division by division,
          allowing the reader to navigate between sections.</p>
      <pb-codepen class="tei-programlisting3" hash="ExVQKBK" user="wolfgangmm" theme="dark" height="480" editable="editable"></pb-codepen>
      <p class="tei-para">Because webcomponents are part of the HTML5 standard and supported natively by most
          modern browsers, we can easily import the component library which is at the core of the
          TEI Publisher app and reuse the components it provides in other contexts. They should work
          in any HTML5 page, no matter if it was written by hand, is generated by PHP, Python or a
          CMS.</p>
      <p class="tei-para">For a start, the page should import two scripts in its header:</p>
      <pb-code-highlight class="tei-programlisting5" language="html" line-numbers="line-numbers">&lt;script src="https://cdn.jsdelivr.net/npm/web-components-loader/lib/index.min.js"&gt;&lt;/script&gt;
&lt;script type="module" src="https://cdn.jsdelivr.net/npm/@teipublisher/pb-components/dist/pb-components-bundle.min.js"&gt;&lt;/script&gt;</pb-code-highlight>
      <p class="tei-para">
        This imports necessary
        <span class="tei-code2 code">pb-components</span>
        libraries from
        <span class="tei-code2 code">jsdelivr.net</span>
        CDN which is considered the best practice for web sites.
      </p>
      <p class="tei-para">
        The second
        <span class="tei-tag code">script</span>
        tag imports all the components provided by TEI Publisher.
          Note that here
        <span class="tei-code2 code">pb-components@latest</span>
        points to the latest available bundle,
          but you could specify a concrete version number to make sure your website uses a fixed
          release.
      </p>

      <p class="tei-para">
        Now let's actually use the components to display Shakespeare's
        <span class="tei-emphasis2">Romeo and
            Juliet</span>
        : in the HTML
        <span class="tei-tag code">body</span>
        , include the following snippet:
      </p>
      <pb-code-highlight class="tei-programlisting5" language="html" line-numbers="line-numbers">&lt;pb-page endpoint="https://teipublisher.com/exist/apps/tei-publisher"&gt;
    &lt;pb-document id="document1" path="test/F-rom.xml" odd="shakespeare"&gt;&lt;/pb-document&gt;
    &lt;!-- Navigate to previous page --&gt;
    &lt;pb-navigation direction="backward" unit="page" keyboard="left"&gt;
      &lt;paper-button&gt;
         &lt;iron-icon icon="icons:chevron-left"&gt;&lt;/iron-icon&gt;
      &lt;/paper-button&gt;
    &lt;/pb-navigation&gt;
    &lt;pb-view id="view1" src="document1" view="page"&gt;&lt;/pb-view&gt;
    &lt;!-- Navigate to next page --&gt;
    &lt;pb-navigation direction="forward" unit="page" keyboard="right"&gt;
      &lt;paper-button&gt;
         &lt;iron-icon icon="icons:chevron-right"&gt;&lt;/iron-icon&gt;
      &lt;/paper-button&gt;
    &lt;/pb-navigation&gt;
&lt;/pb-page&gt;</pb-code-highlight>
      <p class="tei-para">
        In the
        <span class="tei-tag code">pb-page</span>
        <span class="tei-code2 code">endpoint</span>
        attribute we need to provide a critical piece of information: the
          URL of the TEI Publisher instance for all the components to communicate with. If you have
          set up your own instance of eXist-db and TEI Publisher, you should change the URL
        <span class="tei-emphasis2">to point to your instance</span>
        . This is important because the components
          will expect the documents you want to display to be stored in the same instance.
      </p>
      <p class="tei-para">
        <span class="tei-tag code">pb-document</span>
        defines the document to be displayed. The path is relative to
          the data root of the TEI Publisher instance. It also specifies the ODD to be used for the
          transformation.
      </p>
      <p class="tei-para">
        <span class="tei-tag code">pb-view</span>
        is the main component for displaying the transformed content. It
          references the
        <span class="tei-tag code">pb-document</span>
        to use as source in its
        <span class="tei--element">src</span>
        attribute. The Shakespeare does tag page breaks, so we switch to page-by-page view via the
        <span class="tei--element">view</span>
        attribute to show the user only one page at a time. The default
          would be to use a division-by-division view (
        <span class="tei-code2 code">view="div"</span>
        ), but you could also
          request the entire content at once using
        <span class="tei-code2 code">view="single"</span>
        .
      </p>
      <p class="tei-para">
        <span class="tei-tag code">pb-navigation</span>
        adds forward/backward navigation buttons to the page,
          allowing the user to switch to the next/previous page of the document. You can use various
          types of buttons, but in this case we're choosing a
        <span class="tei-tag code">paper-button</span>
        element with a
          chevron
        <span class="tei-tag code">iron-icon</span>
        (both
        <span class="tei-tag code">paper-button</span>
        and
        <span class="tei-tag code">iron-icon</span>
        are
          part of the standard
        <a href="https://www.webcomponents.org/author/PolymerElements" class="tei-link4" target="_new">Polymer elements
            library</a>
        ).
      </p>
      <p class="tei-para">
        Another example of embedding TEI Publisher web components into a static website can be
          found on our
        <a href="https://teipublisher.onrender.com/" class="tei-link5" target="">demo blog</a>
        . It
          was created with
        <a href="https://gohugo.io" class="tei-link5" target="">Hugo</a>
        , a very popular website
          generator which offers hundreds of ready-made themes to choose from. Here content is
          written in markdown, but its not a problem to embed TEI content served by TEI
          Publisher.
      </p>
    </pb-observable></div>
  </pb-observable></div>

  <div class="tei-section3" id="custom-components"><pb-observable data="0,3.34" emit="transcription">
    <h1 class="tei-title7 title">Creating Custom Web Components</h1>
    <p class="tei-para">
      In some cases an app may need to add its own web components to the collection provided
        by TEI Publisher. Please consider following
      <span class="tei-emphasis1">open-source-first
          approach</span>
      , as we do, and contributing your component back to the community, for
        others to use.
    </p>
    <p class="tei-para">
      For that reason, we recommend here a setup which leads to relatively smooth integration
        with
      <span class="tei-code2 code">pb-components</span>
      in the future.
    </p>
    <p class="tei-para">
      Start with forking and downloading the
      <span class="tei-code2 code">pb-extension-template</span>
      package from
        its
      <a href="http://github.com/eeditiones/pb-extension-template" class="tei-link4" target="_new">GitHub repository</a>
      .
    </p>
    <figure class="tei-figure2 figure"><span class="tei--element">
        <span class="tei--element">
          <img src="component-extension.png" class="tei-imagedata2" title="">
        </span>
      </span><figcaption>Visual Studio Code overview of pb-extension-template</figcaption></figure>
    <p class="tei-para">You will find it already includes several configuration files to get you started on the
        development.</p>
    <ul class="tei-itemizedlist"><li class="tei-listitem">
        <p class="tei-para">
          <span class="tei-filename code">package.json</span>
          file which includes definition and specifications
            for common task, like generating documentation or running a web server for local
            development
        </p>
      </li><li class="tei-listitem">
        <p class="tei-para">
          <span class="tei-filename code">src</span>
          directory to put your custom web component code. It already
            includes
          <span class="tei-filename code">pb-clipboard.js</span>
          file as an example of a simple
            component
        </p>
      </li><li class="tei-listitem">
        <p class="tei-para">
          <span class="tei-filename code">index.html</span>
          file which illustrates the simplest scaffolding for
            using your new components
        </p>
      </li><li class="tei-listitem">
        <p class="tei-para">
          <span class="tei-filename code">demo</span>
          directory to place your demo files for testing and
            documentation purposes. It already contains
          <span class="tei-filename code">demo.js</span>
          configuration
            file and
          <span class="tei-filename code">pb-clipboard.html</span>
          demo for
          <span class="tei-tag code">pb-clipboard</span>
          .
        </p>
      </li><li class="tei-listitem">
        <p class="tei-para">
          <span class="tei-filename code">api.html</span>
          file serving as a documentation starting point for
            your package
        </p>
      </li><li class="tei-listitem">
        <p class="tei-para">
          <span class="tei-filename code">rollup.config.js</span>
          provides building specification to create a
            bundle that can be included in any web page.
        </p>
      </li></ul>
    <p class="tei-para">
      To get you started, run
      <span class="tei-code2 code">npm install</span>
      . This will install required
        dependencies: above all
      <span class="tei-code2 code">pb-components</span>
      but also
      <span class="tei-code2 code">es-dev-server</span>
      and
      <span class="tei-code2 code">web-component-analyzer</span>
      packages which are needed for local development and
        documentation.
    </p>
    <figure class="tei-figure2 figure"><span class="tei--element">
        <span class="tei--element">
          <img src="litelem-vscode-snippet.png" class="tei-imagedata2" title="">
        </span>
      </span><figcaption>Visual Studio Code snippet</figcaption></figure>
    <p class="tei-para">
      If you are using Visual Studio code
      <span class="tei-filename code">.vscode/component.code-snippets</span>
      will provide you with code templates. If you create a new file in
      <span class="tei-filename code">src</span>
      ,
        e.g.
      <span class="tei-filename code">pb-foo.js</span>
      and start typing
      <span class="tei-emphasis2">litelement</span>
      you
        will be offered a LitElement template. Otherwise you can copy the template manually or copy
        existing
      <span class="tei-tag code">pb-clipboard</span>
      element and tweak it.
    </p>
    <figure class="tei-figure2 figure"><span class="tei--element">
        <span class="tei--element">
          <img src="litelem-template.png" class="tei-imagedata2" title="" style="width: 600px; ">
        </span>
      </span><figcaption>LitElement template</figcaption></figure>
    <div class="tei-section3" id="custom-components-clipboard"><pb-observable data="0,3.34.25" emit="transcription">
      <h2 class="tei-title7 title">pb-clipboard example</h2>
      <p class="tei-para">
        We will discuss the details of the
        <span class="tei-tag code">pb-clipboard</span>
        element to illustrate some
          basic concepts. You will find exact code of this example in
        <span class="tei-code2 code">pb-extension-template/src/pb-clipboard.js</span>
        . Each custom component has a
          defined API: an interface it presents to the outside world. It includes properties,
          methods (also called functions) and events but it bundles HTML markup along with local CSS
          and JavaScript into a single file.
      </p>
      <p class="tei-para">
        Our example is a custom element designed to provide simple
        <span class="tei-emphasis2">copy-to-clipboard</span>
        functionality, helpful e.g. when providing
          ready-made citation on a page. It consists of three parts: a label, the content to be
          copied and a button to copy.
      </p>
      <p class="tei-para">Thus, render function which actually displays this custom component could look like
          this:</p>
      <pb-code-highlight class="tei-programlisting5" language="js" line-numbers="line-numbers">
    render() {
        return html`
            &lt;h3&gt;${translate(this.label)}&lt;/h3&gt;
            &lt;div&gt;
                &lt;slot&gt;&lt;/slot&gt;
                &lt;paper-icon-button icon="icons:content-copy" @click="${this._copy}"
                    title="${translate('clipboard.copy')}"&gt;&lt;/paper-icon-button&gt;
            &lt;/div&gt;
        `;
    }
      </pb-code-highlight>
      <p class="tei-para">
        You will note that the render function uses not only regular HTML elements like
        <span class="tei-tag code">h3</span>
        or
        <span class="tei-tag code">div</span>
        but also components from the
        <span class="tei-code2 code">paper-</span>
        package. To be able to use them, we need to explicitly import them. Same is true for
        <span class="tei-code2 code">LitElement</span>
        class itself and important interface from the
        <span class="tei-code2 code">pb-components</span>
        package:
        <span class="tei-code2 code">pbMixin</span>
        .
      </p>
      <p class="tei-para">
        All user interface components may need to be localized. For that reason we also import
        <span class="tei-code2 code">translate</span>
        method from TEI Publisher's
        <span class="tei-code2 code">i18n</span>
        module.
      </p>
      <p class="tei-para">
        <span class="tei-code2 code">LitElement</span>
        and
        <span class="tei-code2 code">pbMixin</span>
        must be imported for all custom
          components extending
        <span class="tei-code2 code">pb-components</span>
        . Code listing below demonstrates how to
          correctly import all classes and custom elements required as well as how to create a class
          signature that extends
        <span class="tei-code2 code">pbMixin</span>
        .
      </p>
      <pb-code-highlight class="tei-programlisting5" language="js" line-numbers="line-numbers">
import { LitElement, html, css } from 'lit-element';
import { pbMixin } from '@teipublisher/pb-components/src/pb-mixin';
import { translate } from "@teipublisher/pb-components/src/pb-i18n";
import '@polymer/paper-icon-button';
import '@polymer/iron-icons';

/**
 * A component with a button which copies the contained content to the clipboard.
 * Use for the typical 'quote this content as' hints on a webpage.
 * 
 * @slot content - contains the actual content to copy to the clipboard
 */
export class PbClipboard extends pbMixin(LitElement) {
      </pb-code-highlight>

      <p class="tei-para">
        Imports and render function sorted, there are two other static functions we need to
          take care of:
        <span class="tei-function code">properties</span>
        and
        <span class="tei-function code">styles</span>
        .
        <span class="tei-code2 code">pb-clipboard</span>
        has just a single property: the label to display above the
          copy text. Nevertheless it needs to explicitly declare properties inherited from pbMixin
          which is done via
        <span class="tei-code2 code">...super.properties</span>
        notation.
      </p>
      <pb-code-highlight class="tei-programlisting5" language="js" line-numbers="line-numbers">
static get properties() {
        return {
            /**
             * Label to display above the text to be copied
             */
            label: {
                type: String
            },
            ...super.properties
        };
    }
      </pb-code-highlight>

      <p class="tei-para">
        You probably noticed that the button we added in the
        <span class="tei-function code">render</span>
        function specifies what to do upon click event via
        <span class="tei-code2 code">click</span>
        attribute:
        <span class="tei-code2 code">@click="${this._copy}"</span>
        . A protected
        <span class="tei-function code">_copy</span>
        function of
          the element is called in such case and for our simple
        <span class="tei-code2 code">pb-clipboard</span>
        element it
          provides its core
        <span class="tei-emphasis2">copy-to-clipboard</span>
        functionality.
      </p>
      <pb-code-highlight class="tei-programlisting5" language="js" line-numbers="line-numbers">
/**
* Copy text content from the &lt;slot&gt; to the clipboard
*/

    _copy() {
        const slot = this.shadowRoot.querySelector('slot');
        
        // first import nodes from the slot into a temporary div
        const content = document.createElement('div');
        slot.assignedNodes().forEach((node) =&gt; {
            content.appendChild(document.importNode(node, true));
        });
        
        // copy the innerText of the temp div into the clipboard
        navigator.clipboard.writeText(content.innerText);
    }
      </pb-code-highlight>

      <p class="tei-para">
        We glanced over yet another interesting function invoked in the
        <span class="tei-code2 code">render</span>
        method.
        <span class="tei-code2 code">translate</span>
        , which accepts as an argument a key identifying a
          corresponding label in i18n language files. It could be one of keys shipping with TEI
          Publisher, but here, for a new component we need a more specific label, presenting the
          user with a short, informative text to be displayed when hovering over
        <span class="tei-emphasis2">copy-to-clipboard</span>
        button. Obviously, the label should change in
          line with the language setting for the whole application, which is why we need the i18n
          module in the first place.
      </p>
      <pb-code-highlight class="tei-programlisting5" language="js" line-numbers="line-numbers">
        title="${translate('clipboard.copy')}"
      </pb-code-highlight>
      <p class="tei-para">
        Please refer to the chapter on
        <a href="?odd=docbook.odd&amp;view=&amp;id=i18n" class="tei-link3" target="">i18n</a>
        for in-depth
          discussion of the subject. Here we'll just mention that additional language files for new
          components should be placed in
        <span class="tei-filename code">i18n/app</span>
        , mimicking the location and
          format of Publisher.
      </p>
      <pb-code-highlight class="tei-programlisting5" language="js" line-numbers="line-numbers">
{
  "clipboard": {
     "label": "Quote  as:",
     "copy": "Click to copy to clipboard"
  }
}
      </pb-code-highlight>
      <p class="tei-para">And one last job is a little bit of styling to make things pretty.</p>
      <pb-code-highlight class="tei-programlisting5" language="js" line-numbers="line-numbers">
static get styles() {
        return css`
            :host {
                display: block;
            }
            h3 {
                margin: 0;
                font-size: .85em;
                font-weight: normal;
                color: #3a3a3a;
            }
            div {
                display: flex;
                align-items: center;
                padding: 0 16px;
            }
        `;
    }
      </pb-code-highlight>
      <p class="tei-para">
        The final directive at the very bottom of
        <span class="tei-filename code">pb-clipboard.js</span>
        is
          necessary to register the custom element with the browser.
      </p>
      <pb-code-highlight class="tei-programlisting5" language="js" line-numbers="line-numbers">
        customElements.define('pb-clipboard', PbClipboard);
      </pb-code-highlight>
    </pb-observable></div>
    <div class="tei-section3" id="custom-components-testing"><pb-observable data="0,3.34.27" emit="transcription">
      <h2 class="tei-title7 title">Testing pb-clipboard</h2>
      <p class="tei-para">
        Have a look at the supplied
        <span class="tei-filename code">index.html</span>
        example. Run
        <span class="tei-code2 code">npm
            start</span>
        to run a simple
        <a href="https://www.npmjs.com/package/es-dev-server" class="tei-link4" target="_new">local server</a>
        instance
          which allows to test our developments as we work on them without bundling.
      </p>
      <p class="tei-para">
        Opening
        <span class="tei-filename code">index.html</span>
        with this server you can see
        <span class="tei-tag code">pb-clipboard</span>
        in action.
      </p>
      <pb-code-highlight class="tei-programlisting5" language="html" line-numbers="line-numbers">
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Using pb-clipboard&lt;/title&gt;
        &lt;style&gt;
            pb-clipboard {
                margin-bottom: 20px;
            }
        &lt;/style&gt;
        &lt;script type="module" src="src/pb-clipboard.js"&gt;&lt;/script&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;Using pb-clipboard&lt;/h1&gt;
        &lt;pb-clipboard label="Quote as:"&gt;John Doe: "The miracles of foobar", Paradise Publishers, Little Village, Stardate 46254.7&lt;/pb-clipboard&gt;
        &lt;input type="text" name="test-clipboard" value="" size="60"&gt;
    &lt;/body&gt;
&lt;/html&gt;
      </pb-code-highlight>
      <p class="tei-para">
        In order to use the element, you need to import the component code into your HTML
          page, as demonstrated with the
        <span class="tei-tag code">script</span>
        and
        <span class="tei-code2 code">src="src/pb-clipboard.js"</span>
        .
      </p>
      <p class="tei-para">
        It's all that is needed to use
        <span class="tei-tag code">pb-clipboard</span>
        as any other HTML element. Its
          label property is specified via
        <span class="tei-code2 code">@label</span>
        attribute and the copy text is just
          the text content of the element.
      </p>
      <p class="tei-para">Pressing the button copies the citation text from the page and, just to test, you can
          paste it into the input box below.</p>
      <figure class="tei-figure2 figure"><span class="tei--element">
          <span class="tei--element">
            <img src="pb-clipboard-action.png" class="tei-imagedata2" title="">
          </span>
        </span><figcaption>pb-clipboard in action on the es-dev-server</figcaption></figure>
    </pb-observable></div>
    <div class="tei-section3" id="custom-components-api"><pb-observable data="0,3.34.29" emit="transcription">
      <h2 class="tei-title7 title">API documentation</h2>
      <p class="tei-para">
        Implementing a new feature is only half of the task - and sometimes the easier bit.
          All
        <span class="tei-code2 code">pb-components</span>
        come with their API documentation and most of them also
          with one or more Demo showcases. Have a look e.g. at
        <span class="tei-tag code">pb-collapse</span>
        component for
          a simple one and compare with much more elaborate sections devoted to
        <span class="tei-tag code">pb-toggle-feature</span>
        or
        <span class="tei-tag code">pb-select-feature</span>
        .
      </p>
      <figure class="tei-figure2 figure"><span class="tei--element">
          <span class="tei--element">
            <img src="api-docs.png" class="tei-imagedata2" title="">
          </span>
        </span><figcaption>Initial part of the API tab of pb-collapse documentation</figcaption></figure>
      <p class="tei-para">
        API documentation is generated automatically by
        <span class="tei-code2 code">npm docs</span>
        task. You just
          need to add
        <a href="https://www.npmjs.com/package/web-component-analyzer#%E2%9E%A4-how-to-document-your-components-using-jsdoc" class="tei-link4" target="_new">documentation-style comments</a>
        in your code. Example below illustrates how to nest
          code examples or specify slots and events so they are picked by the documentation
          generator.
      </p>
      <pb-code-highlight class="tei-programlisting5" language="js" line-numbers="line-numbers">
/**
 * This is a documentation-style comment
 *
 * with code example
 * ```html
 * &lt;pb-foo&gt;
 *   &lt;slot&gt;&lt;/slot&gt;
 *   &lt;div slot="foo-content"&gt;
 *       Foo bar
 *   &lt;/div&gt;
 * &lt;/pb-foo&gt;
 * ```
 * slots specification:
 *
 * @slot - unnamed default slot
 * @slot foo-content - content to be shown when foo happens
 *
 * events specification:
 * 
 * @fires pb-foo-open - Fires opening the foo section
 */
      </pb-code-highlight>
      <div class="tei-section3" id="custom-components-demo"><pb-observable data="0,3.34.29.13" emit="transcription">
        <h3 class="tei-title7 title">Demo</h3>
        <p class="tei-para">We encourage you to prepare a demo entry for each newly created component. Demo
            ideally presents one or more use case examples which illustrate where and how would you
            use a component. Keep the demo page simple and minimal, so other elements do not
            obstruct understanding the code.</p>
        <figure class="tei-figure2 figure"><span class="tei--element">
            <span class="tei--element">
              <img src="api-docs-demo.png" class="tei-imagedata2" title="">
            </span>
          </span><figcaption>Demo file for pb-clipboard</figcaption></figure>
        <p class="tei-para">
          Save your demo files in
          <span class="tei-filename code">demo</span>
          directory and register it in
          <span class="tei-filename code">demo/demos.json</span>
          with the demo filename and your chosen label for
            the tab (but please stick to Demo if you only have one).
        </p>
        <pb-code-highlight class="tei-programlisting5" language="js" line-numbers="line-numbers">
"pb-collapse": {
  "demo/pb-collapse.html": "Demo"
}
        </pb-code-highlight>
        <p class="tei-para">If you supply a number of demo files, choose meaningful labels for tabs, e.g.</p>
        <pb-code-highlight class="tei-programlisting5" language="js" line-numbers="line-numbers">
"pb-toggle-feature": {
  "demo/pb-toggle-feature.html": "Server-side with pb-view",
  "demo/pb-toggle-feature2.html": "Client-side",
  "demo/pb-toggle-feature3.html": "Server-side with pb-load"
}
        </pb-code-highlight>
      </pb-observable></div>
    </pb-observable></div>
    <div class="tei-section3" id="custom-components-bundle"><pb-observable data="0,3.34.31" emit="transcription">
      <h2 class="tei-title7 title">Bundling and distribution</h2>
      <p class="tei-para">
        Any new component
        <span class="tei-emphasis1">must</span>
        be explicitly imported by
        <span class="tei-filename code">pb-extension-bundle.js</span>
        .
      </p>
      <pb-code-highlight class="tei-programlisting5" language="js" line-numbers="line-numbers">
        import './src/pb-clipboard.js';
      </pb-code-highlight>
      <p class="tei-para">
        Run
        <span class="tei-code2 code">npm build:production</span>
        to generate a distribution bundle. The generated
          library (located in
        <span class="tei-filename code">dist</span>
        ) will include everything, including the
          version of the
        <span class="tei-code2 code">pb-components</span>
        library you are building upon and all
          dependencies. As a result, you can use it as a drop-in replacement for
        <span class="tei-code2 code">pb-components</span>
        package: in your custom project, for TEI Publisher itself or
          Publisher-generated custom apps.
      </p>
    </pb-observable></div>
    <div class="tei-section3" id="custom-components-using"><pb-observable data="0,3.34.33" emit="transcription">
      <h2 class="tei-title7 title">Using pb-extension-bundle in TEI Publisher or other apps</h2>
      <p class="tei-para">
        The created library can be used as a drop-in replacement for the default
        <span class="tei-code2 code">pb-components</span>
        library.
      </p>
      <p class="tei-para">To do so:</p>
      <ol class="tei-procedure"><li class="tei-step">
          <p class="tei-para">
            clone
            <span class="tei-code2 code">tei-publisher-app</span>
            or the generated app you would like to
              modify
          </p>
        </li><li class="tei-step">
          <p class="tei-para">
            edit
            <span class="tei-filename code">package.json</span>
            and replace the dependency for
            <span class="tei-parameter code">@teipublisher/pb-components</span>
            with the replacement
              library
          </p>
        </li><li class="tei-step">
          <p class="tei-para">
            edit
            <span class="tei-filename code">build.properties</span>
            and change
            <span class="tei-parameter code">scripts.dir</span>
            to point to the replacement library
          </p>
        </li><li class="tei-step">
          <p class="tei-para">
            call
            <span class="tei-code2 code">ant</span>
            to build
            <span class="tei-code2 code">tei-publisher-app</span>
          </p>
        </li></ol>

      <p class="tei-para">
        For example, to use the git source of
        <span class="tei-code2 code">pb-extension-template</span>
        in
        <span class="tei-filename code">package.json</span>
        , change the dependencies as follows:
      </p>
      <pb-code-highlight class="tei-programlisting5" language="js" line-numbers="line-numbers">
"dependencies": {
   "@teipublisher/pb-extension-template": "git+https://github.com/eeditiones/pb-extension-template#master"
} 
        </pb-code-highlight>
      <p class="tei-para">
        then change
        <span class="tei-filename code">build.properties</span>
        to contain:
      </p>
      <pb-code-highlight class="tei-programlisting5" language="js" line-numbers="line-numbers">scripts.dir=node_modules/@teipublisher/pb-extension-template/dist</pb-code-highlight>

      <p class="tei-para">
        Building
        <span class="tei-code2 code">tei-publisher-app</span>
        should then copy scripts and resources from
        <span class="tei-code2 code">pb-extension-template</span>
        instead of
        <span class="tei-code2 code">pb-components</span>
        .
      </p>

      <div class="tei-note3 note"><h4 class="tei-title4">Note</h4><p class="tei-para">
          Make sure to adjust the repository link and name of the extension module to the one
            you created. Example above assumes working directly with
          <span class="tei-code2 code">pb-extension-template</span>
          but it's unlikely to be the case in real
            life.
        </p></div>
    </pb-observable></div>

  </pb-observable></div>

  <div class="tei-section3" id="new-vocabulary"><pb-observable data="0,3.36" emit="transcription">
    <h1 class="tei-title7 title">Adding a custom vocabulary</h1>
    <p class="tei-para">As discussed in the opening chapter, publishing a corpus of documents online is much
        more than just transforming a single source document into the desired output format. To
        fully support a new XML vocabulary in TEI Publisher several aspects need to be
        adressed:</p>
    <ul class="tei-itemizedlist"><li class="tei-listitem">
        <p class="tei-para">ODD with processing models</p>
      </li><li class="tei-listitem">
        <p class="tei-para">default view and page template</p>
      </li><li class="tei-listitem">
        <p class="tei-para">navigation, breadcrumbs and table of contents</p>
      </li><li class="tei-listitem">
        <p class="tei-para">search and filtering: full text index definitions, facets and fields</p>
      </li></ul>
    <p class="tei-para">ODD and processing models within it govern how the document in your new vocabulary will
        be transformed into a range of available output formats: HTML, ePub etc.</p>
    <p class="tei-para">
      All other aspects are interconnected and depend on the understanding what constitutes
        the basic unit of the text: TEI primarily considers
      <span class="tei-emphasis2">divisions</span>
      or
      <span class="tei-emphasis2">pages</span>
      , DocBook rather
      <span class="tei-emphasis2">sections</span>
      . Therefore
        navigation for TEI document will be switching between
      <span class="tei-tag code">div</span>
      s or reconstructed XML
        fragments between subsequent
      <span class="tei-tag code">pb</span>
      s, while talking about pages in DocBook documents
        makes no sense and
      <span class="tei-tag code">section</span>
      s are the main structural units.
    </p>
    <p class="tei-para">
      This structure has its consequences for further aspects: generating TOC in TEI will
        analyze nested
      <span class="tei-tag code">div</span>
      /
      <span class="tei-tag code">head</span>
      structures but only
      <span class="tei-tag code">section</span>
      /
      <span class="tei-tag code">title</span>
      in DocBook. Likewise, KWIC display in TEI will be
        showing matches in
      <span class="tei-tag code">div</span>
      context but
      <span class="tei-tag code">section</span>
      in DocBook, so Lucene
        indexes need to be defined on these elements in their appropriate namespaces. Ditto for
        facets and fields used for sorting and filtering.
    </p>
    <p class="tei-para">Sections below will explain where and how to customize these aspects in more
        detail.</p>
    <div class="tei-section3" id="new-vocabulary-odd"><pb-observable data="0,3.36.17" emit="transcription">
      <h2 class="tei-title7 title">ODD</h2>
      <p class="tei-para">
        Create a new, blank ODD file which is not chained to any other ODD and add
        <span class="tei-tag code">elementSpec</span>
        s for its elements. Make sure that you specify correct namespace
          for your vocabulary. Optionally, you can also specify an external CSS file with style
          declarations for classes and elements you will be using in processing models of your
          ODD.
      </p>
      <p class="tei-para">See how it looks in the ODD for DocBook.</p>
      <figure class="tei-figure2 figure"><span class="tei--element">
          <span class="tei--element">
            <img src="new-vocabulary-odd.png" class="tei-imagedata2" title="">
          </span>
        </span><figcaption>ODD for DocBook</figcaption></figure>
      <p class="tei-para">
        When adding models into the custom ODD for your vocabulary it is recommended that at
          least one element applies the
        <span class="tei-parameter code">document</span>
        behaviour. Usually it will
          be the top level element or the main content-bearing one (like
        <span class="tei-tag code">article</span>
        in
          DocBook).
      </p>
      <p class="tei-para">
        This is not strictly required but for print output via LaTeX or FO the
        <span class="tei-parameter code">document</span>
        behaviour specifies default prologue governing basic
          setup for PDF. If you refer to the
        <span class="tei-filename code">docbook.odd</span>
        you will note that the
          same effect is achieved by explicitly defining the prologue in the
        <span class="tei-tag code">pb:template</span>
        for
        <span class="tei-parameter code">article</span>
        .
      </p>
      <div class="tei-section3" id="new-vocabulary-foo"><pb-observable data="0,3.36.17.15" emit="transcription">
        <h3 class="tei-title7 title">Case study: foo vocabulary</h3>
        <p class="tei-para">
          Let's consider an imaginary vocabulary called
          <span class="tei-emphasis2">foo</span>
          . All
            documents in this vocabulary will belong to the
          <span class="tei-code2 code">http://foo.io</span>
          namespace.
            Simple document could look as follows:
        </p>
        <pb-code-highlight class="tei-programlisting5" language="xml" line-numbers="line-numbers">
        &lt;fooStart xmlns="http://foo.io"&gt;
          &lt;foo&gt;My foo document&lt;/foo&gt;
          &lt;bar&gt;About something very important for foo community.&lt;/bar&gt;
        &lt;/fooStart&gt;
        </pb-code-highlight>
        <p class="tei-para">
          Let's save this document in the
          <span class="tei-filename code">playground</span>
          collection as
          <span class="tei-filename code">foo.xml</span>
          .
        </p>
        <p class="tei-para">
          Unfortunately a request to retrieve this document in Publisher fails with
          <span class="tei-emphasis2">the server did not return any content</span>
          error message.
        </p>
        <pb-code-highlight class="tei-programlisting5" language="xml" line-numbers="line-numbers">http://localhost:8080/exist/apps/tei-publisher/playground/foo.xml</pb-code-highlight>
        <p class="tei-para">
          Fixing this will require creating a new ODD for
          <span class="tei-emphasis2">foo</span>
          vocabulary.
        </p>
        <p class="tei-para">
          Create a new ODD as described previously. Use
          <span class="tei-parameter code">document</span>
          behaviour for
          <span class="tei-tag code">fooStart</span>
          element and perhaps
          <span class="tei-tag code">inline</span>
          with an
          <span class="tei-tag code">outputRendition</span>
          set to
          <span class="tei-parameter code">italic</span>
          for
          <span class="tei-tag code">foo</span>
          element. Please note to specify the ODD for your vocabulary.
        </p>


        <p class="tei-para">
          Very bare bones ODD file for a fictional
          <span class="tei-emphasis2">Foo</span>
          vocabulary could
            look as follows:
        </p>
        <figure class="tei-figure2 figure"><span class="tei--element">
            <span class="tei--element">
              <img src="foo-odd.png" class="tei-imagedata2" title="">
            </span>
          </span><figcaption>ODD for Foo</figcaption></figure>

        <p class="tei-para">Or, in XML form:</p>
        <pb-code-highlight class="tei-programlisting5" language="xml" line-numbers="line-numbers">
&lt;schemaSpec start="fooStart" ident="foo" ns="http://foo.io"&gt; 
   &lt;elementSpec ident="foo" mode="add"&gt;
       &lt;model behaviour="inline"&gt;
           &lt;outputRendition&gt;font-style: italic;&lt;/outputRendition&gt;
       &lt;/model&gt;
   &lt;/elementSpec&gt;
   &lt;elementSpec ident="fooStart" mode="add"&gt;
       &lt;model behaviour="document"/&gt;
   &lt;/elementSpec&gt;
&lt;/schemaSpec&gt;
        </pb-code-highlight>
        <p class="tei-para">
          With this in place we could reformulate our request to explicitly specify the ODD to
            use and a
          <span class="tei-parameter code">single</span>
          view.
        </p>
        <pb-code-highlight class="tei-programlisting5" language="xml" line-numbers="line-numbers">http://localhost:8080/exist/apps/tei-publisher/playground/foo.xml?odd=foo&amp;view=single</pb-code-highlight>
        <figure class="tei-figure2 figure"><span class="tei--element">
            <span class="tei--element">
              <img src="foo-single-view.png" class="tei-imagedata2" title="">
            </span>
          </span><figcaption>foo.xml rendered with foo.odd in single view</figcaption></figure>
        <div class="tei-note3 note"><h4 class="tei-title4">Note</h4><p class="tei-para">
            It is necessary to use
            <span class="tei-parameter code">single</span>
            view along with the
            <span class="tei-parameter code">foo.odd</span>
            . Otherwise, the app default view would be used, which
              in TEI Publisher is normally set to
            <span class="tei-parameter code">div</span>
            . As we already
              mentioned, implementation of view parameters needs to be vocabulary-specific to work.
              Since
            <span class="tei-emphasis2">foo</span>
            vocabulary doesn't yet have navigation customized, TEI
              Publisher will fall back to TEI and try to locate
            <span class="tei-tag code">tei:div</span>
            elements, which
              obviously cannot be found in our test document in foo namespace.
          </p></div>
      </pb-observable></div>

    </pb-observable></div>
    <div class="tei-section3" id="new-vocabulary-default-view"><pb-observable data="0,3.36.19" emit="transcription">
      <h2 class="tei-title7 title">Default view and page template</h2>
      <p class="tei-para">
        Rendering of the document is governed by a number of parameters, particularly
        <span class="tei-parameter code">view</span>
        ,
        <span class="tei-parameter code">ODD</span>
        and
        <span class="tei-parameter code">template</span>
        :
      </p>
      <p class="tei-para">
        Even when these parameters are not explicitly specified, TEI Publisher and apps
          generated from it, will fall back to the default values specified in
        <span class="tei-filename code">modules/config.xqm</span>
        .
      </p>

      <ul class="tei-itemizedlist"><li class="tei-listitem">
          <p class="tei-para">
            ODD:
            <span class="tei-code2 code">$config:default-view</span>
          </p>
        </li><li class="tei-listitem">
          <p class="tei-para">
            view:
            <span class="tei-code2 code">$config:default-view</span>
          </p>
        </li><li class="tei-listitem">
          <p class="tei-para">
            template:
            <span class="tei-code2 code">$config:default-template</span>
          </p>
        </li></ul>
      <p class="tei-para">
        Alternative way to specify these would be using a
        <a href="?odd=docbook.odd&amp;view=&amp;id=pi-config" class="tei-link3" target="">processing
            instruction</a>
        in the foo.xml document itself.
      </p>
      <pb-code-highlight class="tei-programlisting5" language="xml" line-numbers="line-numbers">
        &lt;?teipublisher odd="foo.odd" view="single" template="view.html"?&gt;
      </pb-code-highlight>
    </pb-observable></div>
    <div class="tei-section3" id="new-vocabulary-lucene"><pb-observable data="0,3.36.21" emit="transcription">
      <h2 class="tei-title7 title">Lucene configuration</h2>
      <p class="tei-para">eXist-db and TEI Publisher make extensive use of Lucene indexing engine. In particular
          search, navigation, sorting and filtering heavily depend on full text indexes, facets and
          fields. It is therefore paramount to specify these correctly for your data
          collection.</p>
      <p class="tei-para">
        Supporting a new vocabulary, make sure to add its namespace on the
        <span class="tei-tag code">index</span>
        element in
        <span class="tei-filename code">collection.xconf</span>
        .
      </p>
      <pb-code-highlight class="tei-programlisting5" language="xml" line-numbers="line-numbers">
&lt;index xmlns:tei="http://www.tei-c.org/ns/1.0" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:dbk="http://docbook.org/ns/docbook"&gt;
      </pb-code-highlight>
      <p class="tei-para">Beyond this minor adjustment, adding a new vocabulary does not differ in creation and
          use of facets and fields.</p>
    </pb-observable></div>
    <div class="tei-section3" id="new-vocabulary-navigation"><pb-observable data="0,3.36.23" emit="transcription">
      <h2 class="tei-title7 title">Navigation</h2>
      <p class="tei-para">We have extensively covered modifications to the ODD and page templates in earlier
          chapters. In case of vocabularies without out-of-the-box Publisher support it is necessary
          to customize the navigation as well. Tacit understanding of document's structure is
          critical for many kinds of user interactions - from browsing through pages to creating the
          table of contents.</p>
      <p class="tei-para">
        <span class="tei-filename code">modules/navigation.xql</span>
        is the main "control room" for all tasks
          related to navigation. You will note that it imports custom modules for all supported
          vocabularies:
        <span class="tei-emphasis2">TEI</span>
        ,
        <span class="tei-emphasis2">JATS</span>
        and
        <span class="tei-emphasis2">DocBook</span>
        . All requests are dispatched to specialized modules,
          depending on the namespace of the document (cf.
        <span class="tei-function code">config:document-type</span>
        function).
      </p>
      <pb-code-highlight class="tei-programlisting5" language="xquery" line-numbers="line-numbers">
module namespace nav="http://www.tei-c.org/tei-simple/navigation";

import module namespace tei-nav="http://www.tei-c.org/tei-simple/navigation/tei" at "navigation-tei.xql";
import module namespace jats-nav="http://www.tei-c.org/tei-simple/navigation/jats" at "navigation-jats.xql";
import module namespace docbook-nav="http://www.tei-c.org/tei-simple/navigation/docbook" at "navigation-dbk.xql";
      </pb-code-highlight>
      <p class="tei-para">Customizing yet unsupported vocabulary will require:</p>
      <ul class="tei-itemizedlist"><li class="tei-listitem">
          <p class="tei-para">
            create a new navigation module for the new vocabulary (e.g.
            <span class="tei-filename code">navigation-foo.xql</span>
            ; it should implement all the functions that
            <span class="tei-function code">navigation.xql</span>
            dispatches to; you can use
            <span class="tei-filename code">navigation-tei</span>
            as a starting point for customization
          </p>
        </li><li class="tei-listitem">
          <p class="tei-para">
            import it into
            <span class="tei-filename code">navigation.xql</span>
          </p>
        </li><li class="tei-listitem">
          <p class="tei-para">
            adjust
            <span class="tei-function code">config:document-type</span>
            function
          </p>
        </li><li class="tei-listitem">
          <p class="tei-para">
            adjust
            <span class="tei-function code">nav:get-root</span>
          </p>
        </li></ul>
    </pb-observable></div>
    <div class="tei-section3" id="new-vocabulary-search"><pb-observable data="0,3.36.25" emit="transcription">
      <h2 class="tei-title7 title">Search</h2>
      <p class="tei-para">
        Full text search is realized via the same modular approach that governs navigation.
        <span class="tei-filename code">modules/query.xql</span>
        is the main "control room", dispatching requests
          to functions in specialized modules. See implementation of
        <span class="tei-filename code">query-db.xql</span>
        or
        <span class="tei-filename code">query-tei.xql</span>
        before creating
          a dedicated module for your vocabulary. Make sure to import your module into
        <span class="tei-filename code">query.xql</span>
        .
      </p>
    </pb-observable></div>

  </pb-observable></div>
  <div class="tei-section3" id="web-annotations"><pb-observable data="0,3.38" emit="transcription">
    <h1 class="tei-title7 title">Annotating Documents</h1>
    <p class="tei-para">Since version 7.1.0, TEI Publisher supports annotating TEI documents via a graphic, web based interface. This means you can 
      enhance existing TEI documents directly within TEI Publisher in a user-friendly environment where XML code is neatly hidden from sight when not needed.</p>
    <p class="tei-para">The annotation editor is not meant for creating documents from scratch but targets one of the most tedious and time consuming tasks in any edition project: 
      adding semantic, analytic or text-critical markup to an existing transcription.</p>
      <figure class="tei-figure2 figure"><span class="tei--element">
          <span class="tei--element">
            <img src="ann-overview.png" class="tei-imagedata2" title="" style="width: 900px; ">
          </span>
        </span><figcaption>Annotation editor</figcaption></figure>
      <p class="tei-para">Typical workflow for many projects will resemble the following:</p>
    <ol class="tei-orderedlist"><li class="tei-listitem">
        <p class="tei-para">An initial transcription is created, either manually in a text editor, or using OCR or HTR tools like Transkribus. 
          It contains the basic structural markup, i.e. divisions, headings, paragraphs etc.</p>
      </li><li class="tei-listitem">
        <p class="tei-para">That initial transcription is gradually enriched: textual features like emphasis can be marked, abbreviations expanded, corrections and regularizations applied;
          people, places or terms appearing in the text can be explicitly tagged and linked to an authority; dates or measures normalized. This is an iterative process: the resulting TEI encoding is 
          constantly reviewed, which may result in further changes to be made.</p>
      </li></ol>
    <p class="tei-para">Web annotations try to ease the burden of the enrichment phase by allowing editors to mark everything directly within the user-friendly environment, closely resembling the publication view.
      It is much easier to read and doesn't require half as much TEI experience as using an XML editor. Just use your mouse to highlight the text fragment to annotate, click on the annotation type 
      and optionally select additional information, e.g. to link with an external authority file.</p>
    <div class="tei-section3"><pb-observable data="0,3.38.17" emit="transcription">
      <h2 class="tei-title7 title">Prerequisites and considerations</h2>
      <ul class="tei-itemizedlist"><li class="tei-listitem">
          <p class="tei-para"><span class="tei-emphasis1">Browsers</span></p>
          <p class="tei-para">The annotation editor requires a modern browser like Firefox, Chrome or a Chrome-based browser like the newest Edge on Windows 10. <span class="tei-emphasis2">Safari</span> will not work due to a known bug in text selection, which Apple seems reluctant to fix.</p>
          <p class="tei-para">Directly exporting the resulting text to a directory of the user's choice, is currently only supported in Chrome.</p>
        </li><li class="tei-listitem">
          <p class="tei-para"><span class="tei-emphasis1">Division size</span></p>
          <p class="tei-para">The editor should work fine for texts up to the length of a journal article or chapter. Really long texts (e.g. a whole book) will be automatically split by top divisions, but you may still experience a recognizable time lag for long divisions.</p>
        </li></ul>
      <p class="tei-para">Annotations have been extensively tested, and should work reliably for tagging entities and other inline markup. 
        You may want to keep an eye on the resulting TEI when testing annotations on your material. We appreciate bug reports and suggestions for improvement.</p>
    </pb-observable></div>
    <div class="tei-section3"><pb-observable data="0,3.38.19" emit="transcription">
      <h2 class="tei-title7 title">Annotations: the pen and paper of the digital world</h2>
      <p class="tei-para">How the annotation editor works is easy to understand if you imagine reviewing a text the old-fashioned way: print it out, 
        then use a marker to highlight certain passages, write corrections over the text with a pen, or scribble notes into the margin. 
        Once back at your computer, all the changes need to be transferred into the TEI. You may then continue with a second round 
        of review by printing out the results again.</p>

      <p class="tei-para">Within our electronic environment, the printout corresponds to the source TEI document and the marks and scribbles are annotations. 
        Until you explicitely merge the annotations into the source TEI, they will be kept separate from the document they apply to. Once merged, 
        a new version of the source TEI document is established and the editing process restarts.</p>
      <p class="tei-para">Notably, TEI Publisher is able to detect existing markup in the base text when it is loaded. Any markup corresponding to a known annotation 
        type will be recognized and displayed as such, therefore it can be modified. In this sense it is slightly different from working with pen and paper.</p>
      <p class="tei-para">From the printout example it should be clear that you cannot change the printed text itself (unless you had some magic paper). Accordingly, 
        annotations are not allowed to change the base text, i.e. the text "printed" on the screen. If you want to explicitly indicate a correction, 
        you can use the <span class="tei-emphasis2">corr</span> or <span class="tei-emphasis2">reg</span> annotation type, which corresponds to the TEI encoding with choice/sic/corr or choice/orig/reg.
      </p>
      <p class="tei-para">You can use annotations for virtually any kind of inline markup. The only strict requirement is that the <span class="tei-emphasis2">base text</span>, our source document,
        remains stable <span class="tei-emphasis2">during an editing session</span> i.e. until annotations are merged. The reason for that is the annotations are anchored to a 
        certain position in the document, so any changes to it would mean that our coordinates might suddenly point to different fragments.</p>
      <p class="tei-para">That said, there's also a special <span class="tei-emphasis2">edit</span> annotation type, which does allow you to perform limited editing of a text.
        It will just "seamlessly" change the transcription text fragment 
        without adding any explicit markup. Nevertheless, such a change to the TEI document is only applied when you merge and therefore 
        establish a new base text. The limitation is that only text fragments can be edited: the boundaries of structural markup or annotations may not be crossed.
        It can be convenient for fixing a typo in a transcription that wasn’t caught when the base text was prepared.</p>
      <p class="tei-para">You also cannot use the annotation editor to modify the structural markup of the base text, i.e. block-level elements like divs, paragraphs, headings or notes. In case you need to change
        the structure, you have to merge your annotations first, saving a new version of the TEI document and switch to an XML editor to change the XML there. 
        The new document can be then reloaded into the annotation editor and you can continue.</p>
      <p class="tei-para">As already indicated, it is possible to handle common nested encoding structures like <span class="tei-tag code">choice</span> or <span class="tei-tag code">app</span> as annotations. 
        Nevertheless the inner elements, i.e. <span class="tei-tag code">lem</span>, <span class="tei-tag code">rdg</span>, <span class="tei-tag code">sic</span>, <span class="tei-tag code">corr</span> or <span class="tei-tag code">orig</span>, <span class="tei-tag code">reg</span>, need to have 
        simple text content: they cannot be annotated themselves (at least not in the current version).</p>
    </pb-observable></div>
  <div class="tei-section3"><pb-observable data="0,3.38.21" emit="transcription">
    <h2 class="tei-title7 title">Applying Annotations</h2>
    <p class="tei-para">To start annotating a document, select or upload one into the annotations collection in TEI Publisher.</p>
    <figure class="tei-figure2 figure"><span class="tei--element">
        <span class="tei--element">
          <img src="ann-playground.png" class="tei-imagedata2" title="" style="width: 900px; ">
        </span>
      </span><figcaption>Annotation playground</figcaption></figure>
    <p class="tei-para">Selecting any document in this collection will load the annotation view. This view is split into three areas:</p>
    <ol class="tei-orderedlist"><li class="tei-listitem">
        <p class="tei-para">a sidebar to the left, initially showing only a toolbar with a disabled button for each annotation type</p>
      </li><li class="tei-listitem">
        <p class="tei-para">the annotation view in the middle, displaying the text content to be annotated</p>
      </li><li class="tei-listitem">
        <p class="tei-para">a preview panel to the right: this is initially empty, but will come to life once you start making annotations</p>
      </li></ol>
    <figure class="tei-figure2 figure"><span class="tei--element">
        <span class="tei--element">
          <img src="ann-init.png" class="tei-imagedata2" title="" style="width: 900px; ">
        </span>
      </span><figcaption>Annotation view</figcaption></figure>
    <p class="tei-para">To annotate a certain passage, select it with your mouse. The toolbar buttons in the left sidebar now become active. Choose an annotation 
      by clicking the corresponding button or using a keyboard shortcut. Hovering over buttons you can see an info text with a brief description 
      and a keyboard shortut.</p>
      <figure class="tei-figure2 figure"><span class="tei--element">
          <span class="tei--element">
            <img src="ann-types.png" class="tei-imagedata2" title="" style="width: 300px; ">
          </span>
        </span><figcaption>Annotation types</figcaption></figure>
    <p class="tei-para">Depending on the chosen annotation type, a form will appear beneath the toolbar. We distinguish three categories of annotations:
      <ol class="tei-orderedlist"><li class="tei-listitem">
          <p class="tei-para">semantic annotations, which are (usually) connected to an external authority, e.g. for people, places, organizations or terms.</p>
        </li><li class="tei-listitem">
          <p class="tei-para">"toggle" annotations, which do not need require additional information, so they simply switch an annotation on/off, e.g. for deletions 
            or titles (not part of the default annotation editor setup).</p>
        </li><li class="tei-listitem">
          <p class="tei-para">analytic or text critical annotations, which may require further input from the user, e.g. a normalized date.</p>
        </li></ol>
    These categories are not mutually exclusive but may be helpful to explain the main functional differences between the three use scenarios.
    </p>
    <div class="tei-section3"><pb-observable data="0,3.38.21.20" emit="transcription">
      <h3 class="tei-title7 title">Semantic Annotations</h3>
      <p class="tei-para">Semantic annotations include markup for entities like people, places or terms. Most editions will try to link those to a description of the entity, either provided by an external authority file or from a local resource. 
        In any case you will want to reference a unique identifier to mark occurrences of the same entity throughout the edition.</p>
    <p class="tei-para">When choosing a semantic annotation from the toolbar, you will thus see a dialog which runs a query against the authority 
      file configured for the annotation type, e.g. Geonames for places or GND for people.
       </p>
       <figure class="tei-figure2 figure"><span class="tei--element">
          <span class="tei--element">
            <img src="ann-person.png" class="tei-imagedata2" title="" style="width: 800px; ">
          </span>
        </span><figcaption>Annotating a person</figcaption></figure>
    <p class="tei-para">The semantic annotation dialog displays the query results for you to choose from and the query sent initially corresponds to 
      the text selection made. Often this may not find the relevant entity, but you can change the query in the input field on top of the dialog 
      and run the search again by pressing enter. Compare the screenshots above and below to note the difference when searching for 
      <span class="tei-emphasis2">William</span> vs <span class="tei-emphasis2">William Graves</span></p>
      <figure class="tei-figure2 figure"><span class="tei--element">
          <span class="tei--element">
            <img src="ann-person2.png" class="tei-imagedata2" title="" style="width: 800px; ">
          </span>
        </span><figcaption>Re-running the query</figcaption></figure>
    <p class="tei-para">When you use the + sign to select an authority entry, its ID will be copied into the top input field in the left sidebar and a short 
      description of the entity should appear beneath. The ID will be used as reference in the resulting TEI, i.e. it will appear in an attribute 
      attached to e.g. <span class="tei-tag code">persName</span> or other TEI element. The exact mapping between an annotation type and a TEI snippet produced can be freely configured (see below).</p>
    <p class="tei-para">Semantic annotations are stored in the annotation list immediately after you select an authority entry, so you don't have to click anywhere else.</p>
    <p class="tei-para"><span class="tei-emphasis1">Batch edits and suggestions</span></p>
    <p class="tei-para">It is not uncommon that the same person will be mentioned multiple times in a document. To simplify and speed up the editing process, the annotation
      editor tries to detect possible other occurrences of the currently selected entity throughout the document. A list of potential matches is presented at the 
    bottom of the left sidebar.</p>
    <p class="tei-para">The list is compiled by traversing the text shown on screen, searching for strings which may indicate the same entity. The actual query depends on the information provided authority used: e.g. if the authority supplies alternative names, those will be added to the searched for strings.</p>
    <p class="tei-para">Each occurrence will show a checkbox to the left. Checking it will immediately tag the corresponding passage as another instance of the same entity. You can also check all boxes at once by clicking on the icon to the top right above the list.</p>
    <p class="tei-para">Moving your mouse over an entry will scroll the text to the corresponding occurrence, showing you the match in its context.</p>
    <p class="tei-para">Existing annotations referencing the same entity will also be shown in the list - with their checkbox checked. Sometimes you may also see 
      an entry with red dots beneath, indicating that this is an existing annotation referencing a different entity, so considered a potential inconsistency to review.
      For example, if you selected the authority entry for "Ronald Reagan", you may see other occurrences of "Reagan", which have already been annotated as "Nancy Reagan". 
      You will see those occurrences underlined with red dots. You can switch them to "Ronald Reagan" by checking their box.</p>
    <p class="tei-para">Unchecking a box will remove the existing annotation, e.g. incorrectly applied one.</p>
    <figure class="tei-figure2 figure"><span class="tei--element">
        <span class="tei--element">
          <img src="ann-reagan.jpg" class="tei-imagedata2" title="" style="width: 800px; ">
        </span>
      </span><figcaption>Inconsistency warning</figcaption></figure>
    </pb-observable></div>
    <div class="tei-section3"><pb-observable data="0,3.38.21.22" emit="transcription">
      <h3 class="tei-title7 title">Toggle Annotations</h3>
      <p class="tei-para">Toggle annotations are immediately applied when you click the annotation button. Since they do not require any further input they are just simply applied without much ado.
        Some good candidates might be titles or deletions.
      </p>
      <p class="tei-para">It is worth noting that it's not a textual phenomenon that constitutes a <span class="tei-emphasis2">toggle</span> annotation 
        versus <span class="tei-emphasis2">semantic</span> or <span class="tei-emphasis2">analytic</span> in our simple category scheme. It is rather what kinds of detail a particular project
        decides to encode or not. Encoding of titles can be a <span class="tei-emphasis2">toggle</span> if we just decide to simply say that a text fragment is a title. It could become a
        <span class="tei-emphasis2">semantic</span> annotation if we'd like to associate it with a bibliographical reference or other detailed information.
      </p>
    </pb-observable></div>
    <div class="tei-section3"><pb-observable data="0,3.38.21.24" emit="transcription">
      <h3 class="tei-title7 title">Analytic and Text Critical Annotations</h3>
      <p class="tei-para">These annotations are not connecting to an authority reference, but typically require further input to be made by the user. 
        For example a <span class="tei-tag code">date</span> annotation requires the editor to supply a normalized date, while normalizations, abbreviations and corrections need 
        regularized, expanded or corrected form, respectively. Apparatus entries will require all the variant readings. 
        For all these annotations an input form will be shown into which such information can be entered. The exact content of the form depends on the annotation type.</p>
      <p class="tei-para">To store the annotation, you must click on the save button beneath the form after filling the required fields.</p>
      <figure class="tei-figure2 figure"><span class="tei--element">
          <span class="tei--element">
            <img src="ann-correction.png" class="tei-imagedata2" title="" style="width: 800px; ">
          </span>
        </span><figcaption>Correction</figcaption></figure>
    </pb-observable></div>
  </pb-observable></div>
  <div class="tei-section3"><pb-observable data="0,3.38.23" emit="transcription">
    <h2 class="tei-title7 title">Modifying Annotations</h2>
    <p class="tei-para">The annotation view shows a colored line beneath the text spanned by each annotation. You can select text within an existing annotation or 
      across multiple different ones and apply yet another annotation to it, thus resulting in <span class="tei-emphasis2">nested annotations</span>. 
      However, the editor will ensure that you do not select partial elements, for example, a range of text followed by half of a <span class="tei-tag code">persName</span>. 
      This would result in invalid XML, so the editor will automatically expand your selection to include the entire <span class="tei-tag code">persName</span>.</p>
    <figure class="tei-figure2 figure"><span class="tei--element">
        <span class="tei--element">
          <img src="ann-nested.png" class="tei-imagedata2" title="" style="width: 600px; ">
        </span>
      </span><figcaption>Nested annotations</figcaption></figure>
    <p class="tei-para">To the right of the annotated text, a colored box indicates the type of the annotation. The sequence of boxes also indicates 
      how annotations are nested: the ones appearing to the right are wrapping those to the left. In the example above the "church of 
      San Francisco" is a reference to a place, while "San Francisco" refers to a person, a patron saint of the church. The <span class="tei-tag code">persName</span> 
      element is nested in the <span class="tei-tag code">placeName</span>.</p>
    <p class="tei-para">Click on the colored box to see details about the annotation. For semantic annotations, the details will include a summary of the entity drawn from the connected authority or the local TEI register. For analytic and text critical annotations, a table is shown, listing the corresponding attributes associated with the annotation.</p>
    <figure class="tei-figure2 figure"><span class="tei--element">
        <span class="tei--element">
          <img src="ann-details.png" class="tei-imagedata2" title="" style="width: 800px; ">
        </span>
      </span><figcaption>Annotation details</figcaption></figure>
    <p class="tei-para">The toolbar at the bottom of the popup allows to delete or modify the annotation. Clicking the delete button will immediately remove the annotation, without asking for confirmation.</p>
    <p class="tei-para">Clicking on the pen icon will open the annotation in the left sidebar, where you can change it. For semantic annotations, the authority lookup dialog will pop up automatically and you can change the connected authority entry by selecting a different one.</p>
    <p class="tei-para">Again, semantic annotations are applied immediately, while analytic and text critical annotations require a click on the save button after making modifications.</p>
  </pb-observable></div>
  <div class="tei-section3"><pb-observable data="0,3.38.25" emit="transcription">
    <h2 class="tei-title7 title">The Preview Pane</h2>
    <p class="tei-para">Whenever you add, remove or edit an annotation, the preview pane to the right will show you an updated preview of your changes. It shows<ol class="tei-orderedlist"><li class="tei-listitem">
          <p class="tei-para">the resulting HTML, i.e. how your document would display in TEI Publisher if the annotations were merged, rendered through the ODD associated with the document</p>
        </li><li class="tei-listitem">
          <p class="tei-para">the TEI of the entire document if annotations were merged</p>
        </li><li class="tei-listitem">
          <p class="tei-para">the internal JSON structure representing the annotations (for debugging purposes)</p>
        </li><li class="tei-listitem">
          <p class="tei-para">the TEI fragments which would be changed if annotations were merged</p>
        </li></ol></p>
    <p class="tei-para">The preview does not actually change the TEI source document: it just applies the annotations in memory, leaving the source untouched. It just allows you though to check if annotations will be applied in the correct way.</p>
    <figure class="tei-figure2 figure"><span class="tei--element">
        <span class="tei--element">
          <img src="ann-preview.png" class="tei-imagedata2" title="" style="width: 800px; ">
        </span>
      </span><figcaption>HTML preview</figcaption></figure>
    <p class="tei-para">The annotation text view in the middle and the preview HTML panel to the right, both render the document through ODD. However, they use 
      different ODDs: the annotation view renders the text through a dedicated ODD (annotations.odd) to make sure that all relevant 
      bits of the base text are displayed and there's no hidden information, which would be inaccessible to the editor. The preview HTML panel simply uses
      the ODD associated with the document (or the base teipublisher.odd otherwise).</p>
  </pb-observable></div>
  <div class="tei-section3"><pb-observable data="0,3.38.27" emit="transcription">
    <h2 class="tei-title7 title">Merge, Export and Undo</h2>
    <p class="tei-para">The toolbar on top of the preview pane provides important actions:
      <figure class="tei-figure2 figure"><span class="tei--element">
          <span class="tei--element">
            <img src="ann-toolbar.png" class="tei-imagedata2" title="" style="width: 500px; ">
          </span>
        </span><figcaption>Toolbar</figcaption></figure>
      <dl><dt>Reload source TEI</dt><dd>
            <p class="tei-para">This will reload the source TEI XML into the annotation view, discarding any existing annotations. Use this if you had to change the TEI in an external editor and want to continue annotating.</p>
          </dd><dt>Merge and save annotations to TEI</dt><dd>
            <p class="tei-para">Merges the current set of annotations into the TEI and saves it, establishing a new version of the base document. The annotation view will be reloaded to reflect the new base.</p>
          </dd><dt>Save and export TEI to a local file</dt><dd>
            <p class="tei-para">(Chrome only) As above, merges and saves the annotations, but additionally prompts for a local file into which a copy of the resulting TEI will be written.</p>
          </dd><dt>Undo last change</dt><dd>
            <p class="tei-para">Reverts the last action applied. For batch operations (if you clicked the "apply all" button above the occurrences list) this may comprise multiple annotations. 
              The annotation view will be reloaded and the remaining annotations are re-applied.</p>
          </dd><dt>Preview merge results</dt><dd>
            <p class="tei-para">Forces the preview pane to refresh.</p>
          </dd></dl></p>
  </pb-observable></div>
  </pb-observable></div>
  <div class="tei-section3"><pb-observable data="0,3.40" emit="transcription">
    <h1 class="tei-title7 title">Configuring the Annotation Editor</h1>
    <p class="tei-para">The annotation editor is fully configurable. This includes<ol class="tei-orderedlist"><li class="tei-listitem">
          <p class="tei-para">the connectors used for authority lookups</p>
        </li><li class="tei-listitem">
          <p class="tei-para">how authority entries can be extended with additional information</p>
        </li><li class="tei-listitem">
          <p class="tei-para">how annotations are mapped to TEI elements</p>
        </li></ol></p>
    <p class="tei-para">If you would like to customize the editor for your own needs, we recommend to generate a <span class="tei-emphasis2">separate application just for annotation purposes</span>. This makes it easier to configure and you maintain a clear separation between data which is still being worked on and the final edition you want to show to users.</p>
    <p class="tei-para">To generate a separate application for annotations, select <span class="tei--element">Admin</span>/<span class="tei--element">App Generator</span>. In the form, make sure to choose the ODD called "Annotations" and select "Annotation Editing" as template.</p>
    <div class="tei-section3"><pb-observable data="0,3.40.10" emit="transcription">
      <h2 class="tei-title7 title">Configuring Authorities</h2>
      <p class="tei-para">In its current state, TEI Publisher supports the following external authorities for entity lookup:<dl><dt>GeoNames</dt><dd>
              <p class="tei-para"><a href="https://www.geonames.org/" class="tei-link5" target="">geonames.org</a> - for places</p>
            </dd><dt>GND</dt><dd>
              <p class="tei-para"><a href="https://gnd.network/" class="tei-link5" target="">Gemeinsame Normdatei</a> via <a href="http://lobid.org/" class="tei-link5" target="">lobid.org</a> - for people, organizations and terms</p>
            </dd><dt>Metagrid</dt><dd>
              <p class="tei-para"><a href="https://metagrid.ch/" class="tei-link5" target="">metagrid.ch</a> - for people</p>
            </dd><dt>Airtable</dt><dd>
              <p class="tei-para"><a href="https://www.airtable.com/" class="tei-link5" target="">airtable.com</a> - arbitrary entities, each corresponding to a table</p>
            </dd><dt>Reconciliation</dt><dd>
              <p class="tei-para"><a href="https://reconciliation-api.github.io/testbench/" class="tei-link5" target="">Reconciliation Service</a> - arbitrary entities, provided by any reconciliation service</p>
            </dd><dt>KBGA</dt><dd>
              <p class="tei-para"><a href="https://theologie.unibas.ch/de/karl-barth-zentrum/gesamtausgabe/" class="tei-link5" target="">Karl Barth Gesamtausgabe</a> - for people, organizations, terms, abbreviations</p>
            </dd><dt>Custom</dt><dd>
              <p class="tei-para">A custom connector, which delegates to one or more authorities, but also searches a local TEI register</p>
            </dd></dl></p>
      <p class="tei-para">The HTML template defining the user interface of the annotations editor determines which authority is used for which annotation type and can be easily adjusted. 
        Just edit the <span class="tei-filename code">templates/pages/annotate.html</span> file, which can be done in eXide (or any editor of your choice). A simple configuration looks as follows:</p>
      <pb-code-highlight class="tei-programlisting5" language="xml" line-numbers="line-numbers">
&lt;pb-authority-lookup subscribe="transcription" emit="transcription"&gt;
    &lt;pb-authority connector="GND" name="organization" prefix="gnd"&gt;&lt;/pb-authority&gt;
    &lt;pb-authority connector="GeoNames" name="place" user="existdb" prefix="geo"&gt;&lt;/pb-authority&gt;
    &lt;pb-authority connector="GND" name="term" prefix="gnd"&gt;&lt;/pb-authority&gt;
    &lt;pb-authority connector="GND" name="person" prefix="gnd"&gt;&lt;/pb-authority&gt;
&lt;/pb-authority-lookup&gt;
      </pb-code-highlight>
      <p class="tei-para">Each top-level pb-authority needs at least two attributes:<ul class="tei-itemizedlist"><li class="tei-listitem">
            <p class="tei-para">a <span class="tei--element">name</span> indicating the annotation type for which it should be used</p>
          </li><li class="tei-listitem">
            <p class="tei-para">a <span class="tei--element">connector</span>, which selects one of the authority connectors listed above</p>
          </li></ul></p>
      <p class="tei-para">In addition, you may define a <span class="tei--element">prefix</span>: this will be prepended to the xml:id referenced by the resulting TEI element (separated by a hyphen "-"). 
        For example, you may want to prefix the numeric IDs received from GND with the prefix "gnd" to obtain an XML ID like "gnd-124507514" since a number alone would not be a valid @xml:id.</p>
      <p class="tei-para">Some connectors require additional configuration attributes. At the moment those are the <span class="tei-emphasis2">GeoNames</span>, <span class="tei-emphasis2">Airtable</span> and <span class="tei-emphasis2">Reconciliation</span> connectors. GeoNames requires you to register a user, whose name is given in the <span class="tei--element">user</span> attribute and Reconciliation requires that you specify a service URL.</p>
      <p class="tei-para">The <span class="tei-emphasis2">Airtable</span>, <span class="tei-emphasis2">Reconciliation</span> and <span class="tei-emphasis2">Custom</span> connectors are described in more detail below.</p>
      <div class="tei-section3"><pb-observable data="0,3.40.10.18" emit="transcription">
        <h3 class="tei-title7 title">Airtable Connector</h3>
        <p class="tei-para"><a href="https://www.airtable.com/" class="tei-link5" target="">airtable.com</a> is not an authority file as such, but rather a commercial online database, allowing users to define their own tables and forms. It can therefore be turned into an authority, e.g. by defining a <span class="tei-emphasis2">people</span> or <span class="tei-emphasis2">places</span> table and connecting it with the airtable connector. 
            Since any kind of data can be stored in an airtable, a slightly more complex configuration is necessary to specify how to access relevant tables and extract the required information. An example configuration for a single table is shown below:</p>
        <pb-code-highlight class="tei-programlisting5" language="xml" line-numbers="line-numbers">&lt;pb-authority connector="Airtable" name="topic" api-key="my-api-key" base="database-id" 
  table="Topics" fields="Name, Variants, Definition, Term Type" label="${Name}" 
  tokenize="Name, Variants" tokenize-regex="\s*;\s*"
  filter="or(find('${key}', lower({Name})), find('${key}', lower({Variants})))"&gt;
  &lt;template class="info"&gt;
    &lt;h3&gt;${Name}&lt;/h3&gt;
    &lt;p&gt;
        ${Term Type}
        &lt;br/&gt;
        ${Definition}
        &lt;br/&gt;
        ${Variants}
    &lt;/p&gt;
  &lt;/template&gt;
  &lt;template class="detail"&gt;
    ${Term Type}. ${Definition}. ${Variants}.
  &lt;/template&gt;
&lt;/pb-authority&gt;</pb-code-highlight>
        <p class="tei-para">This will retrieve authority entries from a table called 'Topics' using the columns Name, Variants, Definition and Term Type.</p>
        <dl><dt>api-key</dt><dd>
              <p class="tei-para">The personal API key obtained from your airtable.com user profile</p>
            </dd><dt>base</dt><dd>
              <p class="tei-para">The API key for your database</p>
            </dd><dt>table</dt><dd>
              <p class="tei-para">Name of the table to use</p>
            </dd><dt>fields</dt><dd>
              <p class="tei-para">A list of table column names to be retrieved as fields. Fields can be referenced in other configuration expressions using the <span class="tei-code2 code">${column}</span> notation</p>
            </dd><dt>label</dt><dd>
              <p class="tei-para">The field or expression to use as main label when displaying authority lookup results</p>
            </dd><dt>filter</dt><dd>
              <p class="tei-para">The airtable formula to be used for searching</p>
            </dd><dt>template class="info"</dt><dd>
              <p class="tei-para">An HTML fragment to show when displaying a popover with annotation details in the annotation editor</p>
              <figure class="tei-figure2 figure"><span class="tei--element">
                  <span class="tei--element">
                    <img src="ann-airtable-info.png" class="tei-imagedata2" title="" style="width: 500px; ">
                  </span>
                </span><figcaption>"Info" template in action</figcaption></figure>
            </dd><dt>template class="detail"</dt><dd>
              <p class="tei-para">HTML fragment to show as the detailed match description in the dialog presenting the results of querying the authority register</p>
              <figure class="tei-figure2 figure"><span class="tei--element">
                  <span class="tei--element">
                    <img src="ann-airtable-detail.png" class="tei-imagedata2" title="" style="width: 500px; ">
                  </span>
                </span><figcaption>"Detail" template in action</figcaption></figure>
            </dd><dt>tokenize</dt><dd>
              <p class="tei-para">Defines which columns should be used when searching the text for other potential occurrences of the entity. For the search, the column values are split using the regular expression given in <span class="tei--element">tokenize-regex</span></p>
            </dd><dt>tokenize-regex</dt><dd>
              <p class="tei-para">an optional regular expression used to split values before searching the text for other occurrences. This is useful if you have variant names separated by , or ; and each variant should be searched for separately.</p>
            </dd></dl>
      </pb-observable></div>
      <div class="tei-section3"><pb-observable data="0,3.40.10.20" emit="transcription">
        <h3 class="tei-title7 title">Reconciliation Service Connector</h3>
        <p class="tei-para">Like the airtable connector described above, the <a href="https://reconciliation-api.github.io/specs/latest/" class="tei-link5" target="">Reconciliation
            Service</a> is not really an authority file itself. Rather, it is a communication
          protocol for authority data providers originally developed for the open-source data
          cleaning software <a href="openrefine.org/" class="tei-link5" target="">OpenRefine</a>. The specification
          is an open, <a href="https://www.w3.org/community/reconciliation/" class="tei-link5" target="">community-maintained</a> standard now, and several authority data providers offer
          comforming API endpoints. GeoNames, the German GND (again via lobid), Getty vocabularies
          and Wikidata are some examples - find a list of current services at the <a href="https://reconciliation-api.github.io/testbench/" class="tei-link5" target="">service testbench</a>.
          In addition to the general attributes described above, the only additional bit of
          configuration is the service URL that should be queried. You specify it in the "endpoint"
          attribute:</p>
        <pb-code-highlight class="tei-programlisting5" language="xml" line-numbers="line-numbers">&lt;pb-authority connector="Reconciliation" name="term" prefix="wd" endpoint="https://wikidata.reconci.link/api"/&gt;</pb-code-highlight>
        <p class="tei-para">This will retrieve authority entries from wikidata.</p>
        <p class="tei-para">Currently, the Reconciliation connector cannot be used as a data provider for the Custom connector described below. This will be added in a future release.</p>
      </pb-observable></div>
      <div class="tei-section3"><pb-observable data="0,3.40.10.22" emit="transcription">
        <h3 class="tei-title7 title">Custom Connector</h3>
        <p class="tei-para">The custom connector delegates queries to one or more authorities, but most importantly it creates a copy of every authority entry you select and writes it to a local TEI register.</p>
        <p class="tei-para">For many editions the information provided by an external authority will not be sufficient. It may be incomplete, in the sense it may lack important information relevant in the context of the edition but also many historical persons or places may not yet appear in any authority.</p>
        <p class="tei-para">Using the custom connector gives you a possibility to extend the information about an entity, or add new ones. This works as follows:<ol class="tei-orderedlist"><li class="tei-listitem">
              <p class="tei-para">whenever you select an entry from the external authority, the custom connector creates a skeleton <span class="tei-tag code">person</span>, <span class="tei-tag code">place</span> or <span class="tei-tag code">category</span> TEI element in the local TEI registry (the exact location of the registry can be configured) using the information provided by the authority</p>
            </li><li class="tei-listitem">
              <p class="tei-para">you can extend the local entry with additional information, e.g. add a note to explain why the person is important in the context of the edition</p>
            </li><li class="tei-listitem">
              <p class="tei-para">any subsequent authority query will also search the local registry and matches found there will be ranked at the top of the results</p>
            </li><li class="tei-listitem">
              <p class="tei-para">to support entites which do not exist in an external authority, just create an entry in the local registry and assign it a local xml:id</p>
            </li></ol></p>
        <p class="tei-para">To configure the custom connector, simply wrap it around the definition for the external authority you want to use, e.g.:</p>
        <pb-code-highlight class="tei-programlisting5" language="xml" line-numbers="line-numbers">&lt;pb-authority connector="Custom" name="person"&gt;
    &lt;pb-authority connector="GND" prefix="gnd"&gt;&lt;/pb-authority&gt;
&lt;/pb-authority&gt;</pb-code-highlight>
        <p class="tei-para">This defines a custom connector for the annotation type 'person', delegating queries to the GND connector, but also maintaining a local registry. By default the local registry is stored in a TEI document residing in <span class="tei-filename code">data/registry.xml</span>. You can change the location by modifying the variable <span class="tei--element">$anno:local-authority-file</span> in the annotation configuration, <span class="tei-filename code">modules/annotation-config.xqm</span>. You can also change the function <span class="tei-function code">anno:insert-point</span> to configure where exactly the local entity definitions will be stored.</p> 
        <p class="tei-para">Currently, it is not possible to use the Reconciliation connector described above in the context of the Custom connector. This will be added in a future release.</p>
      </pb-observable></div>
    </pb-observable></div>
    <div class="tei-section3"><pb-observable data="0,3.40.12" emit="transcription">
      <h2 class="tei-title7 title">Configuring Annotations</h2>
      <p class="tei-para">Adding new annotation types or modifying existing ones involves the following three files within TEI Publisher or generated apps:</p>
      <dl><dt><span class="tei-filename code">templates/pages/annotate.html</span></dt><dd>
            <p class="tei-para">The HTML page for the annotation editor</p>
          </dd><dt><span class="tei-filename code">modules/annotation-config.xqm</span></dt><dd>
            <p class="tei-para">Defines how annotations are mapped to TEI</p>
          </dd><dt><span class="tei-filename code">odd/annotations.odd</span></dt><dd>
            <p class="tei-para">The ODD used to render the annotation text view. In generated apps this will live in <span class="tei-filename code">resources/odd/annotations.odd</span>.</p>
          </dd></dl>
      <p class="tei-para">Let's assume we would like to support an annotation to tag foreign language passages with the TEI <span class="tei-tag code">foreign</span> element:</p>
      <p class="tei-para">First, open <span class="tei-filename code">templates/pages/annotate.html</span> in eXide and locate the <span class="tei-tag code">div</span> with class <span class="tei--element">toolbar</span>. This contains a list of <span class="tei-tag code">paper-icon-button</span> elements. Like many elements in TEI Publisher, <span class="tei-tag code">paper-icon-button</span> is a webcomponent from the polymer library, which renders a button compliant with Google's material design. You could use any other button-type element here, but for consistency, let's stick with <span class="tei-tag code">paper-icon-button</span>. We define our new button like this:</p>
      <pb-code-highlight class="tei-programlisting5" language="xml" line-numbers="line-numbers">&lt;paper-icon-button class="annotation-action toggle" title="Foreign" data-type="foreign" icon="icons:language" data-shortcut="⌘+⇧+b,ctrl+⇧+b" disabled="disabled"&gt;&lt;/paper-icon-button&gt;</pb-code-highlight>
      <figure class="tei-figure2 figure"><span class="tei--element">
          <span class="tei--element">
            <img src="ann-configure.png" class="tei-imagedata2" title="" style="width: 800px; ">
          </span>
        </span><figcaption>Configure a new annotation type</figcaption></figure>
      <p class="tei-para">Make sure to include all the attributes shown:</p>
      <dl><dt>class</dt><dd>
            <p class="tei-para">must at least contain <span class="tei--element">annotation-action</span>. The <span class="tei--element">toggle</span> indicates that this is a toggling annotation, which just switches between on and off and does not need further input. For semantic annotations you can also add <span class="tei--element">authority</span>, which would trigger the authority lookup.</p>
          </dd><dt>title</dt><dd>
            <p class="tei-para">a label to be shown when the mouse is moved over the button.</p>
          </dd><dt>data-type</dt><dd>
            <p class="tei-para">indicates the annotation type.</p>
          </dd><dt>icon</dt><dd>
            <p class="tei-para">the <a href="http://kevingleason.me/Polymer-Todo/bower_components/iron-icons/demo/index.html" class="tei-link5" target="">material design icon</a> to use</p>
          </dd><dt>data-shortcut</dt><dd>
            <p class="tei-para">an optional keyboard shortcut: here we use command-shift-b for Mac and ctrl-shift-b on windows</p>
          </dd><dt>disabled</dt><dd>
            <p class="tei-para">initially disables the button</p>
          </dd></dl>
      <p class="tei-para">If you reload the annotation editor in the browser, you should now see your new button. However, TEI Publisher does not yet know how to translate the new annotation into actual TEI markup. To fix this, open <span class="tei-filename code">modules/annotation-config.xqm</span> and search for the function <span class="tei-function code">anno:annotations</span>. This is a long switch statement with cases corresponding to the different annotation types. Add a new case to the top:</p>
      <pb-code-highlight class="tei-programlisting5" language="xml" line-numbers="line-numbers">declare function anno:annotations($type as xs:string, $properties as map(*), $content as function(*)) {
    switch ($type)
        case "foreign" return
            &lt;foreign xmlns="http://www.tei-c.org/ns/1.0"&gt;{$content()}&lt;/foreign&gt;
    ...
};</pb-code-highlight>
      <p class="tei-para">This will simply wrap a <span class="tei-tag code">foreign</span> tag around the existing content. Note that <span class="tei-parameter code">$content</span> is passed in as a function pointer, so it is important to call it as <span class="tei-code2 code">$content()</span>. Also note how we need to declare the TEI namespace. Without this namespace declaration, the element would not be recognized as TEI.</p>
      <p class="tei-para">Now we can try our new annotation: select a passage, click on the button and see how the text is marked as an annotation. The color is chosen automatically. You can also check in the TEI preview pane that the annotation is correctly output as a TEI <span class="tei-tag code">foreign</span> element.</p>
      <p class="tei-para">However, if you save the annotations, you'll notice that - once the annotation view refreshes - the foreign text is rendered in italics, but not marked as an annotation! To fix this, we need to modify the ODD used for rendering the annotation view.</p>
      <p class="tei-para">Open <span class="tei-filename code">odd/annotations.odd</span> (named "Annotations"), either in eXide or the ODD editor. Add an <span class="tei-tag code">elementSpec</span> for element <span class="tei-tag code">foreign</span> with an inline model and a <span class="tei--element">cssClass</span> containing <span class="tei-code2 code">annotation annotation-foreign</span>.</p>
      <pb-code-highlight class="tei-programlisting5" language="xml" line-numbers="line-numbers">&lt;elementSpec ident="foreign" mode="change"&gt;
    &lt;model behaviour="inline" cssClass="annotation annotation-foreign"/&gt;
&lt;/elementSpec&gt;</pb-code-highlight>
      <p class="tei-para">If you like, you can also keep the <span class="tei-tag code">outputRendition</span>, which renders the text in italic. Key is that you declare the two <span class="tei-emphasis2">annotation annotation-foreign</span> CSS classes, because those will tell TEI Publisher that the element should be treated as an annotation.</p>
      <p class="tei-para">As a general guideline, the ODD rules for annotations should produce simple inline tags. They should output the content of the element without any modification. They may use <span class="tei-tag code">outputRendition</span> to change the appearance, or supply other parameters (than <span class="tei--element">content</span>).</p>
      <p class="tei-para">After saving the ODD, reloading the annotation editor should properly display the <span class="tei-tag code">foreign</span> as an annotation and we can start using our new annotation type.</p>
      <p class="tei-para">However, we may not be entirely happy with the simple on/off toggle: it would be much better if we could also indicate the used language in <span class="tei-tag code">foreign</span>. This means we have to change our annotation from a mere toggle into one which can take an additional parameter:</p>
      <p class="tei-para">To achieve this, go back to <span class="tei-filename code">templates/pages/annotate.html</span> and remove the <span class="tei--element">toggle</span> class from the <span class="tei-tag code">paper-icon-button</span>:</p>
      <pb-code-highlight class="tei-programlisting5" language="xml" line-numbers="line-numbers">&lt;paper-icon-button class="annotation-action" title="Foreign" data-type="foreign" icon="icons:language" data-shortcut="⌘+⇧+b,ctrl+⇧+b" disabled="disabled"&gt;&lt;/paper-icon-button&gt;</pb-code-highlight>
      <p class="tei-para">We would also like to provide an input field into which the user can enter the language. Scroll down to where the <span class="tei-tag code">form</span> is defined and add another input on top:</p>
      <pb-code-highlight class="tei-programlisting5" language="xml" line-numbers="line-numbers">&lt;iron-form id="edit-form"&gt;
    &lt;form action=""&gt;
        &lt;paper-input class="annotation-form foreign" name="lang" label="Language"&gt;&lt;/paper-input&gt;
    ...
&lt;/iron-form&gt;</pb-code-highlight>
      <p class="tei-para">Again we're using a webcomponent for the input to get the material design look and feel. The class attribute is particularly important: it must always contain <span class="tei--element">annotation-form</span>, followed by the annotation type: <span class="tei--element">foreign</span>. The name is arbitrary, but should be unique and we need to remember it for later. The label should contain a short title, which will be shown next to the input.</p>
      <p class="tei-para">Finally, we need to change our rule in <span class="tei-filename code">modules/annotation-config.xqm</span> to add the new parameter to the generated <span class="tei-tag code">foreign</span> element. Navigate to the file and change the <span class="tei-function code">anno:annotations</span> function as follows:</p>
      <pb-code-highlight class="tei-programlisting5" language="xml" line-numbers="line-numbers">declare function anno:annotations($type as xs:string, $properties as map(*), $content as function(*)) {
    switch ($type)
        case "foreign" return
            &lt;foreign xmlns="http://www.tei-c.org/ns/1.0" xml:lang="{$properties?lang}"&gt;{$content()}&lt;/foreign&gt;
    ...
};</pb-code-highlight>
      <p class="tei-para">The function receives all the parameters entered into the form fields in the <span class="tei--element">$properties</span> map. In the form we used <span class="tei-code2 code">name="lang"</span>, so the corresponding value is retrieved from the map with <span class="tei-code2 code">$properties?lang</span>.</p>
      <p class="tei-para">That's all. You should now be able to modify your existing foreign annotation, enter a language and see how it is output into TEI.</p>
      
    </pb-observable></div>
    <div class="tei-section3"><pb-observable data="0,3.40.14" emit="transcription">
      <h2 class="tei-title7 title">Other Considerations</h2>
      <p class="tei-para">Web annotations require a clear mapping between the HTML view of the text in the browser and the TEI document in the database. It is thus important to respect the following restrictions:</p>
      <ol class="tei-orderedlist"><li class="tei-listitem">
          <p class="tei-para">TEI Publisher's page-by-page display of a text will not work in the annotation editor</p>
        </li><li class="tei-listitem">
          <p class="tei-para">Likewise, the <span class="tei--element">fill</span> parameter, which causes TEI Publisher to fill up short fragments with content from nested divs, should be set to 0 for annotation purposes.</p>
        </li><li class="tei-listitem">
          <p class="tei-para">The annotation editor can operate on documents with multiple division and will show them one after the other. However, those need to be top-level divisions. Therefore the <span class="tei--element">depth</span> parameter should be set to 1.</p>
        </li></ol>
      <p class="tei-para">To ensure this, TEI Publisher sets the following configuration for the annotate collection in <span class="tei-filename code">config.xqm</span>:</p>
      <pb-code-highlight class="tei-programlisting5" language="xquery" line-numbers="line-numbers">declare function config:collection-config($collection as xs:string?, $docUri as xs:string?) {
    switch ($collection)
        (: For annotations we need to overwrite document-specific settings :)
        case "annotate" return
            map {
                "template": "annotate.html",
                "overwrite": true(),
                "depth": 1,
                "fill": 0
            }
        default return
            (: Return empty sequence to use default config :)
            ()
};</pb-code-highlight>
      <p class="tei-para">Generated applications should choose similar settings. If you create a separate app just for annotations, the following function would suffice to impose the right settings for all documents:</p>
      <pb-code-highlight class="tei-programlisting5" language="xquery" line-numbers="line-numbers">declare function config:collection-config($collection as xs:string?, $docUri as xs:string?) {
    map {
        "template": "annotate.html",
        "overwrite": true(),
        "depth": 1,
        "fill": 0
    }
};</pb-code-highlight>
    </pb-observable></div>
  </pb-observable></div>
</html>